<Project>
    <PropertyGroup>
        <GeneratedNamespacePrefixEditorConfig>$(BaseIntermediateOutputPath)NovaSharp.NamespacePrefix.editorconfig</GeneratedNamespacePrefixEditorConfig>
    </PropertyGroup>

    <Target Name="GenerateNamespacePrefixEditorConfig"
            BeforeTargets="CoreCompile"
            Condition="'$(EnableNamespacePrefixRule)' == 'true' and '$(EnforcedNamespacePrefix)' != ''">
        <MakeDir Directories="$(BaseIntermediateOutputPath)" />
        <ItemGroup Condition="'$(NamespacePrefixExcludedNamespaces)' != ''">
            <_NamespacePrefixExclusion Include="$(NamespacePrefixExcludedNamespaces)" />
        </ItemGroup>
        <PropertyGroup>
            <_NamespacePrefixExclusionList Condition="'@(_NamespacePrefixExclusion)' != ''">-:@(_NamespacePrefixExclusion->'%(Identity)', ', -:')</_NamespacePrefixExclusionList>
            <_NamespacePrefixApplicableNamespaces>*</_NamespacePrefixApplicableNamespaces>
            <_NamespacePrefixApplicableNamespaces Condition="'$(_NamespacePrefixExclusionList)' != ''">*, $(_NamespacePrefixExclusionList)</_NamespacePrefixApplicableNamespaces>
        </PropertyGroup>
        <ItemGroup>
            <_NamespacePrefixEditorConfigLines Include="# Auto-generated by Directory.Build.targets; do not edit manually." />
            <_NamespacePrefixEditorConfigLines Include="[*.cs]" />
            <_NamespacePrefixEditorConfigLines Include="dotnet_naming_rule.namespace_prefix_rule.symbols = namespace_prefix_symbols" />
            <_NamespacePrefixEditorConfigLines Include="dotnet_naming_rule.namespace_prefix_rule.style = namespace_prefix_style" />
            <_NamespacePrefixEditorConfigLines Include="dotnet_naming_rule.namespace_prefix_rule.severity = $(NamespacePrefixDiagnosticSeverity)" />
            <_NamespacePrefixEditorConfigLines Include="dotnet_naming_symbols.namespace_prefix_symbols.applicable_kinds = namespace" />
            <_NamespacePrefixEditorConfigLines Include="dotnet_naming_symbols.namespace_prefix_symbols.applicable_namespaces = $(_NamespacePrefixApplicableNamespaces)" />
            <_NamespacePrefixEditorConfigLines Include="dotnet_naming_style.namespace_prefix_style.capitalization = pascal_case" />
            <_NamespacePrefixEditorConfigLines Include="dotnet_naming_style.namespace_prefix_style.required_prefix = $(EnforcedNamespacePrefix)" />
        </ItemGroup>
        <WriteLinesToFile
            File="$(GeneratedNamespacePrefixEditorConfig)"
            Lines="@(_NamespacePrefixEditorConfigLines)"
            Overwrite="true" />
    </Target>

    <ItemGroup Condition="'$(EnableNamespacePrefixRule)' == 'true' and '$(EnforcedNamespacePrefix)' != ''">
        <EditorConfigFiles Include="$(GeneratedNamespacePrefixEditorConfig)" />
    </ItemGroup>
</Project>
