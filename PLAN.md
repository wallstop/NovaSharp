# Modern Testing & Coverage Plan

## Repository Snapshot — 2025-11-25 (UTC)
- Build: `dotnet build src/NovaSharp.sln -c Release -nologo` is warning-free; keep the zero-warning bar enforced by rerunning the build after every analyzer touchpoint.
- Tests: `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --no-build` passes 2,815 tests in ~46 seconds; TAP IO/OS fixtures remain skipped.
- Coverage: `docs/coverage/latest/Summary.md` (2025-11-24 13:11 UTC) reports 86.7% line / 85.8% branch overall.
  - NovaSharp.Interpreter: 96.0% line / 93.0% branch (still below the ≥95% branch target needed before turning `COVERAGE_GATING_MODE` back to `enforce`).
  - NovaSharp.Cli: 83.4% line / 80.5% branch.
  - NovaSharp.Hardwire: 52.7% line / 40.7% branch.
  - NovaSharp.RemoteDebugger: 86.1% line / 76.5% branch.
  - NovaSharp.VsCodeDebugger: 1.8% line / 2.1% branch (no automated debugger tests yet).
- Coverage collateral: `docs/coverage/coverage-hotspots.md` now reflects the 2025-11-24 run (2,779 tests) and highlights the remaining interpreter branch debt.
- Audits: `documentation_audit.log` and `spelling_audit.log` still report zero outstanding issues; `naming_audit.log` now tracks the 36 legacy `_`-prefixed test fixtures flagged by `tools/NamingAudit` so contributors can chip away at them. CI runs the corresponding scripts.
- Regions: `rg -n '#region'` only finds references inside contributor docs (AGENTS.md and this file), so runtime/tooling/tests stay region-free.

## Baseline Controls (must stay green)
- Keep the documentation audit checked in. Re-run `python tools/DocumentationAudit/documentation_audit.py --write-log documentation_audit.log` whenever public/internal APIs change.
- `tools/NamingAudit` and `tools/SpellingAudit` are wired into CI; refresh `naming_audit.log` and `spelling_audit.log` locally before pushing code that touches identifiers or docs.
- Namespace/script hub governance already gates CI. Any new helper must live under `scripts/<area>/` with a README update plus PR-template acknowledgement.
- Re-run `rg -n '#region'` whenever generators or imports are added; update offending generators to strip regions automatically.
- Keep `docs/Testing.md`, `docs/Modernization.md`, and `scripts/README.md` aligned with the helpers in `scripts/` so contributors have a single source of truth.

## Active Initiatives

### 1. Analyzer and warning debt
- Current status: `dotnet build src/NovaSharp.sln -c Release -nologo` is clean and the root solution now runs with `<TreatWarningsAsErrors>true>`; keep running the build after each analyzer sweep so the zero-warning bar never regresses. Treat any new analyzer hits as stop-ship items. **Next steps:** document analyzer suppressions/command changes in `PLAN.md` as they happen and keep the PR template’s analyzer section up to date as new tooling expectations land.
- TreatWarningsAsErrors rollout (2025-12-07): Enabled `<TreatWarningsAsErrors>true>` in `Directory.Build.props` so the entire solution now fails on any compiler/analyzer warning, reran `dotnet build src/NovaSharp.sln -c Release -nologo` (0 warnings) to lock in the stricter gate, updated `docs/Testing.md` with the new policy/command expectations, and extended `.github/pull_request_template.md` with an Analyzer Coverage section so authors list the builds/tests they ran.
- Hardwire (2025-11-24): completed a context/generator sweep that adds explicit null-argument guards, invariant formatting, `TryGetValue` usage, and `static` helper conversions while deleting the legacy CodeDom region directives. NovaSharp.Hardwire no longer reports CA1062/CA1305/CA1854/CA1822/CA1031/CA1725 in Release builds, and generator discovery now skips placeholders (e.g., `NullGenerator`) so HardwireCommand + registry tests wire up the built-ins again. Follow-on work should tackle the remaining CA1859 spots (list/dictionary abstractions) and add analyzer coverage for any new generators. The project now builds with `<TreatWarningsAsErrors>true>` so keep it warning-free.
- VS Code debugger: `NovaSharpVsCodeDebugServer` now follows the full dispose pattern, exposes the `CurrentDebugger` property (replacing the obsolete `GetDebugger()` helper), and guards public entry points (clearing CA1063/CA1816/CA2213/CA1805/CA1062/CA1024). `ProtocolServer` and `DebugSession` now use protected constructors, eliminating the CA1012 warnings while keeping the public API surface abstract-only. CA1002 (List<T> exposure) is resolved by accepting `IEnumerable<T>` in the SDK response bodies, CA1310/CA1865/CA1866 are now clear after swapping everything to ordinal comparisons/char overloads (`Utilities`, `ProtocolServer`, `NovaSharpDebugSession`), the AsyncDebugger map lookups now use `TryGetValue` (no CA1854), socket/session catches target concrete exception types, and public entry points validate arguments (CA1031/CA1062 cleared). The CA1822/CA1805/CA1825 warnings are gone after the static sweep + field cleanup, and CA1716 is resolved via the `ProtocolEvent` rename plus the `ContinueExecution`/`StepOver` API updates. `TreatWarningsAsErrors` is now enabled inside `NovaSharp.VsCodeDebugger.csproj`, so the latest `dotnet build src/debuggers/NovaSharp.VsCode.Debugger/NovaSharp.VsCode.Debugger.csproj -c Release -nologo` run reports zero project-local warnings. Next steps: keep the zero-warning bar enforced and document the debugger-specific analyzer policies in `docs/Testing.md`.
- Debugger analyzer policies (2025-12-05): Added a `Debugger Analyzer Guardrails` section to `docs/Testing.md` that spells out the disposal/argument/culture/collection rules enforced by the VS Code and Remote debugger analyzers (CA1063/CA2213/CA1031/CA1062/CA1305/CA1310/CA1002/etc.) together with the required validation commands (`dotnet build` per debugger project plus the RemoteDebugger NUnit filters). Keep that section updated whenever new suppressions land so the documentation mirrors the analyzer expectations recorded here.
- Remote debugger (2025-11-24): `RemoteDebuggerService`, `DebugServer`, `HttpServer`, `Utf8TcpServer`, `DebugWebHost`, and the shared network helpers now follow the full dispose pattern, validate external inputs, and run every formatter through `CultureInfo.InvariantCulture`. Static helper sweeps (including the VS-style resource loader) plus the `WatchElementNames` dictionary fix cleared the CA1063/CA1816/CA1305/CA1822/CA1859 backlog and dropped the project-specific warning count from 60 → 24. The latest pass eliminates the remaining analyzer hits (CA1031/CA1008/CA1056/CA1711/CA1815/CA1819) by renaming the blocking channel, converting debugger URLs to `Uri`, exposing HTTP payloads via `ReadOnlyMemory<byte>`, tightening catch blocks, and adding proper value semantics to `RemoteDebuggerOptions`. Release builds now emit zero warnings and `NovaSharp.RemoteDebugger.csproj` ships with `<TreatWarningsAsErrors>true>`, with new NUnit coverage (`BlockingChannelTests`, `RemoteDebuggerOptionsTests`) guarding the concurrency and equality helpers. Next steps pivot to debugger/coroutine coverage (watch evaluations, queued actions mid-refresh) and documenting any additional analyzer suppressions in `docs/Testing.md`.
- Remote debugger coverage (2025-12-05): Extended `RemoteDebuggerTests` with `WatchesEvaluateExpressionsAgainstScriptState` (dynamic expressions stay live against the script globals and report updated values) and `QueuedRefreshesIncludeLatestWatchChanges` (multiple `addwatch` commands queued before the next `GetAction` still result in a single deduplicated watch list). Validated via `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter FullyQualifiedName~RemoteDebuggerTests`, so the “watch evaluations / queued actions mid-refresh” item now has executable coverage.
- Debugger pause/resume coverage (2025-12-05): Added `HostBusyMessagesClearWhenNextActionRuns`, `QueuedActionsDrainAfterPauseRequest`, and `SignalRuntimeExceptionBroadcastsDecoratedMessage` to `RemoteDebuggerTests` to exercise the host-busy → host-ready transition (message decoration path), verify queued actions continue draining after a pause command, and ensure decorated runtime errors are broadcast while pausing execution. Validated with the same `dotnet test ... --filter FullyQualifiedName~RemoteDebuggerTests` target, covering the pause-during-refresh and forced-resume scenarios called out in the coverage plan.
- Tests (2025-11-25): batch-converted the remaining helper/fixture types in `NovaSharp.Interpreter.Tests` (RegisterCommand, PropertyTableAssigner, UserData, LuaBase, Hardwired*, DescriptorHelpers, TapRunner, ConfigPropertyAssigner, etc.) to `public sealed` (or added private anchors where visibility matters), so Release builds no longer emit CA1812 for the NUnit suite. RemoteDebugger test clients now return concrete `List<string>` instances (`ReadUntil`/`ReadAll`/`ReadAvailable`), clearing the old CA1859 warnings. `ReplInterpreterScriptLoaderTests.OverrideEnv` now returns the concrete `EnvRestore` helper (and the call sites use it directly), eliminating the final CA1859 in the tests after `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter ReplInterpreterScriptLoaderTests`. Console-driven suites (`RunCommandTests`, `ShellCommandManagerTests`, `HelpCommandTests`, `ExitCommandTests`) now rely on a shared disposable capture scope, `StreamFileUserDataBaseTests` shed its disposable fields, and `IoModuleVirtualizationTests.InMemoryPlatformAccessor` implements `IDisposable`, so the CA1001 backlog in the interpreter tests is cleared. Next up is attacking the CA2000 warnings (ProgramTests, RemoteDebugger/HttpServer sockets, CoroutineModuleTests, etc.) so we stop leaking temporary streams in Release analyzer runs.
- CA2000 (2025-11-25): Program interpreter-loop tests now dispose captured console readers/writers, the RemoteDebugger/HttpServer suites wrap their ephemeral `TcpListener` probes in `using` blocks, and CoroutineModule wait handles live inside `using ManualResetEventSlim` scopes. `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter "FullyQualifiedName~ProgramTests|FullyQualifiedName~RemoteDebuggerServiceTests|FullyQualifiedName~RemoteDebuggerTests|FullyQualifiedName~HttpServerTests|FullyQualifiedName~CoroutineModuleTests"` verifies the new ownership. Next up is clearing the remaining CA2000 hits (e.g., RemoteDebuggerServiceTests HTTP clients, RemoteDebuggerTests client wrappers, HttpServerTests request helpers) and then tackling the CA2000 backlog in the CLI/unit suites that spin up sockets without guards.
- CA2000 (2025-11-26): Scoped the disposable resources in `Utf8TcpServerTests`, `UndisposableStreamTests`, and `PerformanceStopwatchTests` so local listeners, wrappers, and stopwatches are wrapped in `using` declarations. Confirmed via `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter "FullyQualifiedName~Utf8TcpServerTests|FullyQualifiedName~UndisposableStreamTests|FullyQualifiedName~PerformanceStopwatchTests"` plus `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA2000"` (no matches). Remaining CA2000 debt still centers on the RemoteDebugger HTTP clients and CLI sockets listed above.
- CA1024 (2025-11-26): Eliminated the lingering CA1024 warnings by converting the unused `BenchmarkHost.GetStored()` helper into a `Stored` property and adding targeted `SuppressMessage` attributes to the Lua interop fixtures (`RegCollMethods` in all three collection suites, `ProxyObjectsTests.Proxy.GetValue`, `MetatableTests.MyObject.GetSomething`, `UserDataEnumsTests.EnumOverloadsTestClass.Get/GetF`, and `VtUserDataPropertiesTests.SomeClass.GetWoIntProp2`). The suppressions are scoped with justifications that document why the callable getters must stay verb-based (the tests exercise colon-call semantics and write-only property access). Verified with `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA1024"` (no matches).
- CA1310/CA1866 (2025-11-26): Hardened the CLI interpreter loop and command parsing against locale-sensitive comparisons by switching the `StartsWith` checks to ordinal/char-aware logic, and swept the NUnit suites that inspect file contents or TAP output so every `StartsWith`/`EndsWith` call now specifies `StringComparison.Ordinal`. `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA1310|CA1866"` returns no matches, so the analyzer queue is down to the other warning classes called out above.
- CA1515 (2025-11-26): Restricted the CLI command surface (`ICommand`, `CommandManager`, `ShellContext`, and the remote-debugger bridge interface) to `internal` so we stop exporting REPL-only helpers. `dotnet build src/NovaSharp.sln -c Release -nologo` now reports CA1515 only for the BenchmarkDotNet harness (`LuaRuntimeSuites`, `LuaScriptCorpus`, `RuntimeBenchmarks`, `ScriptLoadingBenchmarks`), which can be addressed in a follow-up.
- CA1515 (2025-11-29): Added module-level suppressions for `NovaSharp.Benchmarks`, `NovaSharp.Comparison`, and `NovaSharp.Interpreter.Tests` because BenchmarkDotNet and NUnit 2.6 require public fixtures/benchmarks for discovery. Verified with `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA1515"` (no matches), so the warning backlog now focuses on the remaining rules called out below.
- CA1822 (2025-11-29): Converted the helper pipelines in `UserDataFieldsTests`, `VtUserDataPropertiesTests`, the collection end-to-end suites (`CollectionsRegisteredTests`, `CollectionsBaseGenRegisteredTests`, `CollectionsBaseInterfGenRegisteredTests`), and the CLI `HardwireCommand` utilities to static methods, taught the `BinaryDumpTests`/`ConfigPropertyAssignerTests` scaffolding to rely on `static` helpers, and had the `ProxyObjectsTests` getter hit instance state so analyzer runs stop flagging those files. Latest passes also marked `TestMoreTests.AreCoreModulesFullySupported`, `LuaTestSuiteExtract.RunTest`, `JsonSerializationTests.AssertTableValues`, `StringLibTests.TestMatch`, `UserDataIndexerTests.IndexerTest`, and all of the `UserDataPropertiesTests` helper methods as static helpers, gave `MetatableTests.MyObject` plus both property suites (`UserDataPropertiesTests`/`VtUserDataPropertiesTests`) real instance-backed state for their read-only members, and added call-tracking to `UserDataEnumsTests.EnumOverloadsTestClass`. At that stage the only remaining CA1822 hits were the big user-data method suites (see the 2025-11-30 entry for the closure) and we documented the helper patterns so new fixtures stay analyzer-clean.
- CA1822 (2025-11-30): Finished the interpreter/user-data sweep by making the `UserDataMethodsTests`, `VtUserDataMethodsTests`, `UserDataOverloadsTests`, `VarargsTupleTests`, and `VtUserDataFieldsTests` harness helpers static where possible and giving the fixture classes (`SomeClass*`, `OverloadsTestClass`, `SomeOtherClass*`) real instance-backed state so analyzer runs see legitimate instance usage. `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA1822"` now reports zero matches, and `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --no-build --filter "FullyQualifiedName~UserDataMethodsTests|FullyQualifiedName~UserDataOverloadsTests|FullyQualifiedName~VarargsTupleTests|FullyQualifiedName~VtUserDataMethodsTests|FullyQualifiedName~VtUserDataFieldsTests"` validates the touched suites.
- CA1822 (2025-12-07): Cleared the lingering analyzer hits in the meta/indexer suites and descriptor hosts by giving the VT meta helpers real instance-backed data (`ClassWithLength`/`ClassWithCount` now store offsets, the VT meta `Pairs` iterator sizes its list from `Value`, and both meta fixtures use static `OperatorTest` helpers), marking the VT indexer harness helper static, and teaching `MethodMemberDescriptorHost`, `OverloadedMethodHost`, and the hide-member samples to record instance state during their operations. Verified with `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA1822"` (no matches), so the interpreter tests remain CA1822-clean.
- Naming consistency audit (follow-up, 2025-12-04): Captured a fresh `tools/NamingAudit` snapshot (log now shows 592 namespaces inspected) and renamed the lingering `funcname` parameter in `BinaryDumpTests.ScriptLoadFunc` to `functionName` so Lua dump fixtures stay PascalCase-compliant. Continue scanning runtime/tooling/tests for other drift and document any `[CallerMemberName]` opportunities plus rename lists directly in this plan + `naming_audit.log`.
- Naming consistency audit (2025-11-30): Track a dedicated action item to analyze every production and test identifier for typos, casing drift, and confusing abbreviations, using `tools/NamingAudit`, targeted Roslyn queries, and manual review of hot spots. Document the audit workflow, list of renamed identifiers, and any `[CallerMemberName]` adoption opportunities in `PLAN.md` plus `naming_audit.log` so contributors can execute the sweep without breaking docs or Lua fixtures.
- CA1861 (2025-11-27): Converted the CLI `ProgramTests` argument arrays into shared `static readonly` fields so the analyzer no longer flags the repeated allocations at lines 41/55/69/83/198. Verified with `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter FullyQualifiedName~ProgramTests`. Next up is applying the same pattern across the other high-volume NUnit fixtures called out in the CA1861 warning list (Processor*, ProxyUserDataDescriptor*, ScriptLoaderBase*, TableConversions*, etc.).
- CA1861 (2025-11-27): Extracted the ScriptLoader path expectation arrays in `ScriptLoaderBaseTests` into private `static readonly` fields so the module-resolution tests no longer allocate per-assertion; confirmed via `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter FullyQualifiedName~ScriptLoaderBaseTests`. Continue sweeping the remaining Interpreter test fixtures (Processor*, TableConversions*, etc.) so the Release analyzer run stops flagging CA1861 entirely.
- CA1861 (2025-11-27): Standardized the REPL loader expected module-path arrays (`ReplInterpreterScriptLoaderTests`) by introducing shared `static readonly` fields for the NovaSharp-preferred, Lua52, Lua global, and fallback path sets. Verified with `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter FullyQualifiedName~ReplInterpreterScriptLoaderTests`. Remaining CA1861 focus areas include the OsSystem module fixtures, overloaded member descriptor suites, and ProxyUserData descriptor tests.
- CA1861 (2025-11-27): Reused static command arrays in `OsSystemModuleTests` so the os.execute assertions stop allocating `new[] { "build" }` / `new[] { "fail" }` on every run. Validated via `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter FullyQualifiedName~OsSystemModuleTests`. Continue sweeping the descriptor-heavy suites (`OverloadedMethodMemberDescriptorTests`, `TableConversionsTests`, etc.) next.
- CA1861 (2025-11-27): Added shared string arrays for the user-data varargs cases in `OverloadedMethodMemberDescriptorTests`, eliminating the repeated `new[] { "cached"|"wrapped"|"lua" }` allocations that were still triggering analyzer hits. Verified with `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter FullyQualifiedName~OverloadedMethodMemberDescriptorTests`. Remaining hotspots: ProxyUserDataDescriptorTests, TableConversionsTests, MultiDictionaryTests, etc.
- CA1861 (2025-11-27): Collapsed the repeated literal arrays inside `TableConversionsTests` into reusable static expectations (list/array/int cases) and updated the assertions to reference them directly. Confirmed via `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter FullyQualifiedName~TableConversionsTests`. The remaining CA1861 debt is now concentrated in ProxyUserDataDescriptorTests, MultiDictionaryTests, and the code-gen/serialization suites called out in the build log.
- CA1861 (2025-11-27): Added a shared `AlphaValues` array in `MultiDictionaryTests` so the `Find("alpha")` verification no longer allocates `new[] { 1, 2 }` on each run. Verified with `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter FullyQualifiedName~MultiDictionaryTests`. Still to tackle: ProxyUserDataDescriptorTests, Hardwire code-gen tests, StreamFileUserDataBaseTests, etc.
- CA1861 (2025-11-27): Deduplicated the stack/result expectation arrays in `ProcessorTests` and the single-line breakpoint arrays inside `ProcessorDebuggerTests`, replacing every `Is.EqualTo(new[] { ... })` literal with shared `static readonly` fields. Verified with `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter FullyQualifiedName~ProcessorTests` and the matching `ProcessorDebuggerTests` filter. Upcoming CA1861 work should tackle the remaining Interpreter fixtures highlighted in the build log (e.g., ReplInterpreterScriptLoaderTests, OverloadedMethodMemberDescriptorTests, OsSystemModuleTests).
- CA1861 (2025-11-28): Cleared the remaining analyzer hits by caching expectation arrays across the lingering interpreter suites (BinaryEncodingTests, CoroutineApiTests, CoroutineTests, SliceTests, DebuggerActionTests, DebuggerResumeHelpersTests, DebugModuleTests, DispatchingUserDataDescriptorTests, DescriptorHelpersTests, HardwireCodeGenerationContextTests, StreamFileUserDataBaseTests, ProxyUserDataDescriptorTests, SerializationExtensionsTests) and the end-to-end fixtures (`UserDataMethodsTests`, `VtUserDataMethodsTests`). Also consolidated the Unity assets loader expectations and the conversion lambdas so Hardwire/Proxy scenarios stop re-allocating constant arrays. `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA1861"` now returns no matches; keep an eye on new tests to ensure they follow the static-cache pattern.
- Environment variables (2025-11-25): standardized on the ALL_UPPERCASE `NOVASHARP_PATH` name and removed the old mixed-case fallback entirely. `ReplInterpreterScriptLoader` and `ScriptLoaderBase` now consult `NOVASHARP_PATH`, fall back straight to `LUA_PATH_5_2`/`LUA_PATH`, and then default to `?;?.lua`. The REPL/script-loader NUnit suites exercise the new precedence order, and `docs/coverage/coverage-hotspots.md` references the uppercase variable exclusively. Verified via `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter "FullyQualifiedName~ReplInterpreterScriptLoaderTests|FullyQualifiedName~ScriptLoaderBaseTests"`.
- Runtime (2025-11-28): Exposed a read-only `Closure.Context` property that surfaces the captured upvalues as an `IReadOnlyList<DynValue>` so tooling/tests can inspect the closure scope without reflection. `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter ClosureTests` covers the new API; no CA1024 suppression needed.
- Naming consistency audit (2025-11-28): Renamed the CLI `HardWireCommand` and its NUnit companion to `HardwireCommand` so the type/file names match the NovaSharp.Hardwire tooling branding, touching the docs and Program bootstrapper alongside the tests. Validated with `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter HardwireCommandTests`.
- Naming consistency audit (2025-11-29): Completed a repo-wide `UpValue`/`UpValues` sweep so every runtime/debugger/test identifier now follows true PascalCase (e.g., `GetUpValue`, `UpValuesType`, `SymbolRef.UpValue`, `OpCode.UpValue`, VS Code variable inspectors, NUnit fixtures, and docs). Verified with `dotnet build src/NovaSharp.sln -c Release -nologo`.
- Naming consistency audit (2025-11-29): Captured the UpValue casing policy in `docs/Testing.md` and added a CA1711 suppression for the legacy `SymbolRefAttributes` enum so we keep the public API stable without triggering analyzer failures. Verified with `dotnet build src/NovaSharp.sln -c Release -nologo`.
- Naming consistency audit (2025-11-29): Renamed the enum fixtures used in `UserDataEnumsTests` and `UserDataNestedTypesTests` (`MyEnum` → `SampleRating`, `MyFlags` → `SampleFlagSet`, `SomeNestedEnum` → `NestedSampleState`) and updated the Lua strings/registrations so CA1711 no longer fires in the NUnit suite. Verified with `dotnet build src/NovaSharp.sln -c Release -nologo`.
- Naming consistency audit (2025-11-29): Renamed the runtime delegates and validation flags to `ScriptFunctionCallback`/`ScriptFunctionCallback<T>` and `TypeValidationOptions`, updating converters/tests/docs so CA1711/CA1008 are cleared without suppressions. Verified with `dotnet build src/NovaSharp.sln -c Release -nologo`.
- Naming consistency audit (2025-11-29): Pascal-cased the remaining LuaStateInterop helpers (`Memcmp`→`MemoryCompare`, `Strpbrk`→`StringFindAny`, `Tolower`/`Toupper`→`ToLower`/`ToUpper`, `Strncpy`→`StringCopyWithLength`, etc.) plus the `Tools.StringFormat` surface and LuaPort proxy tests. Verified with `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter 'FullyQualifiedName~LuaBaseTests|FullyQualifiedName~LuaStateInteropToolsTests'` and refreshed `naming_audit.log`.
- Naming consistency audit: Continue scanning runtime/debugger/tooling code for other multi-word identifiers that still need PascalCase clean-up. Next focus is taming the legacy LuaPort namespaces (`LuaBase`, `CharPtr`, `TableModule`, etc.) so their CA1707/CA1052 hits disappear without sacrificing the MoonSharp interop story.
- Naming consistency audit (2025-12-01): Eliminated the lingering CA1707 warnings in the user-data field suites by renaming `SomeClass.CONST_INT_PROP` to `ConstIntProp` in both `UserDataFieldsTests` and `VtUserDataFieldsTests`, updated the `NamingAudit` allowlist accordingly, and verified via `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA1707"` (no matches). Follow-up: extend the PascalCase sweep to the remaining LuaPort helpers called out above.
- Naming consistency audit (2025-12-02): Renamed the remaining `_`-prefixed static expectation arrays across the interpreter NUnit suites (BinaryEncoding, Coroutine*, Debug*, Descriptor*, Hardwire, ProxyUserData, SerializationExtensions, StreamFileUserDataBase, UnityAssets, Slice, and the UserData method fixtures) to PascalCase, fixed the internal `StepSequencingDebugger` field regression, and re-ran `python tools/NamingAudit/naming_audit.py --write-log naming_audit.log` so the log now reports zero issues. This clears the 36 outstanding entries from `naming_audit.log` and keeps the analyzer debt focused on the LuaPort namespace cleanup.
- Naming consistency audit (2025-12-03): Locked down the LuaPort `LuaBaseTests` helpers so analyzer noise stays capped—`LuaBaseProxy`/`SampleUserData` are now private to avoid CA1034, `SampleUserData` gets instantiated via a static ctor to keep CA1812 quiet, pointer parameters/local variables were renamed (no more `ptr` identifiers triggering CA1720), and the error helper now uses the `ThrowLuaError` verb so CA1030 stops firing. Verified locally with `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "LuaBaseTests"` (zero hits).
- CA1052 (2025-12-02): Added lightweight instance labels to the `UserDataNestedTypesTests.SomeType`/`SomeNestedType` fixtures, marked `VisibilityFixtures` as a static container, and gave `GenericHost<T>` instance state so Release analyzer runs stop flagging these helpers as static-holder types. Verified with `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA1052"` (no matches) plus `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release`.
- CA1050 (2025-12-05): Wrapped the `UserDataTests` helper hosts (`CustomDescriptorHost`, `RegistryHost`, `ProxySurface`, etc.) inside the `NovaSharp.Interpreter.Tests.Units` namespace so types declared after the main fixture no longer violate CA1050. Verified with `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA1050"` (no matches) and `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter FullyQualifiedName~UserDataTests`.
- CA1032/CA1051/CA1805 (2025-12-05): Added the standard exception constructors to `SkipThisTestException` and `OsSystemModuleTests.ExitFastException`, converted the collections fixture `RegCollItem` to a property-backed type (no more public field exposure), removed the redundant default initializers on the descriptor fixture fields, and scoped their CA1051 suppressions to the specific visibility tests. Also cleared the lingering CA1805 hits in `UserDataNestedTypesTests` and `DispatchingUserDataDescriptorTests`. Verified with `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA1032|CA1051|CA1805"` (no matches) plus `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter FullyQualifiedName~CollectionsBaseInterfGenRegisteredTests`.
- CA1859 (2025-12-05): Updated the collections fixtures (`CollectionsRegisteredTests`, `CollectionsBaseGenRegisteredTests`, `CollectionsBaseInterfGenRegisteredTests`) so `GetEnumerator` now returns `List<int>.Enumerator`, eliminating the boxed `IEnumerator<T>` allocations flagged by CA1859. Confirmed with `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA1859"` (no matches) and `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter FullyQualifiedName~CollectionsRegisteredTests`.
- CA1720/CA1043/CA1721 (2025-12-05): Added targeted `SuppressMessage` attributes for `DynValue.String`, `UserData.Object`, the multi-key `Table` indexer, and `DynValueMemberDescriptor.Value` so we can keep the Lua-facing API surface (typed accessors, user data handle, arbitrary table key sequences, and descriptor property) without violating analyzers. Verified via `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA1720|CA1043|CA1721"` (no matches).
- CA1820 (2025-12-05): Replaced the empty-string equality check in `HardwireCommand.AskQuestion` with `string.IsNullOrEmpty` so CLI prompts no longer trigger CA1820 while also handling `null` console inputs. Confirmed with the same Release build (warning count now 280).
- CS0618 (`CoreModules.None`) (2025-12-05): Replaced every `Script(CoreModules.None)` usage with explicit module selections—Hardwire now uses a `DumpLoaderModules` set (Basic + GlobalConsts + Table + StringLib + Math) and the NUnit suites share `TestCoreModules.BasicGlobals` so descriptor/platform/REPL tests keep minimal globals without depending on the obsolete flag. `rg -n "CoreModules.None"` returns no matches and `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CS0618" | Select-String -NotMatch "CoreModules"` confirms the warning backlog now focuses on `InteropRegistrationPolicy`, `DebuggerAction`, and `StringConversions` cleanup.
- CS0618 (`StringSubtype.None`, `InteropRegistrationPolicy.Explicit`, `PlatformAccessorBase.DefaultInput`) (2025-12-05): Stopped referencing the obsolete string subtype constant by comparing against/pass around `default(StringSubtype)`, rewrote the registration policy tests to fetch the legacy property via reflection (keeping the obsolete attribute assertions without using the property directly), and updated the platform accessor tests to rely on the prompt overload instead of the deprecated parameterless `DefaultInput`. Release builds now show 260 warnings (`dotnet build src/NovaSharp.sln -c Release -nologo`), with the remaining CS0618 hits isolated to `DebuggerAction.ActionType.Unknown`.
 - CS0618 (`DebuggerAction.ActionType.Unknown`) (2025-12-05): Converted every test harness to use `DebuggerAction.ActionType.None` when representing “no pending action,” so the processor debugger tests still validate queueing/mode transitions without touching the obsolete enum member. Current Release builds report 238 warnings, with CS0618 now absent entirely (`dotnet build src/NovaSharp.sln -c Release -nologo | Select-String \"CS0618\"`).
- CA1305 (2025-12-05): `ScriptLoadTests` now parses the frozen start timestamp via `DateTimeOffset.Parse(..., CultureInfo.InvariantCulture)`, and the signed/unsigned enum descriptor tests compare against `Convert.ToInt64/ToUInt64` calls that pass `CultureInfo.InvariantCulture`, eliminating their locale-sensitive conversions. Follow-up fixes removed the bin-dump/message helpers by switching their `ToString`/`string.Format` calls to invariant overloads (`BinDumpStreamTests`, `TestRunner.FormatString`, `UserData*FormatUnchecked`, and `UserDataEnumsTests`). The user-data method fixtures also gained invariant join helpers for their recursive listing routines, so `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA1305"` now returns no matches.
- CA1825 (2025-12-05): Replaced the temporary `new byte[0]` allocation in `ScriptLoadTests.DumpRejectsReadOnlyStreams` with `Array.Empty<byte>()`, eliminating the analyzer warning without changing test semantics. Verified via `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA1825"` (now zero hits; previously only this test triggered the rule).
- CA1812 (2025-12-05): `UserDataNestedTypesTests.SomeType` now eagerly instantiates its private nested helper via a static constructor so the analyzer sees a concrete usage; this clears the final CA1812 warning in the interpreter suite. Verified with `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA1812"` (no matches).
- CA1510 (2025-12-05): Swapped the manual null guards in `ScriptTestExtensions.Evaluate` for `ArgumentNullException.ThrowIfNull`, clearing the final CA1510 warnings reported in the interpreter tests. Release builds confirm zero occurrences (`dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA1510"`).
- CA2263 (2025-12-02): Taught `CustomConverterRegistry.SetClrToScriptCustomConversion<T>` (and the obsolete overload) to remove converters when called with `null`, switched `CustomConverterRegistryTests` to use the strongly typed overload, and updated the `UserDataTests` composite/descriptor assertions to rely on the generic register/resolve helpers. `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA2263"` now reports zero matches, validated via `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release`.
- CA1001 (2025-12-02): Converted the CLI command fixture suites (`ExitCommandTests`, `HelpCommandTests`, `RegisterCommandTests`) plus `IoModuleVirtualizationTests` to implement `IDisposable` (relying on the shared `ConsoleCaptureScope` where appropriate) so all console/platform capture scopes are disposed deterministically. Verified via `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA1001"` (no matches) and `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release`.
- CA1031 (2025-12-02): Hardened the CLI command path by catching explicit IO/security exceptions in both `RunCommand.ResolveScriptPath` and `Program.ResolveScriptPath`, constrained the REPL loop to only swallow known recoverable exceptions (IO/argument/format/unauthorized) via filters, and taught `HardwireCommand.Generate` plus the interpreter tests (`UserDataMethodsTests`, `ProcessorTests`) to rely on specific exception types instead of blanket `Exception` handlers. `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA1031"` now reports no matches, confirmed via `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release`.
- CA1034 (2025-12-03): Started trimming the remaining nested public fixtures by collapsing `ConfigPropertyAssignerTests.MySubclass` to a private helper (and instantiating it inside `Test` so analyzers see a concrete usage). `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "ConfigPropertyAssignerTests"` now returns no matches, so the CA1034 list shrank by one without introducing CA1812/CA1823 regressions.
- CA1034 (2025-12-03): Tightened `ProxyObjectsTests.Proxy` to a private sealed helper so the proxy registration stays local to the fixture. `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "ProxyObjectsTests"` now only reports the existing CA5394 `Random` warning (no more CA1034 hits), keeping the analyzer backlog moving in the right direction.
- CA1034 (2025-12-03): Scoped `MetatableTests.MyObject` down to `internal sealed` so the user-data sample stops exporting nested test scaffolding. Confirmed with `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "MetatableTests"` (no CA1034 warnings).
- CA1034 (2025-12-03): Made the `CollectionsRegisteredTests` helpers (`RegCollItem`, `RegCollMethods`) private so the collection registration samples no longer leak nested test types. `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CollectionsRegisteredTests"` now only reports the pre-existing CA1814/CA1859 hits.
- CA1034 (2025-12-03): Applied the same visibility tightening to `CollectionsBaseGenRegisteredTests` (`RegCollItem`, `RegCollMethods`), so the generic collection fixture is now CA1034-free. Verified via `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CollectionsBaseGenRegisteredTests"` (only CA1814/CA1859 remain).
- CA1034 (2025-12-04): Converted every EndToEnd user-data helper (including the Vt variants and `StructAssignmentTechnique`) to internal-only nested types and downgraded the extension-method hosts (`OverloadsExtMethods*`, `VtOverloadsExtMethods`) so reflection still discovers the `this` helpers without leaking public nested types. `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA1034"` now returns no matches, and `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter "FullyQualifiedName~UserData"` exercises the touched suites.
- CA1034 (2025-11-25): Scoped the nested helpers in `RegisterCommandTests`, `ParameterDescriptorTests`, `FrameworkCurrentTests`, `HardwireCodeGenerationContextTests`, `HardwiredUserDataDescriptorTests`, `HardwireGeneratorRegistryTests`, `DispatchingUserDataDescriptorTests`, `EventMemberDescriptorTests`, `PropertyTableAssignerTests`, `StandardGenericsUserDataDescriptorTests`, and `UnityAssetsScriptLoaderTests` down to private fixtures and added static constructors that instantiate the analyzers' targets so CA1812/CA2000 stay green. `dotnet build src/NovaSharp.sln -c Release -nologo` now reports CA1034 only for `DescriptorHelpersTests`, keeping the remaining backlog isolated to that suite.
- CA1034 (2025-11-25 follow-up): Finished the DescriptorHelpers sweep by downgrading every nested helper (`VisibilityTargets`, `VisibilityFixtures`, member/property/meta fixtures, etc.) to private containers, sealing the sub-types that don't rely on `protected` members, and adding targeted suppressions for the handful of fixtures that must stay non-sealed for visibility testing. A static constructor now instantiates the helper graph so CA1812 stays quiet, and protected-only types are activated via `Activator.CreateInstance` to keep the metadata paths intact. `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA1034"` returns no matches, so the warning backlog can move on to the remaining analyzer buckets.
- CA1510 (2025-11-25): Updated the interpreter test helpers (`TestRunner.FormatString`, `UserDataOverloadsTests.FormatUnchecked`, `VtUserDataOverloadsTests.FormatUnchecked`, `VtUserDataMethodsTests.FormatUnchecked`, `TestHelpers.CreateExecutionContext`, and `TestUtilities.TestWaitHelpers.SpinUntil`) to use `ArgumentNullException.ThrowIfNull` so the analyzer no longer flags manual throws. Verified locally with `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA1510"` (no matches).
- CA2007 (2025-11-25): Taught `BlockingChannelTests` to call `.ConfigureAwait(false)` on every awaited `Task.Delay`/`WaitAsync` so the async analyzer no longer reports “Consider calling ConfigureAwait”. Validated with `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA2007"` (no matches).
- CA1860 (2025-11-25): Replaced `.Any()` checks on array results throughout `TestRunner` and `LuaTestSuiteExtract` with direct `Length`/`Count` comparisons so the analyzer’s “prefer comparing Length to 0” guidance is satisfied. Confirmed with `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA1860"` (no matches).
- CA2249 (2025-11-25): Swapped the `string.IndexOf(..., StringComparison.Ordinal)` call inside `IoModuleVirtualizationTests.ModeContains` with the char overload so the analyzer’s “use string.Contains/char overloads” guidance is satisfied. Verified via `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA2249"` (no matches).
- CA1034 next steps: keep the zero-warning bar enforced by rejecting new public nested fixtures (especially inside descriptor/unit harnesses and Unity loaders) so `NovaSharp.Interpreter.Tests` stays analyzer-clean.
- CA1303 (2025-12-02): Completed the CLI string sweep by introducing `CliMessages` and routing every `Console.Write*` call (including the hardwire logger prefixes, manifest/compatibility banners, and command metadata) through those helpers. Updated the Help/Exit/Register/Hardwire/ShellCommandManager/Program NUnit suites to assert against the new message constants, fixed the `CustomConverterRegistryTests` ambiguity introduced by the typed overloads, and reran `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release` to lock in the changes.
- CA1304/CA1311 (2025-12-07): Eliminated the remaining culture-dependent casing paths inside the user-data method suites by switching every `ToLower`/`ToUpper` call in `UserDataMethodsTests` and `VtUserDataMethodsTests` (including the `StringBuilder` converter hook) to their invariant counterparts. Verified with `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --no-build --filter "FullyQualifiedName~UserDataMethodsTests|FullyQualifiedName~VtUserDataMethodsTests"` and confirmed `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA1304|CA1311"` now reports no hits from those fixtures.
- CA1307 (2025-12-07): Updated `IoModuleVirtualizationTests.InMemoryPlatformAccessor.ModeContains` to use the `string.Contains(char, StringComparison.Ordinal)` overload so Release builds stop flagging the `io` virtualization harness. Exercised via `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --no-build --filter FullyQualifiedName~IoModuleVirtualizationTests`, and `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA1307"` now returns no matches.
- CA1002 (2025-12-07): Tightened `CollectionsBaseInterfGenRegisteredTests` so the helper methods now expose `IList<T>` instead of `List<T>`, keeping the mutation semantics needed by the Lua interop exercises without violating the "Do not expose List<T>" rule. Validated with `dotnet test ... --filter FullyQualifiedName~CollectionsBaseInterfGenRegisteredTests`, and `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA1002"` no longer reports those warnings.
- CA2225 (2025-11-24): Added friendly `CharPtr.FromString`/`FromCharArray`/`FromByteArray` factory helpers plus static/instance `Subtract` and `Compare` methods so the LuaPort pointer conversions, subtraction, and relational operators all have analyzer-approved alternates. `CharPtrTests.FriendlyAlternatesMirrorOperatorBehaviour` exercises the new APIs, and `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release` confirms the Lua interop surface stays green.
- CA1052 (2025-11-24): Converted the LuaPort base infrastructure to true static holders by making `LuaBase` (all partials) and `KopiLuaStringLib` static/internal, rewiring `ModuleRegister` + the NUnit proxy helpers to use the direct APIs, and flipping the table/iterator/string meta modules to static classes. `MetatableTests` now registers static modules via `RegisterModuleType(table, typeof(...))`, so Release builds keep the Lua module reflections working without instantiation and the LuaPort rename fallout stays analyzer-clean. Verified with `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release`.
- CA1051 (2025-11-24): Scoped the LuaPort `CharPtr` buffer/index fields down to `internal`, keeping the pointer semantics in-assembly (ModuleRegister/LuaPort helpers/tests still see them via `InternalsVisibleTo`) while removing the externally visible instance fields that analyzers flagged. `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release` confirms the tighter surface does not break Lua interop.
- CA2263 (2025-11-24): Updated the outstanding interpreter/interop tests to use the generic `UserData`/`DynValue` helpers (`HardwiredDescriptor(s)Tests`, `LuaBaseTests`, `UserDataTests`, `DynValueTests`, `StandardGenericsUserDataDescriptorTests`, plus the collections end-to-end suites), eliminating the remaining `Prefer the generic overload` warnings without touching generated fixtures. Verified with `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release`.
- CA1859 (2025-11-24): Tightened the remaining interpreter tests that were storing instances behind interface/base types for no reason: `BinaryEncodingTests` now keeps a strong `BinaryEncoding` reference, `SliceTests` initializes concrete `List<T>` instances, `DescriptorHelpersTests` returns `MethodInfo` from the helper, `FieldMemberDescriptorTests` exercises the optimizer via direct casting, `DispatchingUserDataDescriptorTests` exposes its concrete descriptor factory, and the Simple CLI callback tests capture `DynValue[]` args directly. `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release` confirms the analyzer noise is gone.
- Foreach allocation audit (2025-11-26): Reworked the extension/module registries to iterate over cached `MethodInfo[]`/`FieldInfo[]` buffers, replaced the debugger/watch refresh logic and `DispatchingUserDataDescriptor` optimizer with direct dictionary traversal, and removed the remaining LINQ helpers in Script bytecode notifications, closure creation, iterator statement binding, IO/file helpers, and descriptor metadata builders. Added the allocation policy to `docs/Modernization.md` so future contributors follow the same pattern.
- CA1819 (2025-12-04): Added targeted suppressions for `DynValue.Tuple`, `TailCallData.Args`, and `YieldRequest.ReturnValues` to document why these tuple/continuation surfaces must expose their backing arrays (avoids copying Lua varargs and coroutine payloads). `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA1819"` now returns no matches.
- CA1814 (2025-12-06): Scoped `SuppressMessage` annotations onto the `_multiArray` fields and `GetMultiArray` helpers inside `CollectionsRegisteredTests`, `CollectionsBaseGenRegisteredTests`, and `CollectionsBaseInterfGenRegisteredTests` so the end-to-end suites can keep true multidimensional arrays for Lua iterator/indexing coverage without tripping the analyzer. Verified with `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA1814"` (no matches); keep any future rectangular-array fixtures justified the same way.
- CA1003 (2025-12-06): Added explicit suppressions for the intentionally-invalid `ReturnsValue`, `ValueParameter`, `ByRefParameter`, and `TooManyArguments` events in `EventMemberDescriptorTests.IncompatibleEventSource`, documenting that these signatures must stay non-EventHandler-based to exercise the descriptor rejection paths. Confirmed via `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "CA1003"` (no matches) so the analyzer backlog stays focused on real production issues.
- CA1008/CA1028 (2025-12-06): Updated the `SampleRating` and `SampleFlagSet` enums in `UserDataEnumsTest` to use the default `int` backing type and added explicit `None = 0` members so analyzer guidance on zero-valued flags/ratings is satisfied without altering the Lua interop semantics. `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String \"CA1008|CA1028\"` now returns no matches.
- CA1802 (2025-12-06): Reworked the static readonly constants flagged in the Release log—`PerformanceStatisticsTests.ExecutionCounter` and `RemoteDebuggerTests.ServerOptions` are now `const`, while `FieldMemberDescriptorTests.SampleFields.ReadonlyValue` uses `new string(...)` so it remains a genuine readonly field for reflection coverage. `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String \"CA1802\"` now returns no matches.
- CA1034/CA1815/CA1810 (2025-12-06): Reworked `UserDataNestedTypesTests` so the nested helper types now live beside the fixture (with explicit `IEquatable`/operator overrides for the value-type variants) and documented the handful of public nested classes that must stay exposed for Lua coverage via targeted `[SuppressMessage("Design","CA1034", ...)]` attributes. Private nested helpers now carry CA1812 suppressions instead of static-constructor anchors. Verified with `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "UserDataNestedTypesTests"` and `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter FullyQualifiedName~UserDataNestedTypesTests`.
- After each sweep rerun `dotnet build src/NovaSharp.sln -c Release -nologo | Select-String "warning"` and log counts per CA rule; the solution build now fails on warnings automatically, so capture any new suppressions (rule, justification, owner) in `PLAN.md` + `docs/Testing.md` as soon as they land.

### 2. Coverage and test depth
- Refresh artefacts: rerun `./scripts/coverage/coverage.ps1` (Release, gate = enforce) so `docs/coverage/latest/*` and `docs/coverage/coverage-hotspots.md` describe the 2,779-test suite.
- Interpreter: add debugger/coroutine regression tests that drive pause-during-refresh, queued actions that drain after a pause, forced resume, and message decoration paths so branch coverage climbs from 92.9% to ≥95%.
- Tooling: extend NovaSharp.Cli tests beyond current command-unit coverage (record REPL transcripts and golden outputs) and build Hardwire generator tests that validate descriptor generation/error handling, targeting ≥80% line coverage for each project.
- Debuggers: add headless VS Code + Remote Debugger smoke tests (attach/resume/breakpoint/watch evaluation) to push NovaSharp.VsCodeDebugger line coverage past 50% and NovaSharp.RemoteDebugger branch coverage above 85%.
- Replace skipped IO/OS TAP suites with NUnit fixtures so Release runs exercise those semantics without Lua harnesses.
- CLI integration (2025-12-08): Added `CliIntegrationTests` that drive `Program.CheckArgs` with a real script file (verifies the compatibility banner + script output), exercise both the `-X help` and `-W ...` hardwire command-line flows (with generation verified on disk), and run the REPL loop via redirected stdin/stdout (covering `=expr` evaluation plus the `!help`, `!register`, `!compile`, and `!debug` dispatch paths with injected debugger stubs). This gives us end-to-end coverage of the prompt, scripted `run`, and multiple command surfaces without relying on TAP harnesses.
- OS TAP parity (2025-12-04): Added Lua `os` library regression coverage (`OsSystemModuleTests`) for `os.date` (UTC tables, formatting, invalid specifiers, `%Oy` two-digit year), `os.clock`, `os.difftime`, and `os.time` round-trips/missing field errors so the TAP `309-os.t` expectations now run under NUnit. Verified via `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter "FullyQualifiedName~OsSystemModuleTests"`. Continue migrating the remaining TAP cases (e.g., `io.popen` sandbox fallbacks) into managed tests.
- OS TAP parity (2025-12-07): Extended `OsSystemModuleTests` with queued `os.tmpname` coverage (sequential names fall back to the platform default) and exception propagation checks so Lua scripts observe host failures the same way the TAP suite expects. Verified with `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter FullyQualifiedName~OsSystemModuleTests`. Remaining TAP focus is primarily on the `io.popen` scenarios.
- OS TAP parity (2025-12-08): Updated `os.execute` to return the Lua 5.4 status tuple `(true|nil, "exit"|"signal", code)` and expanded `OsSystemModuleTests` to cover success, non-zero exits, signal-style errors, and platform-not-supported messages. This mirrors the TAP expectations without enabling process spawning by default; validated with `dotnet test ... --filter FullyQualifiedName~OsSystemModuleTests`.
- IO TAP parity (2025-12-04): Ported additional `308-io.t` scenarios into `IoModuleTests` (standard stream close errors plus handle-based `:lines()` iteration, including chunked reads) so we can eventually retire the TAP harness. Verified locally with `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter \"FullyQualifiedName~IoModuleTests\"`. Continue migrating the remaining TAP cases (e.g., `io.popen` fallbacks, IO buffering edge cases, OS module behaviours) into NUnit.
- IO TAP parity (2025-12-07): Added NUnit coverage for the `io.read` variants (`*L`, zero-length, multi-length tuples), closed-handle guardrails (`:read`, `:seek`, `:write`), `setvbuf` success paths, and `io.stderr:flush()` so the `308-io.t` behaviours run under `IoModuleTests`. Validated with `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter FullyQualifiedName~IoModuleTests`. Remaining TAP parity items still include `io.popen` fallbacks and stdin piping.
- IO TAP parity (2025-12-07): Wired `io.popen` to an explicit "unsupported" stub so Lua scripts receive a deterministic `ScriptRuntimeException` instead of calling a nil global, and added `IoModuleTests.PopenIsUnsupportedAndProvidesErrorMessage` to mirror the TAP fallback path. This keeps security-sensitive hosts locked down while documenting the limitation; full process piping support remains future work.
- IO TAP parity (2025-12-08): Enabled the argument-free `io.lines()` path so it reads from the active stdin handle and added NUnit coverage for both `io.lines()` and `io.read()` consuming input from `IoModule.SetDefaultFile`, mirroring the `320-stdin.t` scenarios without invoking `io.popen`. Verified with `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter FullyQualifiedName~IoModuleTests`. Outstanding TAP parity now centers on the intentionally unsupported `io.popen` flows.
- Observability: enhance the GitHub coverage job to compare the new `Summary.json` against the last successful run and fail on ≥3 percentage point regressions; archive history under `artifacts/coverage/history`.

### 3. Debugger and tooling automation
- Build a DAP test harness that drives NovaSharp.VsCodeDebugger end-to-end (launch, attach, breakpoints, watches) without requiring VS Code, and feed its transcripts into NUnit.
- Add CLI integration tests that execute scripted sessions (stdin/stdout golden files) covering success/failure paths for `run`, `register`, `debug`, `compile`, `hardwire`, and `help` commands.
- Stand up remote-debugger smoke tests that exercise HTTP attach, TCP streaming, queue draining, and error signaling; add golden payload assertions so regressions show up in diffs.
- Expand CI beyond Linux so debugger + CLI automation also run on Windows and macOS, matching the platforms we claim to support.

### 4. Runtime safety, sandboxing, and determinism
- Design Lua sandbox profiles that toggle risky primitives (file IO, environment variables, OS commands, reflection hooks) and expose host-driven policies via `ScriptOptions`; document the behaviour in `docs/LuaCompatibility.md`.
- Add configurable ceilings for time, memory, recursion depth, coroutine counts, and table growth along with watchdog callbacks so runaway mods cannot stall hosts.
- Introduce a deterministic execution mode (stable PRNG seeding, invariant formatting, deterministic iteration where Lua allows) for lockstep multiplayer/replays.
- Provide per-mod isolation containers plus load/reload/unload hooks so mods do not leak state across sessions.

### 5. Packaging, performance, and runtime ergonomics
- Unity onboarding: automate UPM/embedded packaging, refresh the sample scenes, and capture IL2CPP/AOT caveats in `docs/UnityIntegration.md`; wire the packaging script into CI.
- Packaging pipeline: publish redistributable runtime bundles/NuGet packages with versioning/signatures and document the workflow in release notes.
- Enum allocation audit: port the allocation-free flag helpers/name maps to remove `Enum.HasFlags`/`ToString()` allocations on hot paths; add benchmarks and NUnit coverage.
- Custom collections: audit `LinkedListIndex`, `FastStack`, `MultiDictionary`, etc. for BCL parity, replace `ContainsKey`+indexer patterns with `TryGetValue`, and document preferred usage.
- Performance regression harness: run BenchmarkDotNet (runtime + comparison suites) in CI/nightly, capture allocation deltas, and require `docs/Performance.md` updates when numbers move.
- Investigate high-performance string/IO libraries (e.g., ZString) and prototype them in parser/IO hotspots without harming readability or Unity compatibility.
- String operations audit: inventory the runtime/tooling string formatting, concatenation, and builder-heavy paths, evaluate whether ZString or compiler-generated interpolation can replace ad-hoc `StringBuilder` usage, and document any trade-offs (Unity/IL2CPP safety, culture invariance) before landing changes.
- Interpreter hot-path optimization: profile the Lua VM (instruction loop, stack ops, call/return pipelines) to identify heap allocations and branch mispredictions, then prototype zero-allocation strategies (array/object pools, bit-packed instruction metadata, custom data structures, ZLINQ/ZString integration) and document measured wins before rolling them out broadly.
- I/O throughput audit: benchmark every runtime/tooling I/O surface (script loaders, REPL streams, debugger transports, file/tcp helpers), minimize allocations via pooling/buffering, and consider high-performance libraries (e.g., pipelines, Span-based readers) while keeping Unity/IL2CPP compatibility intact.
- Whole-runtime optimization pass: schedule iterative sweeps (excluding test code) that profile each subsystem, track allocations/instructions, and apply aggressive optimizations (custom data structures, pooling, bit packing, low-level intrinsics) where they deliver measurable wins without breaking API/back-compat.

### 6. Tooling, docs, and contributor experience
- Roslyn code generation milestone: design and prototype source generators/analyzers for NovaSharp descriptors/mod code, then document how to consume them.
- Documentation & samples: adopt DocFX (or similar), publish compatibility matrices/tutorials, refresh Unity/modding guides, and automate doc generation in CI.
- Compatibility corpus: expand CI to run Lua TAP suites, community mod packs, and script corpora across Windows, macOS, Linux, and Unity editor builds; track the matrix in `docs/Testing.md`.
- Style/quality automation: extend lint to reject runtime changes that lack matching tests (unless `[NoCoverageJustification]` is present), enforce `_camelCase` fields, and ensure new scripts/docs update the relevant indexes.

### 7. Outstanding investigations
- Confirm `pcall`/`xpcall` semantics when CLR callbacks yield; add regression tests or update runtime behaviour to match Lua 5.4 if needed.
- Decide whether `SymbolRefAttributes` should be renamed to satisfy CA1711 or if a documented suppression is acceptable; capture the outcome in this plan and analyzer settings.

### 8. Concurrency and synchronization audit
- Inventory every `lock`, `Monitor`, and ad-hoc concurrency helper across runtime, tooling, and debugger code. Document each critical section’s purpose, contention risk, and whether a `ReaderWriterLockSlim`, `SemaphoreSlim`, or lock-free primitive would improve scalability without hurting determinism.
- Identify shared collections that still use `List<T>`/`Dictionary<T>` under concurrent access (e.g., debugger server lists, HTTP caches, tooling registries). Where appropriate, switch to `ConcurrentDictionary<T>`/`ImmutableArray<T>` or add guarding APIs instead of external locks.
- Validate that dispose paths, async callbacks, and network events cannot deadlock (double-lock patterns, nested locks across types). Capture any required lock-ordering guidance in `docs/Modernization.md`.
- Benchmark contention-sensitive paths (RemoteDebugger queues, interpreter hook dispatch, CLI registries) before swapping primitives; keep measurements in `docs/Performance.md` so future changes have baselines.
- Produce a checked-in concurrency inventory (e.g., `docs/modernization/concurrency-inventory.md`) that lists every `lock`/`Monitor`/`SemaphoreSlim` usage, captures contention risk, and calls out candidates for `ReaderWriterLockSlim`/lock-free swaps so future reviewers can reason about synchronization at a glance.

## Lua specification parity
- Keep the Lua 5.4 parity matrix in `docs/LuaCompatibility.md` up to date; cite manual sections for every behaviour we touch.
- Extend the compatibility-mode surface so hosts can opt into Lua 5.1, 5.2, 5.3, or 5.4 semantics (chunk loading rules, standard library variants, coroutine differences) via `ScriptOptions`/`LuaCompatibilityProfile`, and back each mode with targeted NUnit + spec-harness coverage plus docs describing supported toggles.
- Extend the spec harness beyond the existing string suite (math, table, utf8, coroutine, debug, IO) and store fixtures beside the NUnit TAP corpus.
- Integrate the spec harness into CI so spec regressions fail builds; document the workflow in `docs/testing/spec-coverage.md`.
- Golden rule: when a regression test fails, assume production is wrong until the Lua 5.4 manual proves otherwise; prefer fixing runtime behaviour over weakening tests.

## Long-horizon ideas
- Property and fuzz testing for the lexer, parser, and VM instruction boundaries.
- Golden-file assertions for debugger protocol payloads and CLI output.
- Native AOT/trimming validation once the runtime stack is fully nullable-clean.
- Automated allocation regression harnesses using BenchmarkDotNet diagnosers or `dotnet-trace`.

Keep this plan aligned with `docs/Testing.md` and `docs/Modernization.md`, and update it whenever coverage artefacts, warning counts, or milestone statuses change.
