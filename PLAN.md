# Modern Testing & Coverage Plan

## Modernization Baseline (NovÂ 2025)
- âœ… Core runtime, debuggers, hardwire tooling, CLI shell, benchmarks, and automated tests now target **`netstandard2.1`** (runtime) and **`net8.0`** (tooling).
- âœ… Legacy `.NET 3.5/4.x`, Portable Class Library, WindowsÂ 8/Phone, Silverlight, Unity, Xamarin, and NuGet test harness projects removed from the tree.
- âœ… Solution simplified to `src/NovaSharp.sln`; obsolete `NovaSharp_*` variants deleted.
- âœ… Benchmark infrastructure rebuilt on BenchmarkDotNet with shared `PerformanceReportWriter` writing OS-specific results to `docs/Performance.md`; benchmarks remain local-only by design.
- âœ… Documentation refreshed: `docs/Performance.md`, `docs/Testing.md`, `docs/Modernization.md`, and README now describe the modern stack and link together.
- âœ… Consolidated interpreter tests under `src/tests/NovaSharp.Interpreter.Tests`; retired the bespoke DotNetCoreTestRunner harness.

- ## Testing Health Snapshot
- âœ… Runtime semantics target **Lua 5.4.8**; see `docs/LuaCompatibility.md` for tracked deltas and follow-ups.
- Runner: `src/tests/NovaSharp.Interpreter.Tests` (`net8.0`) executes **1095 tests** (Lua TAP suites `TestMore_308_io` and `TestMore_309_os` stay disabled unless explicitly enabled).
- Command: `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --logger "trx;LogFileName=NovaSharpTests.trx"` is the canonical entry point; the bespoke TAP harness has been removed.
- Coverage: `scripts/coverage/coverage.ps1` (coverlet.console + `dotnet test` + reportgenerator) records **74.9â€¯% line / 75.5â€¯% branch / 78.5â€¯% method** against Release binaries (NovaSharp.Interpreter at 87.1â€¯% line); raw artefacts + Markdown/JSON summaries live in `artifacts/coverage`, HTML in `docs/coverage/latest`.
- Suite composition:
  - **Lua TAP fixtures** validating language semantics and standard library parity.
  - **End-to-end NUnit scenarios** covering userdata interop, debugger attach, coroutine pipelines, serialization, JSON.
  - **Unit tests** for low-level primitives (virtual machine stacks, binary dump/load, interop policies).
- CI (`.github/workflows/tests.yml`):
  - Restores and builds `src/NovaSharp.sln` in Release.
  - Executes `dotnet test` against `NovaSharp.Interpreter.Tests` and uploads `artifacts/test-results` (TRX + attachments).
  - The `code-coverage` job runs `./scripts/coverage/coverage.ps1`, appends the Markdown summary to the job output, posts a PR comment (line/branch/method), and uploads both raw coverage data and a zipped HTML dashboard.
- Benchmarks (`NovaSharp.Benchmarks`, `NovaSharp.Comparison`) compile but never run in CI; they must be invoked manually to update `docs/Performance.md`.

## Coverage Strengths
- Lua semantics, coroutine scheduling, binary dump/load, JSON, interop policy, and hardwire regeneration paths have broad regression protection.
- TAP fixtures catch regressions against upstream Lua behaviour.
- Benchmark baselines establish performance + allocation expectations for script loading and runtime scenarios.

## Gaps & Risks
- **Debugger automation**: No integration tests for VSÂ Code or remote debugger protocols.
- **Tooling**: CLI shell and remaining tooling projects lack regression coverage after modernization.
- **Cross-platform**: CI only runs on Linux; Windows/macOS coverage still manual.
- **Observability**: Coverage summaries now post automatically on PRs, but there is still no gating/threshold enforcement or historical trend tracking.
- **Skip-list debt**: IO/OS TAP suites remain permanently skipped without compensating coverage.
- **Unity onboarding**: Basic packaging workflow is documented in `docs/UnityIntegration.md`; still need automated packaging and refreshed Unity samples.
- **Enum allocation audit**: .NET `Enum.HasFlags` and default `ToString()` allocate; add follow-up to port the no-alloc helpers from DxMessaging/UnityHelpers (bitmask tests + generated name maps) so enum-heavy interpreter paths stay allocation-free while keeping user-friendly names.
- **Warning hygiene**: Fix all existing compiler/analyzer warnings and flip `TreatWarningsAsErrors` on across every project so Release builds (and `scripts/coverage/coverage.ps1`) stay green without manual suppressions.
  - âœ… Compiler warnings (`CS*`) now fail the build via solution-wide `WarningsAsErrors`; `dotnet build src/NovaSharp.sln -c Release` succeeds with zero CS diagnostics, and `dotnet test â€¦ --no-build` passes 1â€¯499 cases.
  - ğŸ”„ Triage the remaining analyzer warnings (CA*) project-by-project, land suppressions only where behaviourally required, and plan to promote CA diagnostics to errors once the backlog is cleared.
  - ğŸ”„ Rerun `./scripts/coverage/coverage.ps1` after the CA backlog is resolved so the regenerated reports reflect the new warning hygiene and remain publishable without manual intervention.
- **Runtime security modes**: Design configurable Lua sandbox profiles that disable or stub risky primitives (file IO, env vars, OS commands, reflection hooks) and provide host-controlled policies for multi-tenant deployments.
- **Resource/QoS sandboxing**: Add configurable ceilings for time, memory, recursion depth, table growth, and coroutine counts so runaway mods canâ€™t stall the game loop; expose watchdog hooks for graceful termination.
- **Deterministic execution profile**: Define and test a â€œdeterministic modeâ€ (stable PRNG seeding, locale-neutral formatting, deterministic iteration where Lua allows) to support lockstep networking and replays.
- **Mod isolation lifecycle**: Provide per-mod state containers, controlled export/import mechanics, and load/reload/unload events to prevent mods from trampling each other or leaking state across sessions.
- **Packaging & deployment pipeline**: Document and automate mod packaging (versioning, signatures, compression) and produce redistributable runtime bundles/NuGet packages plus sample integration stubs.
- **Observability & diagnostics**: Build structured logging, per-mod profiling (time/allocations), execution tracing, and crash report surfacing so hosts can debug and monitor mods in production.
- **Host API surface review**: Specify a stable C#/Lua interop contract (events, async bridging, error propagation), include analyzers/templates, and generate docs to keep exposed APIs safe and versionable.
- **Lua version parity audit**: Extend spec harness/tests to cover supported Lua versions (5.1â€“5.4) including bit32/utf8/goto/coroutine differences, and document any intentional deviations for modders.
- **RNG parity & quality**: Match Lua 5.4â€™s PCG32 sequence for `math.random`/`math.randomseed`, and expose optional higher-quality PRNGs (xoroshiro/xoshiro) without breaking deterministic mods.
- **Math & locale neutrality**: Audit `math`/`string` formatting vs Lua spec (handling of NaN, infinity, modulo, locale) and enforce invariant culture so mod behavior is stable across hosts.
- **Integer & bitwise semantics**: Validate 64-bit integer operations, overflow, and bit shifts against Luaâ€™s reference behavior; align or document any differences.
- **Coroutine & metamethod conformance**: Expand spec tests for nested yields, pcall/xpcall interactions, and metamethod trigger order to mirror the Lua VM.
- **Table iteration determinism**: Confirm insertion/iteration behavior matches Luaâ€™s expectations, avoiding .NET dictionary ordering surprises for modded state.
- **GC behavior parity**: Document .NET GC differences vs Luaâ€™s incremental collector and evaluate exposing Lua-style pause/step knobs so mods relying on GC tuning remain predictable.
- **Debug hook fidelity**: Ensure `debug.sethook`, stack traces, and traceback formatting match Luaâ€™s behavior so profiling tools and mod debuggers work transparently.
- **Bytecode handling policy**: Decide whether NovaSharp loads Lua bytecode; if supported, implement version checks and sandbox hardening, otherwise document the text-only stance.
- **Module searchers & paths**: Align `require`/`package.searchpath` resolution (case sensitivity, separators, LUA_PATH inheritance) with stock Lua for cross-platform mod portability.
- **Numeric mode consistency**: Audit integer/float handling (wraparound, `%` on negatives, `math.tointeger`) to guarantee Lua 5.3+/5.4 semantics.
- **UTF-8 library coverage**: Verify `utf8` API parity (surrogate handling, error returns) with Luaâ€™s reference implementation.
- **OS/IO abstraction parity**: Normalize newline, path separator, and timezone behaviors across platforms so mods behave consistently.
- **Threading model guidance**: Define main-thread-only rules, provide safe queues or schedulers if background jobs are needed, and guard against multi-thread misuse.
- **Hot-reload resilience**: Add lifecycle hooks and cleanup strategies so mod reload/unload frees resources (events, timers, coroutines) without leaking or crashing.
- **Error surfacing parity**: Match Luaâ€™s error objects and stack level reporting, ensuring `pcall`/`xpcall` return contracts remain intact despite C# exceptions.
- **Floating-point determinism**: Evaluate CPU/runtime variability; consider fixed-point or deterministic options for lockstep networking scenarios.
- **Sandbox escape audit**: Catalogue interop/reflection entry points that could bypass security modes and add mitigations or documentation.
- **Mod SDK & docs**: Produce modder-facing SDK artifacts (API docs, templates, analyzers) and automation for keeping documentation in sync with runtime releases.
- **Frame-time budgeting**: Introduce per-frame execution budgets/watchdogs so Lua scripts canâ€™t stall Unityâ€™s main thread; expose host callbacks for enforcement.
- **Unity coroutine helpers**: Provide scheduling utilities that bridge Lua coroutines with Unityâ€™s Update/Coroutine loops for smooth frame-by-frame execution.
- **Unity API exposure**: Define safe, tested wrappers for the subset of Unity APIs accessible to Lua (threading rules, async helpers) and document constraints.
- **Mod asset pipeline**: Design asset ingestion (addressables/bundles, size limits) so Lua mods can load textures/audio safely without violating sandbox rules.
- **Mod tooling & debugging**: Ship a debug console/REPL, stack inspectors, and editor integration to help modders diagnose runtime issues in Unity builds.
- **Mod onboarding templates**: Provide starter projects, NuGet/UPM packages, and sample mods illustrating secure patterns and recommended architecture.
- **Mod versioning & compatibility**: Define manifest metadata and compatibility checks so the host can warn about API/engine mismatches before loading mods.
- **Crash containment UX**: Wrap mod entry points with resilient error handling, surface friendly UI in-game, and allow restart/reload without killing the session.
- **Runtime analytics hooks**: Offer optional telemetry hooks (usage/perf metrics) that hosts can enable to monitor mod health in the field.

## Coverage Burn-down Checkpoint (Latest)
â€¢ Progress
  - ğŸ”„ Mirrored the Lua `<close>` TAP checks locally by adding `TestMore/310-close-var.t` + the `TestMore310CloseVar` NUnit shim so return, goto/break, and nested-closure unwinds (Â§3.3.8) now run inside `dotnet test`; coverage gaps now focus on coroutine/yield paths before upstream TAP fixtures can be fully re-enabled.
  - ğŸ”„ Implemented `coroutine.close` per Lua Â§6.2, including nil/false ignores (Â§3.3.8), coroutine-yield cleanup, and errored-coroutine tuples; `TestMore/310-close-var.t` now covers suspended cleanup and error tuples while the interpreter skips duplicate `__close` runs. Remaining action: re-enable the upstream TAP suite once Windows/macOS parity is verified.
  - ğŸ”„ Extended the mirror with coroutine yield/error repros and nil/false handling per Lua Â§3.3.8, then taught `Processor.EnsureToBeClosedValue`/`CloseValue` to skip nil/`false` so interpreter semantics match the spec; reran `dotnet test â€¦ --filter TestMore310CloseVar` (Release + DOTNET_ROLL_FORWARD=Major) to capture the new assertions.
  - âœ… Added Lua 5.4 string-library spec coverage with manual (Â§6.4) citations (`string.byte` clamping, plain `string.find`, capture returns, `%q` formatting, zero-count `string.rep`), keeping interpreter semantics aligned with the canonical interpreter; Release `dotnet test` now passes 1â€¯481 cases post-suite expansion.
  - âœ… Strengthened `MethodMemberDescriptor` unit coverage (default access fallback, AOT downgrade path, byref/out tuple returns, pointer/generic guardrails, visibility forcing) to push the class toward the â‰¥95â€¯% line target while preserving green Release runs.
  - âš ï¸ `./scripts/coverage/coverage.ps1` previously aborted because analyzer warnings (e.g., CA1834, CA1305) were promoted to errors; with compiler warnings now gated, rerun coverage to verify the pipeline and capture the refreshed reports.
  - âœ… Configured solution-wide `WarningsAsErrors` for compiler diagnostics (CS*) while cataloguing CA* analyzer findings; builds now fail on compiler warnings, and the CA backlog is tracked for future cleanup.
  - Captured refreshed Release baseline via `./scripts/coverage/coverage.ps1` (2025-11-12 18:55 UTC), recording NovaSharp.Interpreter at **86.1â€¯% line / 82.3â€¯% branch** coverage; regenerated HTML/Markdown reports and refreshed both `docs/coverage/latest` and `docs/coverage/coverage-hotspots.md`.
  - âœ… Added focused NUnit suites for `FieldMemberDescriptor`, `StandardEnumUserDataDescriptor`, `ExprListExpression`, `ScriptExecutionContext`, `FastStack<T>`, `StringConversions`, and `RefIdObject`, clearing the former red-list and lifting each class above 95â€¯% line coverage (with `FastStack<T>` now at 100â€¯% after exercising explicit-interface members).
  - âœ… Synced this PLAN checkpoint with the latest coverage burn-down notes so contributors land on the 86â€¯% baseline instead of the outdated 68â€¯% snapshot.
  - âœ… Landed `SourceRefTests` to cover FormatLocation, range heuristics, and snippet extraction alongside `ExitCommandTests` that exercise help text and exit signaling; CLI ExitCommand line coverage now 100â€¯% and SourceRef climbs to 81â€¯%.
  - âœ… Added `LoadModuleTests` (require caching, load reader guards, safe environment paths), `SyntaxErrorExceptionTests`, `ParameterDescriptorTests`, `AutoDescribingUserDataDescriptorTests`, and expanded `EventMemberDescriptorTests` so LoadModule now sits at 71â€¯% line coverage, parameter descriptors at 70.8â€¯%, event descriptors at 53â€¯%, and the Release suite reaches 1â€¯081 tests with interpreter totals past 81â€¯% line.
  - Restored stream-file userdata parity by fixing Lua-style close tuples (nil, message, -1) and normalising buffered seek behaviour; StreamFileUserDataBase NUnit regressions now pass.
  - âœ… Rebuilt `read('*n')` numeric parsing to track logical stream positions, honour leading `+/-`, decimals, and exponents without corrupting buffered reads; `read` line/block/all mode combos now succeed and keep subsequent reads aligned.
  - âœ… Hardened IO coverage with exponent/whitespace numeric reads, mixed newline handling, and EOF detection fixes that rely on a tracked logical position rather than StreamReader buffering.
  - âœ… Exercised `dynamic.eval`/`dynamic.prepare` with happy paths, invalid userdata, and syntax errors; fixed `Script.CreateDynamicExpression` so syntax failures now surface as Lua errors instead of `ArgumentOutOfRangeException`.
  - âœ… Added fast-path tests for `io.open`, `io.input`/`io.output`, and `io.tmpfile`, covering missing file tuples, invalid modes, default stream reassignment, and temporary file writes.
  - âœ… Brought `pcall`/`xpcall` coverage up with CLR callbacks, handler decoration, and guardrail assertions; observed that CLR yields currently return success, which needs deeper spec validation.
  - Added pcall-guarded coverage for stream flush/seek/setvbuf failures (including `io.flush` default routing) and wrapped the underlying exceptions in `ScriptRuntimeException`, exercising the new fallbacks.
  - Added BinaryEncoding edge-path coverage: verified null/invalid source buffers, undersized destinations, and negative max-count guards to enforce extreme-path behaviour.
  - Removed legacy tree; modernization docs/PLAN cleaned up.
  - Tightened coverage tooling (`scripts/coverage/coverage.ps1` now quiet locally; opt-in via NOVASHARP_COVERAGE_SUMMARY).
  - Added coverage suites for DebugModule, OsSystemModule, and IO userdata; interpreter coverage â‰ˆ77%.
  - Updated DebugModule to exit on scripted return and added tests for the console loop.

â€¢ Preferences / Constraints
  - Keep local CLI output concise; use env vars for full summaries.
  - Follow `PLAN.md` milestones; focus on coverage burn-down.
  - Respect existing Lua-facing behavior and build on NUnit + Script.DoString.
  - When adding Lua fixtures, include clearly named files for small-scope, mixed-mode, and complex scenarios so reviewers can target the right coverage level quickly.

â€¢ Next Work Items
  1. Run the Lua `<close>` TAP suites (or craft NUnit mirrors) to exercise error unwinds, `goto`/`break` exits, and nested closures; extend coverage where the new runtime paths still lack assertions.
     - ğŸ”„ Local TAP mirror `TestMore/310-close-var.t` now runs via `TestMore310CloseVar`, covering return/goto/break/nested-closure unwinds plus coroutine yield/error flows, nil/false semantics, and `coroutine.close` tuples (Â§Â§3.3.8 & 6.2). Remaining TODO: re-enable the upstream TAP file once the same coverage passes on Windows/macOS CI.
  2. Design a versioned compatibility mode so scripts can opt into Lua 5.5, 5.4, 5.3, or 5.2 semantics while defaulting to latest; capture spec deltas and config surface.
  3. Audit naming consistency across the runtime (methods like `Emit_Op`, members such as `i_variable`, and other Hungarian-style locals), then propose a final alignment plan with tooling impacts documented.
  4. Tackle remaining hotspots listed in docs/coverage/coverage-hotspots.md (e.g., HardwiredDescriptors.DefaultValue,
     ReflectionSpecialName, ErrorHandlingModule, Io/Json/Load modules).
  5. Re-run ./scripts/coverage/coverage.ps1 after each batch and update PLAN/doc checkpoints accordingly; raise gate once suite sustain >90â€¯%.
  6. Unity integration milestone: package NovaSharp as a Unity module (UPM and embedded), add example scenes/mod templates, document IL2CPP/AOT caveats, and verify the mod workflow in CI.
  7. Performance & allocation milestone: stand up BenchmarkDotNet regression runs, track allocations via dotnet-trace/dotMemory, enforce a perf budget in CI, and prototype Span<T>/pooling on hot paths.
  8. Roslyn code generation milestone: design the source generator/analyzer surface for NovaSharp descriptors and mod code, build a prototype, and document usage patterns.
  9. Documentation & samples milestone: set up DocFX (or equivalent), publish compatibility matrices + tutorials, refresh Unity/modding guides, and wire doc generation into CI.
  10. Compatibility corpus milestone: expand CI to run Lua TAP suites, real-world script corpora, and community mod packs across Windows/macOS/Linux + Unity editor builds.
  11. Style/quality automation milestone: enable analyzers/stylecop/formatter rules (naming, spacing, `_camelCase`), enforce them in CI, and close out the remaining naming debt.
  12. Research high-performance string/I/O libraries compatible with Unity (e.g., CySharp.ZString) and scope integration options to reduce allocations in parser, IO, and interop paths; document findings and prototype hotspots.
  13. Investigate `pcall` behaviour when CLR callbacks yield: confirm Lua parity, add repro harness, and patch runtime if NovaSharp should surface an error instead of returning success.
  14. Review CA1711 guidance for `SymbolRefAttributes` (rename vs. suppression) once `<close>` work stabilises, capturing the outcome in PLAN + analyzer settings.

## Legacy âœ NovaSharp Finalization (New)
- âœ… Scope audit: `rg` confirmed zero legacy-brand identifiers remain in tracked source/docs; 612 residual artifacts still carry the legacy name (coverage HTML exports, benchmark logs, cached VS metadata). Directories flagged for rename: `src\.vs\moonsharp`, `src\legacy\moonsharp_netcore`. Acceptance: documented rename queue covering files, folders, and generated outputs.
- âœ… File & folder renames: Renamed lingering filesystem entries (`NovaSharp.Interpreter` attribute source files, VS Code debugger scaffolding, `_Projects` mirror, JetBrains `.DotSettings`, legacy `novasharp_netcore`, `.vs/novasharp` cache, Flash project metadata, `.gitignore` helpers) so tracked assets now ship with `NovaSharp` branding.
- âœ… Resource sync: Rebranded embedded assets (e.g., `Resources/NovaSharpdbg.png`) to unblock `NovaSharp.RemoteDebugger` and `NovaSharp.Cli` builds referencing the new resource names.
- âœ… Benchmark harness rename: `tooling/NovaSharp.Comparison` replaces `PerformanceComparison` with updated namespaces, net8.0 executable output, and auto-run BenchmarkDotNet wiring.
- âœ… Benchmark defaults: `NovaSharp.Benchmarks` and `NovaSharp.Comparison` now run all suites automatically when invoked (inject `--filter *`) while keeping shared `PerformanceReportWriter` reporting.
- âœ… Project hygiene: Audited `.csproj` metadata and purged references to missing/irrelevant assets (icons, logs, keypairs) so IDE surfacing stays clean.
- âœ… Build sanity check: `dotnet build src/runtime/NovaSharp.Interpreter/NovaSharp.Interpreter.csproj` passes after renames, confirming compiler parity.
- âœ… Artifact regeneration: Regenerated coverage via `./scripts/coverage/coverage.ps1` (67.8â€¯% line / 69.7â€¯% branch / 72.1â€¯% method) and reran `NovaSharp.Benchmarks` + `NovaSharp.Comparison` to refresh BenchmarkDotNet outputs; stale legacy-labelled artefacts are no longer present under `docs/coverage/latest` or `BenchmarkDotNet.Artifacts`.
- âœ… Automation guardrails: Added a GitHub Actions branding check in `.github/workflows/tests.yml` that fails the build if tracked files or filenames contain the legacy brand, preventing regressions.
- âœ… Baseline snapshot: Captured the current benchmark outputs under legacy-labelled sections in `docs/Performance.md` so performance work can compare future NovaSharp runs against the pre-improvement baseline.
- âœ… OS metadata accuracy: Perf logging harness now reads the Windows edition + display version from `HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion`, so `docs/Performance.md` records entries like "Windows 11 Pro 25H2 (build 26200.6899, 10.0.26200)" instead of the kernel-only label.
- âœ… Unity compatibility: Disabled nullable reference types across remaining tooling/test projects and reinforced explicit-type editorconfig rules so Unity builds never see `var` or nullable metadata drift.

## Coverage Initiative (Target â‰¥ 90%)
- **Milestone 0 â€“ Baseline Measurement (in-flight)**  
Integrate Coverlet with `src/tests/NovaSharp.Interpreter.Tests`, emit LCOV + Cobertura outputs under `artifacts/coverage`, and publish HTML reports to `docs/coverage/latest`. Document the workflow in `docs/Testing.md` and ship a `scripts/coverage/coverage.ps1` helper for local execution. Acceptance: CI publishes raw + HTML artefacts, auto-generated Markdown summary, and a PR comment capturing the current baseline (67.8â€¯% line / 69.7â€¯% branch / 72.1â€¯% method; interpreter 81.0â€¯% line).
  - âœ… `scripts/coverage/coverage.ps1` now drives `dotnet test` through `coverlet.console`, copies Markdown/JSON summaries beside the raw reports, and refreshes `docs/coverage/latest`.
  - âœ… Tests workflow gained a dedicated `code-coverage` job that appends the Markdown summary to the run, updates a PR comment in place, and uploads both raw coverage data and a gzipped HTML dashboard.
- **Milestone 1 â€“ Unit Depth Expansion (Weeks 1-3)**  
  Expand `src/tests/NovaSharp.Interpreter.Tests/Units` to cover parser error paths, metatable resolution, tail-call recursion limits, dynamic expression evaluation, and data-type marshaling edge cases (tablesâ†”CLR types). Add regression tests for CLI utilities in `src/tooling` (command parsing, REPL, config). Target â‰¥ 70% line coverage for `NovaSharp.Interpreter` namespace before integration scenarios.
  - âœ… Added `ParserTests`, `MetatableTests`, `TailCallTests`, `DynamicExpressionTests`, and expanded `InteropTests` to lock in parser diagnostics, metatable `__index/__newindex` wiring, deep tail-call paths, dynamic expression environments, and CLR table marshaling.
  - âœ… Shipped `ReplInterpreterTests` + `JsonModuleTests` to cover REPL prompts/dynamic evaluation and JSON encode/decode paths; interpreter namespace line coverage still 67.7â€¯%, so JSON branch is unblocked but IO/OS modules remain uncovered.
  - âœ… Added `IoModuleVirtualizationTests` to back the IO/OS pathways with an in-memory platform accessor and keep `os.remove`/`io.output` behaviour under regression; interpreter namespace line coverage still 67.7â€¯%.
  - âœ… Captured CLI command parsing transcripts with `ShellCommandManagerTests` and extended the virtualised IO suite to assert `os.tmpname`/`os.rename` plus stdout/stderr separation; interpreter namespace coverage gain pending analysis.
  - âœ… Migrated the legacy NUnit suite off `Assert.That`/`Assert.AreEqual` APIs to NUnitÂ 4 constraint syntax, removed the `EMBEDTEST` shim, sealed helper fixtures flagged by CA1852, and restored a green Release build on net8.0.
  - âœ… Added CLI failure-path tests (`ShellCommandManagerTests`) covering null/empty commands and tightened regression coverage.
  - âœ… Exercised `Program.CheckArgs` and `HardWireCommand` interactive flows with unit tests, enabling InternalsVisibleTo for NovaSharp.Cli so tests hit real code paths without reflection.
  - âœ… Added `RunCommandTests`, `RegisterCommandTests`, and `CompileCommandTests` (including loader failure propagation) to cover CLI script execution wiring, syntax help, type registration output, binary dump generation, and error paths; Release suite (679 tests) stays green while CLI namespace coverage rises.
  - âœ… Refactored `DebugCommand` behind injectable factory/launcher bridges and added `DebugCommandTests` to assert debugger attach + browser launch behaviour without spawning external processes; Release suite now passes 681 tests.
  - âœ… Stubbed the Lua dump loader so `HardWireCommand` can be exercised deterministically; new tests cover C#/VB generation paths, visibility warnings, and ensure code artifacts are emitted (Release suite at 684 tests).
   - âœ… Added `HelpCommandTests` to validate command listings, detailed help, and error paths, keeping CLI interactive surfaces covered (Release suite now 687 tests).
- âœ… Quantified the latest coverage run: overall line coverage at **56.5â€¯%** (â†‘0.1), with `CommandManager` now 100â€¯% covered. Remaining hotspots are `NovaSharp.Program` (0â€¯%), `HardWireCommand` (4.5â€¯%), and other CLI commands <60â€¯%.
- âœ… Replaced the placeholder `SerializationExtensionsTests` with comprehensive coverage for prime tables, nested tables, identifier validation, tuple flattening, and string escaping, correcting `SerializationExtensions` to emit Lua-compliant braces/newlines instead of the `${` scaffolding.
  - âœ… Standardise test naming: migrated all NUnit test methods to PascalCase (no underscores), elevated the `.editorconfig` rule to `error`, refreshed `docs/Testing.md`, and re-ran the Release suite (671 tests passed).
  - âœ… Closed remaining CLI gaps: added `ProgramTests.CheckArgsHardwireFlagGeneratesDescriptors` for the `-W` flow and `ScriptDefaultOptionsTests` to lock in default loader persistence; Release suite now passes 690 tests with NovaSharp.Cli coverage trending upward.
  - âœ… Expanded interpreter dynamic-expression coverage with constant/equality/symbol-resolution scenarios (`DynamicExpressionTests`), lifting the Release suite to 693 tests and covering `CreateConstantDynamicExpression`, `DynamicExpression.FindSymbol`, and equality semantics.
  - âœ… Exercised colon-operator configuration flags with new `ColonOperatorBehaviourTests`, validating `TreatAsDot`, `TreatAsColon`, and `TreatAsDotOnUserData` paths (Release suite now 696 tests).
  - âœ… Added `SymbolRefTests` covering binary write/read + environment restoration for global/local/upvalue symbols; Release suite up to 699 tests with serialization helpers now guarded.
  - âœ… Brought `ScriptExecutionContextTests` online to validate local symbol resolution, global env access, and metatable inspection, pushing the Release suite to 702 tests and exercising execution-context helpers.
  - âœ… Extended execution-context coverage to tail-call helpers and message decoration via new tests, lifting the Release suite to 704 tests and guarding `GetMetamethodTailCall` plus `PerformMessageDecorationBeforeUnwind`.
  - âœ… Added `ProcessorStackTraceTests` to validate coroutine stack traces and interpreter exception call stacks, bringing the Release suite to 706 tests and exercising `Coroutine.GetStackTrace` along with debugger call-stack capture.
  - âœ… Exercised debugger refresh plumbing via `DebuggerRefreshTests`, capturing call stack, locals, watch expressions, value stack, and thread snapshots (Release suite now 707 tests).
  - âœ… Hardened coroutine lifecycle coverage (`CoroutineLifecycleTests`) to ensure resume error paths, recycling flows, and auto-yield force suspends are guarded; Release suite now sits at 712 tests.
  - âœ… Added unit coverage for `coroutine.running/status`, `coroutine.wrap`, and `coroutine.resume` behaviours plus forced-yield handling in `pcall`/`xpcall` (Release suite now 722 tests).
  - âœ… Extended `CoroutineModuleTests` to cover nested tuple flattening, argument forwarding through `resume`/`wrap`, the `coroutine.create` guardrail, and direct `coroutine.yield` payloads; Release suite now passes 727 tests.
  - âœ… Ported the outstanding coroutine TAP scenarios into managed coverage (`IsYieldableReturnsFalseOnMainCoroutine`, `IsYieldableReturnsTrueInsideCoroutine`, `WrapPropagatesErrorsToCaller`, `WrapPropagatesErrorsAfterYield`), wiring the runtime `coroutine.isyieldable` hook and ensuring wrap propagates exceptions; Release suite now passes 735 tests.
  - âœ… Exercised CLR callback yieldability and `wrap` + `pcall` interop (`IsYieldableReturnsFalseInsideClrCallback`, `WrapWithPcallCapturesErrors`, `WrapWithPcallReturnsYieldedValues`) while fixing `coroutine.wrap` to retain its coroutine handle under protected calls; Release suite now passes 738 tests.
  - âœ… Mirrored the nested coroutine TAP assertions (`IsYieldableInsidePcallWithinCoroutine`, `WrapWithPcallHandlesTailCalls`) so yieldability and tail-call continuations stay faithful when protected by `pcall`; Release suite now passes 740 tests.
  - âœ… Closed the remaining TAP parity gaps (`IsYieldableInsideXpcallErrorHandlerWithinCoroutine`, `CoroutineStatusRemainsAccurateAfterNestedResumes`), confirming error-handler yieldability and status drift behaviour; Release suite now passes 742 tests.
  - â³ Next: Raise interpreter coverage gates above 70â€¯% and wire CI enforcement now that the coroutine TAP matrix is mirrored in managed tests.
  - âœ… Extended debugger + CLI coverage with `SourceRefTests` (FormatLocation, distance heuristics, snippet extraction) and `ExitCommandTests` (name/help/execution), boosting `SourceRef` to 81â€¯% line coverage and `ExitCommand` to 100â€¯% while the Release suite grows to 1095 tests.
  - âœ… (2025-11-13) Patched CLI `Program` coverage regression by switching the decorated-error unit to `ScriptRuntimeException`, restoring Release builds after the missing `InterpreterException` symbol failure and keeping the decorated message branch measurable ahead of the next `./scripts/coverage/coverage.ps1` snapshot.
  - âœ… (2025-11-13) Added `ScriptLoaderBaseTests` covering LUA_PATH overrides, ignore flags, string-path unpacking, and environment fallbacks so `ScriptLoaderBase` exits the red list once the next coverage refresh lands.
  - ğŸ”„ (2025-11-13) Landed `CharPtrTests` to target pointer arithmetic, comparisons, and string projections; rerun coverage to confirm `LuaStateInterop.CharPtr` climbs out of the low-coverage bucket.
  - ğŸ”„ (2025-11-13) Added `DescriptorHelpersTests` asserting visibility attributes, member access classification, identifier conversions, and naming utilities; patched `ToUpperUnderscore`/`NormalizeUppercaseRuns` (aligned with Wallstop Unity helpers) to stop inserting stray digit separators and preserve PascalCase initials ahead of the next coverage snapshot.
  - ğŸ”„ (2025-11-13) Expanded `EventMemberDescriptorTests` with wide-arity coverage (1â€“16 parameters) so `EventMemberDescriptor.CreateDelegate` switch cases are exercised before the next burn-down review.
  - ğŸ”„ (2025-11-13) Extended `LuaStateInteropToolsTests` to cover octal alternate padding, pointer formatting, `%n` substitution, and the positive space flag, lifting `LuaStateInterop.Tools` beyond the low-coverage threshold.
  - ğŸ”„ (2025-11-13) Augmented `FastStackTests` with zero-count, overflow, slot-clearing, and full reset scenarios so `FastStack.RemoveLast`/`Clear` guard paths are now measured.
  - ğŸ”„ (2025-11-13) Added `DotNetCorePlatformAccessorTests` covering file mode parsing, environment I/O, filesystem operations, and the NotSupported execute path to raise `DotNetCorePlatformAccessor` coverage.
  - ğŸ”„ (2025-11-13) Broadened `JsonModuleTests` (invalid parse/serialize paths, `isnull`, `null`) to burn down the remaining gaps in `JsonModule`.
  - ğŸ”„ (2025-11-13) Introduced `ClosureContextTests` validating symbol name copying and value storage so `ClosureContext` no longer drags down scope coverage.
  - ğŸ”„ (2025-11-13) Added `TablePairTests` to cover constructor/`Nil` behavior and document the current value setter semantics for `TablePair`.
  - ğŸ”„ (2025-11-13) Added `PropertyTableAssignerTests` (happy-path, subassigners, fuzzy matching, expected-missing) to drive `PropertyTableAssigner<T>` + core assigner coverage.
  - ğŸ”„ (2025-11-13) Added `SliceTests` covering indexing, enumeration, conversions, and unsupported mutators to lift `Slice<T>` coverage.
  - ğŸ”„ (2025-11-13) Added `InteropRegistrationPolicyTests` to assert policy factory behavior (default/automatic/explicit) and verify the obsolete marker on `Explicit`.
  - ğŸ”„ (2025-11-13) Disabled nullable reference types solution-wide (`Directory.Build.props`) and elevated CS8632/CS8669 to errors in `.editorconfig` so nullable annotations cannot reappear.

  - âœ… (2025-11-13) Closed the immediate `ScriptRuntimeException` factory gap by adding `ScriptRuntimeExceptionTests` (table index errors, `ConvertObjectFailed` overloads, coroutine guard rails, access-member helpers, `Rethrow` guard) under `src/tests/NovaSharp.Interpreter.Tests/Units`, exercising every static branch that previously sat redlined.
  - ğŸ” After closing the exception gap, rerun `dotnet test` and `./scripts/coverage/coverage.ps1`, then log the refreshed interpreter metrics back into this PLAN and `docs/coverage/coverage-hotspots.md`. (2025-11-13) `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release` âœ…; `./scripts/coverage/coverage.ps1` âœ… (line: 74.9â€¯% total / 87.1â€¯% interpreter, branch: 75.5â€¯% total / 82.8â€¯% interpreter). Snapshot + notes pushed to `docs/coverage/coverage-hotspots.md`.
  - âœ… (2025-11-16 08:44 UTC) Added targeted `CoroutineTests` coverage for the `Coroutine` runtime helper (CLR callback resume paths, object-argument conversion overloads, explicit-context resume, and `Close` short-circuit). `Coroutine` now reports **100â€¯% line / 100â€¯% branch / 100â€¯% method** coverage, `CoroutineModule` sits at **88â€¯% line / 76â€¯% branch**, and interpreter totals ticked up to **91.78â€¯% line / 88.44â€¯% branch / 93.85â€¯% method** across **1â€¯821** Release tests after rerunning `./scripts/coverage/coverage.ps1`.
  - âœ… (2025-11-16 08:52 UTC) Expanded `CoroutineModuleTests` to cover the tuple-flattening branch in `coroutine.resume`, the `"running"`/`"normal"` split in `coroutine.status`, and the internal error guard for unexpected coroutine states via a processor-state reflection helper. `NovaSharp.Interpreter.CoreLib.CoroutineModule` now reports **100â€¯% line / 100â€¯% branch / 100â€¯% method** coverage, and interpreter totals sit at **91.82â€¯% line / 88.53â€¯% branch / 93.85â€¯% method** across **1â€¯825** Release tests after rerunning `./scripts/coverage/coverage.ps1`; PLAN + `docs/coverage/coverage-hotspots.md` updated with the new snapshot.
  - âœ… (2025-11-16 09:04 UTC) Hardened the coroutine close guardrails with new `CoroutineCloseTests` that assert the `coroutine.close` guard paths (main coroutine rejection, running-state rejection, unsafe/`Unknown` state guard, to-be-closed metamethod failures, and the dead-coroutine OK path). This lifts the previously uncovered branches in `Processor.Coroutines` (`ScriptRuntimeException.CannotCloseCoroutine` states + error tuple propagation) and nudges `NovaSharp.Interpreter.Execution.VM.Processor` to **87.0â€¯% line / 85.7â€¯% branch / 92.8â€¯% method** coverage. Interpreter totals now sit at **91.97â€¯% line / 88.65â€¯% branch / 93.91â€¯% method** across **1â€¯830** Release tests (`./scripts/coverage/coverage.ps1` @ 09:04 UTC), with checkpoints mirrored in `docs/coverage/coverage-hotspots.md`.
  - âœ… (2025-11-16 09:14 UTC) Extended `SyntaxErrorExceptionTests` to cover the token + SourceRef constructors, the premature-stream flag, and both branches of the nested rethrow option (verifying cloned exceptions preserve tokens and inner exceptions). `NovaSharp.Interpreter.Errors.SyntaxErrorException` now reports **89.2â€¯% line / 100â€¯% branch / 76.9â€¯% method** coverage, keeping interpreter totals at **92.0â€¯% line / 88.65â€¯% branch / 94.05â€¯% method** across **1â€¯835** Release tests after rerunning `./scripts/coverage/coverage.ps1`; documentation synced via `docs/coverage/coverage-hotspots.md`.
  - âœ… (2025-11-16 09:36 UTC) Added `SymbolRefExpressionTests` to hit the remaining dynamic-expression guardrails (`...` inside dynamic expressions and the SymbolRef constructor shortcut). `SymbolRefExpression` now reports **100â€¯% line / 100â€¯% branch / 100â€¯% method** coverage, interpreter totals hold at **92.0â€¯% line / 88.68â€¯% branch / 94.05â€¯% method** across **1â€¯837** Release tests, and the coverage snapshot/notes live in `docs/coverage/coverage-hotspots.md`.
  - âœ… (2025-11-16 09:44 UTC) Expanded `HardwiredDescriptorTests` to cover the serialized `DynValueMemberDescriptor` constructor, the name-only base constructor, and the prime-table wiring path (plus a regression guard ensuring ownerless tables serialize cleanly). `DynValueMemberDescriptor` now reports **100â€¯% line / 100â€¯% branch / 100â€¯% method** coverage, interpreter totals tick up to **92.19â€¯% line / 88.75â€¯% branch / 94.20â€¯% method** across **1â€¯840** Release tests after rerunning `./scripts/coverage/coverage.ps1`; documented under `docs/coverage/coverage-hotspots.md`.
  - âœ… (2025-11-16 09:54 UTC) Introduced `ValueTypeDefaultCtorMemberDescriptorTests` covering the constructor guard (rejecting reference types), Execute/GetValue output, SetValue access denial, wiring metadata, and the metadata-only properties (parameters, varargs, sort discriminant). `ValueTypeDefaultCtorMemberDescriptor` now reports **96.4â€¯% line / 100â€¯% branch / 100â€¯% method** coverage, and interpreter totals rise to **92.23â€¯% line / 88.75â€¯% branch / 94.44â€¯% method** across **1â€¯841** Release tests following `./scripts/coverage/coverage.ps1` (09:54 UTC); notes mirrored in `docs/coverage/coverage-hotspots.md`.
  - âœ… (2025-11-16 12:12 UTC) Added `ClrToScriptConversionsTests` (custom converters, closures/callbacks, delegate marshalling, enums, static `MethodInfo`, IList/IDictionary/Enumerable wrappers, and failure paths) to lock down the CLRâ†’DynValue pipeline even though Release optimizations still report **80.7â€¯%** line coverage in `ClrToScriptConversions` (branch coverage now **84.2â€¯%**). Interpreter totals hold at **92.23â€¯% line / 88.75â€¯% branch / 94.44â€¯% method** across **1â€¯841** Release tests after rerunning `./scripts/coverage/coverage.ps1 -SkipBuild`; coverage results + gating notes captured in `docs/coverage/coverage-hotspots.md`.
  - âœ… (2025-11-16 12:48 UTC) Recovered the `FieldMemberDescriptor` burn-down by replacing the reflection-based `_optimizedGetter` probe with an internal accessor, then extending `FieldMemberDescriptorTests` to cover the AOT fallback (preoptimized â†’ reflection), reflection-backed instance reads, preoptimized instance getters, interface-driven optimizer execution, numeric double coercion, and mismatched-owner exceptions. Coverage run `./scripts/coverage/coverage.ps1 -SkipBuild` pushes `FieldMemberDescriptor` to **90.0â€¯% line / 94.7â€¯% branch / 100â€¯% method** and lifts interpreter totals to **92.45â€¯% line / 88.96â€¯% branch / 94.73â€¯% method** across **1â€¯872** Release tests; checkpoints logged here and in `docs/coverage/coverage-hotspots.md`.
  - âœ… (2025-11-16 12:56 UTC) Hardened the Lua Â§6.6 â€œTable Manipulationâ€ helpers by expanding `TableModuleTests` with coverage for default numeric sorting, invalid comparator types, comparator/metamethod error propagation, custom `__lt` metatables, comparators that always return `false`, mixed-type sort failures, `table.insert` positional validation (including `__len` metatable overrides), and `table.remove` arity guards. Coverage run `./scripts/coverage/coverage.ps1 -SkipBuild` now reports `NovaSharp.Interpreter.CoreLib.TableModule` at **99.2â€¯% line / 98.9â€¯% branch / 100â€¯% method** and bumps interpreter totals to **92.58â€¯% line / 89.11â€¯% branch / 94.73â€¯% method** across **1â€¯881** Release tests; PLAN + `docs/coverage/coverage-hotspots.md` capture the new checkpoint.
  - âœ… (2025-11-16 13:03 UTC) Added `StandardIoFileUserDataBaseTests` covering the Lua Â§6.8 input/output helpers (standard input reads, refusal to close stdout/stderr handles, continued writes after the error tuple, and propagation of the canonical `"cannot close standard file"` message). Coverage run `./scripts/coverage/coverage.ps1 -SkipBuild` now reports `NovaSharp.Interpreter.CoreLib.IO.StandardIoFileUserDataBase` at **100â€¯% line / 100â€¯% method** and keeps interpreter totals at **92.58â€¯% line / 89.11â€¯% branch / 94.78â€¯% method** across **1â€¯883** Release tests; checkpoint logged here and in `docs/coverage/coverage-hotspots.md`.
  - âœ… (2025-11-16 13:19 UTC) Expanded `StreamFileUserDataBaseTests` to exercise every remaining Â§6.8 â€œInput and Output Facilitiesâ€ edge case: closed-handle guards, writer-only EOF checks, direct `Peek`, default vs invalid `file:seek`/`file:setvbuf` calls (including general-exception wrapping when the underlying stream/writer fails), and Lua-level `pcall` surfaces for `io.flush`. Coverage run `./scripts/coverage/coverage.ps1 -SkipBuild` lifts `NovaSharp.Interpreter.CoreLib.IO.StreamFileUserDataBase` to **95.2â€¯% line / 90.6â€¯% branch / 100â€¯% method** (up from 84.1â€¯% line) and holds interpreter totals at **92.69â€¯% line / 89.15â€¯% branch / 94.83â€¯% method** across **1â€¯890** Release tests; mirrored in `docs/coverage/coverage-hotspots.md`.
  - âœ… (2025-11-16 12:22 UTC) Added `FrameworkCurrentTests` (reflection interface lookup, `GetTypeInfoFromType`, `IsDbNull`, and `StringContainsChar`) so the .NET Core compatibility shim reports **100â€¯% line / 100â€¯% branch / 100â€¯% method** coverage. Latest `./scripts/coverage/coverage.ps1` run keeps interpreter totals at **92.34â€¯% line / 88.89â€¯% branch / 94.54â€¯% method** across **1â€¯851** Release tests.
  - âœ… (2025-11-16 12:27 UTC) Added `JsonNullTests` to cover the JSON null userdata helper (`IsNull`, `IsJsonNull`, `Create` metadata). `JsonNull` now reports **100â€¯% line / 100â€¯% branch / 100â€¯% method** coverage, and interpreter totals remain **92.34â€¯% line / 88.89â€¯% branch / 94.54â€¯% method** across **1â€¯851** Release tests (`./scripts/coverage/coverage.ps1`).
  - âœ… (2025-11-16 12:31 UTC) Added `RuntimeScopeBlockTests` and `AnonWrapperTests` to cover the execution scope metadata (`From/To/ToInclusive/ToBeClosed`, `ToString`) and the userdata helper used for anonymous wrappers. `RuntimeScopeBlock` now reports **100â€¯% line / 100â€¯% branch / 100â€¯% method**, `AnonWrapper<T>` sits at **100â€¯% line / 100â€¯% branch**, and interpreter totals remain **92.36â€¯% line / 88.89â€¯% branch / 94.68â€¯% method** across **1â€¯859** Release tests (`./scripts/coverage/coverage.ps1 -SkipBuild`).
  - âœ… (2025-11-16 12:35 UTC) Added `SourceRefTests` (formatting, distance, inclusion, CLR markers, breakpoint metadata) and `EmbeddedResourcesScriptLoaderTests` (resource detection + load path, plus the .NET Core `NotSupportedException`). `EmbeddedResourcesScriptLoader` now reports **100â€¯% line / 100â€¯% branch / 100â€¯% method** coverage; `SourceRef` behaviour is locked down even though the Release build still reports **81â€¯% line / 84â€¯% branch** because the CLR bootstrapper loads `libfunc_require` before user scripts. Interpreter totals hold at **92.38â€¯% line / 88.90â€¯% branch / 94.68â€¯% method** across **1â€¯865** Release tests (`./scripts/coverage/coverage.ps1 -SkipBuild`).
    - ğŸ”„ (2025-11-13) Added `CallbackFunctionTests` covering colon-operator behaviour, default access mode validation, delegate conversions, and signature heuristics; line coverage now **91.3â€¯%** for `CallbackFunction`.
    - ğŸ”„ (2025-11-13) Expanded `ClosureTests` (upvalue classification, delegate helpers, call overloads, metadata assertions) lifting `Closure` to **86.6â€¯%** line / **83.3â€¯%** method coverage; remaining gap stems from the non-executable zero-upvalue branch (Lua `_ENV` always captured).
    - ğŸ”„ (2025-11-14) Added an explicit `ClosureTests.UpvaluesTypeIsNoneWhenNoUpvaluesAreCaptured` case by instantiating a zero-symbol closure through the internal constructor, confirming the `UpvaluesType.None` branch and keeping `Closure` ready for future analyzer tightening.
    - ğŸ”„ (2025-11-13) Rounded out `ParameterDescriptorTests` with restriction-constructor, by-ref wiring, original-type fallbacks, and `ToString` coverage; `ParameterDescriptor` now reports **100â€¯%** line coverage.
    - ğŸ”„ (2025-11-13) Hardened `LoadModuleTests` (reader fragment concatenation, safe-environment failure, `loadfile` syntax errors, `dofile` success/error flows), boosting `LoadModule` to **91.3â€¯%** line / **86.9â€¯%** branch coverage.
    - ğŸ”„ (2025-11-13) Expanded `IoModuleTests` (default stream setters, close/flush, iterator API, binary encoding guardrails, `tmpfile`, exception fallbacks), raising `IoModule` to **93.2â€¯%** line / **88.0â€¯%** branch coverage and clearing it from the red list.
    - ğŸ”„ (2025-11-13) Added `StringModuleTests` and `StringRangeTests` exercising char/byte/unicode ranges, formatter helpers, metatable wiring, positive/negative index coercion, and the internal `AdjustIndex` path; reran `./scripts/coverage/coverage.ps1` (Release) capturing `StringModule` at **99.0â€¯%** line / **100â€¯%** branch and `StringRange` at **100â€¯%** line with the interpreter suite now at **87.3â€¯%** line / **83.1â€¯%** branch (1â€¯430 tests).
    - ğŸ”„ (2025-11-14) Added `Units/CoroutineCloseTests` to exercise `Processor.Coroutines` close paths (never-started, suspended, post-error) and `Units/DebuggerResumeHelpersTests` to drive `Processor.Debugger` step-in/step-out flow with deterministic breakpoints. Targeted `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter "FullyQualifiedName~CoroutineCloseTests"` and the matching `--filter "FullyQualifiedName~DebuggerResumeHelpersTests"` both pass in Release, confirming the scheduler + resume helpers are now covered.
    - ğŸ”„ (2025-11-14) Expanded `BinaryOperatorExpressionTests` with precedence/associativity scenarios plus compile-time assertions (short-circuit jumps, inverted comparisons) so `BinaryOperatorExpression` covers the `Prioritize*` helpers and `ShouldInvertBoolean` paths; `dotnet test ... --filter "FullyQualifiedName~BinaryOperatorExpressionTests"` now exercises the additional evaluation + bytecode branches.
    - ğŸ”„ (2025-11-14) Added `UnityAssetsScriptLoaderTests` covering path normalization, missing-script diagnostics, and loaded-script enumeration so the loaderâ€™s dictionary-driven paths stay under regression coverage without needing a Unity runtime.
    - ğŸ”„ (2025-11-14) Extended `Units/TablePairTests` with equality/operator/hash-code assertions plus `Equals(object)` regressions (`dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter "FullyQualifiedName~TablePairTests"`), ensuring `NovaSharp.Interpreter.DataTypes.TablePair` no longer skews the interpreter red list.
    - ğŸ”„ (2025-11-14) Introduced `Units/UserDataTests` to lock down `UserData.Create` fallbacks, proxy registration guards, and the registry description/historical paths by wiring a stub `IWireableDescriptor`; `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter "FullyQualifiedName~UserDataTests"` passes, and the latest `./scripts/coverage/coverage.ps1` run records `NovaSharp.Interpreter.DataTypes.UserData` at **86â€¯%** line / **83.3â€¯%** branch with the overall interpreter climbing to **88.4â€¯%** line / **84.2â€¯%** branch / **91.8â€¯%** method (1â€¯517 tests).
    - ğŸ”„ (2025-11-14) Added `Units/DynValueTests` covering tuple flattening (`NewTuple`/`NewTupleNested`), scalar conversion, Lua truthiness, length semantics, assignment/read-only safeguards, and `CheckType` auto-conversion failure paths; `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter "FullyQualifiedName~DynValueTests"` and the refreshed `./scripts/coverage/coverage.ps1` keep `NovaSharp.Interpreter.DataTypes.DynValue` moving upward (**77.8â€¯%** line / **62.9â€¯%** branch) with interpreter totals holding at **88.4â€¯%** line / **84.2â€¯%** branch / **91.8â€¯%** method across **1â€¯527** tests.
    - ğŸ”„ (2025-11-14) Extended `Units/DynValueTests` again to hit conversion helpers (`CastToNumber`, `CastToString`), `CheckType` with `AllowNil`, `CheckUserDataType`, user-data print strings, read-only cloning, hash caching, tuple debug output, NaN detection, and private-resource retrieval; `dotnet test ... --filter "FullyQualifiedName~DynValueTests"` plus the latest coverage sweep now place `NovaSharp.Interpreter.DataTypes.DynValue` at **82.2â€¯%** line / **67.4â€¯%** branch, nudging interpreter totals to **88.6â€¯%** line / **84.6â€¯%** branch / **92.0â€¯%** method with **1â€¯578** Release tests.
    - ğŸ”„ (2025-11-14) Introduced `Units/LuaTypeExtensionsTests` to pin `CanHaveTypeMetatables`, `ToLuaTypeString`/`ToErrorTypeString` mappings (including exception paths), and debugger string formatting; `dotnet test ... --filter "FullyQualifiedName~LuaTypeExtensionsTests"` plus the latest `./scripts/coverage/coverage.ps1` bumped `NovaSharp.Interpreter.DataTypes.LuaTypeExtensions` to **95.6â€¯%** line / **96.4â€¯%** branch and nudged interpreter totals to **88.4â€¯%** line / **84.3â€¯%** branch / **91.8â€¯%** method with **1â€¯544** tests executing in Release.
    - ğŸ”„ (2025-11-14) Added `Units/ScriptPrivateResourceExtensionTests` to exercise every guardrail in `ScriptPrivateResourceExtension` (array overload, DynValue plumbing, cross-script ownership violations, shared-resource rejection) using real `Script` + `Table` instances; `dotnet test ... --filter "FullyQualifiedName~ScriptPrivateResourceExtensionTests"` and the latest `./scripts/coverage/coverage.ps1` raised `NovaSharp.Interpreter.DataTypes.ScriptPrivateResourceExtension` to **88.8â€¯%** line / **91.6â€¯%** branch and pushed the interpreter aggregate to **88.4â€¯%** line / **84.4â€¯%** branch / **91.8â€¯%** method with **1â€¯548** tests.
    - ğŸ”„ (2025-11-14) Expanded `Units/TableTests` to cover length caching invalidation, `NextKey` iteration (nil skipping, string/integer transitions, `TablePair.Nil` vs `null`), forced `CollectDeadKeys`, append ownership enforcement, NaN/nil index guards, nested `Set`/`Get` resolution (`ResolveMultipleKeys` happy/error paths), raw getters, and remove fallbacks; `dotnet test ... --filter "FullyQualifiedName~TableTests"` plus the refreshed coverage run now report `NovaSharp.Interpreter.DataTypes.Table` holding at **82.4â€¯%** line / **76.3â€¯%** branch while overall interpreter metrics stay at **88.6â€¯%** line / **84.6â€¯%** branch / **91.9â€¯%** method with **1â€¯567** Release tests (coverage uplift now limited by existing Table hotspots).
    - ğŸ”„ (2025-11-15) Extended `Units/DispatchingUserDataDescriptorTests` with descriptor-level coverage for `__tonumber`/`__tobool`, division-by-zero propagation, and meta-operator fallbacks, and followed up with additional unit coverage for the dictionary helpers (`MemberNames`/`MetaMemberNames`, `HasMember`, add/remove), the indexer execution path (both happy-path and non-callback exception), and extension-method refresh (`UserData.RegisterExtensionType` + Lua `hostAdd:DescribeExt()`). `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter "FullyQualifiedName~DispatchingUserDataDescriptorTests"` stays green, and the latest `./scripts/coverage/coverage.ps1 -SkipBuild` run still reports `NovaSharp.Interpreter.Interop.BasicDescriptors.DispatchingUserDataDescriptor` at **80.6â€¯%** line / **73.8â€¯%** branch because the remaining gaps live in the comparison helpers (`PerformComparison`/`MultiDispatch*`) and the `TryDispatchLength`/`TryDispatchToNumber` guards. Interpreter totals remain **89.4â€¯%** line / **85.7â€¯%** branch / **92.4â€¯%** method across **1â€¯643** Release tests (artefacts refreshed under `docs/coverage/latest` + hotspots).
    - ğŸ”„ (2025-11-15) Hardened `Units/UserDataTests` around the remaining registry â€œredâ€ paths: new cases now confirm (a) `GetDescriptorForType` produces `CompositeUserDataDescriptor` when a derived type inherits a registered base while also implementing a registered interface, (b) the default registration policy rejects attempts to override an existing descriptor (via the explicit `Type` + descriptor overload), (c) both the `IProxyFactory` overload and its generic variant behave (null-guard + successful descriptor binding), (d) the generic `GetDescriptorForType<T>` helper returns the registered descriptor, and (e) `UserData.RegisterAssembly(includeExtensionTypes: true)` picks up `[NovaSharpUserData]` annotations discovered through `Assembly.GetCallingAssembly`. `dotnet test ... --filter "FullyQualifiedName~UserDataTests"` stays green and the latest `./scripts/coverage/coverage.ps1 -SkipBuild` run keeps `NovaSharp.Interpreter.DataTypes.UserData` at **86â€¯%** line / **83.3â€¯%** branch coverage while documenting the still-uncovered equality/metatable toggles and historical wiring paths.
    - ğŸ”„ (2025-11-15 13:47 UTC) Finished the dispatcher/UserData push: new unit tests now cover the duplicate-member guardrails (`AddMemberTo` throws on non-overload duplicates, aggregates true overloads), the `SetIndex` setter/directed-fallback paths (including the â€œno matchâ€ false return), `IOptimizableDescriptor.Optimize()` fan-out, helper-name wrappers (`Camelify`/`UpperFirstLetter`), comparison/length metamethod fallbacks when objects are non-comparable or null, and the default/meta-index branches (`__unknown`, `__lt`, `__len`). `UserDataTests` already handle the `Assembly.GetCallingAssembly` fallback plus default-policy nuances, so the remaining dispatcher hotspots were the iterator/comparison guards and the helper wrappersâ€”these tests now hit those lines. `dotnet test ... --filter "FullyQualifiedName~DispatchingUserDataDescriptorTests"` / `--filter "FullyQualifiedName~UserDataTests"` followed by `./scripts/coverage/coverage.ps1 -SkipBuild` (2025-11-15 13:47 UTC) report NovaSharp.Interpreter at **90.0â€¯% line / 86.4â€¯% branch / 93.1â€¯% method**, `DispatchingUserDataDescriptor` at **94.2â€¯% line / 93.3â€¯% branch**, and `NovaSharp.Interpreter.DataTypes.UserData` still **100â€¯%** covered.
    - ğŸ”„ (2025-11-15 14:45 UTC) Stubbed a minimal `UnityEngine` assembly via `System.Reflection.Emit` inside `UnityAssetsScriptLoaderTests`, allowing the default constructor to exercise the reflection-based loader plus the exception guardrails (by toggling the stub to throw). New tests (`DefaultConstructorLoadsScriptsViaReflection`, `ReflectionConstructorHandlesFailuresGracefully`) verify asset-path normalization, dictionary snapshots, and the helpful missing-script error text while the harnessâ€™ throw-path covers the catch/log wiring. `UnityAssetsScriptLoader` now reports **100â€¯% line / 90â€¯% branch coverage**, overall interpreter coverage bumps to **90.9â€¯% line / 87.5â€¯% branch / 93.3â€¯% method**, and the Release suite climbs to **1â€¯723** tests.
    - ğŸ”„ (2025-11-15 14:58 UTC) Added `Units/RemoteDebuggerTests`, which start the real `DebugServer` over a free loopback port, drive its TCP command surface (`handshake`, `run`, `breakpoint`, `addwatch`, `error_rx`), and assert the resulting `DebuggerAction` queue, dynamic watch expressions, and regex-driven pause heuristics. The tests reuse a lightweight client to read the XML protocol and keep the sample scripts hermetic. Coverlet still reports **0â€¯%** for `NovaSharp.RemoteDebugger` because the interpreter runner isnâ€™t instrumenting that assembly; follow-up is captured on the coverage hotlist to either run the debugger tests from a dedicated harness or adjust the instrumentation filters so the hit data flows through. Interpreter totals remain **90.9â€¯% line / 87.5â€¯% branch / 93.3â€¯% method** (1â€¯723 tests) while the remote debugger functionality now has regression coverage.
    - ğŸ”„ (2025-11-16 13:38 UTC) Extended `Units/RemoteDebuggerTests` to cover the remaining `DebugServer` helpers: new cases now verify `breakpoint` `clear`/toggle commands, queue refreshes while `_inGetActionLoop` is true (no duplicate â€œHost busyâ€ spam), invalid watch expressions flowing through `CreateDynExpr` (error broadcast + constant fallback), the `ConnectedClients` counter, `GetDebuggerCaps`, and the path that discards stale `DebuggerAction`s once `Age > 100â€¯ms`. `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter "FullyQualifiedName~RemoteDebuggerTests"` plus a fresh `./scripts/coverage/coverage.ps1 -SkipBuild` (1â€¯890 tests) keep `NovaSharp.RemoteDebugger` at **79.1â€¯% line / 62.6â€¯% branch / 91.9â€¯% method** with `DebugServer` sitting at **63.2â€¯% line / 46â€¯% branch**â€”the critical queue/broadcast branches now execute under test even though the remaining VS-facing command handlers still dominate the uncovered set.
    - ğŸ”„ (2025-11-16 14:03 UTC) Raised `NovaSharp.Interpreter.Debugging.SourceRef` coverage by exercising the `ToString()` path, the collapsed-line branches inside `GetLocationDistance`, the â€œbetween linesâ€/before/after segments, and the single-line `IncludesLocation`/`FormatLocation` cases. The new NUnit coverage lives in `Units/SourceRefTests.cs` (`ToStringReflectsStepStopIndicator`, `GetLocationDistanceHandlesCollapsedAndBetweenSegments`, etc.) and the latest `./scripts/coverage/coverage.ps1 -SkipBuild` run (1â€¯910 tests) now records `SourceRef` at **96.0â€¯% line / 86.0â€¯% branch / 100â€¯% method** with interpreter totals nudging to **92.79â€¯% line / 89.27â€¯% branch / 94.88â€¯% method**.
    - ğŸ”„ (2025-11-16 14:20 UTC) Added `Units/MemberDescriptorTests` to pin the `IMemberDescriptor` extension helpers (`HasAllFlags`, `CanRead/Write/Execute`, getter callback generation, access filtering, and the `CheckAccess` guardrails). `dotnet test ... --filter "FullyQualifiedName~MemberDescriptorTests"` plus the same coverage sweep (1â€¯916 tests) keeps `NovaSharp.Interpreter.Interop.BasicDescriptors.MemberDescriptor` reported at **82.1â€¯% line / 90.0â€¯% branch / 100â€¯% method**â€”line coverage remains constrained by inlined `return` sites, but the behavioural guardrails (instance-vs-static access, read/write/execute enforcement, getter callback wiring) are now exercised under NUnit so regressions surface immediately.
    - ğŸ”„ (2025-11-16 14:13 UTC) Finished the NodeBase burn-down: new `NodeBaseTests` scenarios now exercise the three-token overload, the failure branches for both multi-token overloads, the `CheckTokenTypeNotNext` guard, and the `LoadingContext` property getter, pushing `NovaSharp.Interpreter.Tree.NodeBase` to **100â€¯% line / 100â€¯% branch / 100â€¯% method**. The same `./scripts/coverage/coverage.ps1 -SkipBuild` run (1â€¯916 tests) lifts interpreter coverage to **92.85â€¯% line / 89.38â€¯% branch / 94.97â€¯% method**.
    - ğŸ”„ (2025-11-15 16:05 UTC) Finished the cross-platform macro sweep for our helper scripts: `scripts/build/build.ps1`, `scripts/coverage/coverage.ps1`, `scripts/modernization/generate-moonsharp-audit.ps1`, and their bash counterparts (`scripts/build/build.sh`, `scripts/coverage/coverage.sh`, `scripts/ci/apply-formatters.sh`, `scripts/ci/check-csharpier.sh`, `scripts/ci/check-markdown.sh`) now derive the repo root via `$PSScriptRoot`/`git rev-parse` rather than hard-coded `../..`, keep POSIX separators in string literals, and continue to run from any working directory. `./scripts/coverage/coverage.ps1` (full build) still succeeds post-sweep, producing the latest Release artefacts with interpreter coverage steady at **90.9â€¯% line / 87.4â€¯% branch / 93.3â€¯% method** across **1â€¯727** tests.
    - ğŸ”„ (2025-11-15 16:12 UTC) Verified that the existing `coverlet` include filter (`--include "[NovaSharp.*]*"`) already instruments `NovaSharp.RemoteDebugger` when `./scripts/coverage/coverage.ps1` runs: the latest pass (see `docs/coverage/latest/Summary.txt:250-261`) records **43.0â€¯% line / 34.3â€¯% branch / 45.9â€¯% method** coverage with `DebugServer` at **58.2â€¯%** and the TCP helpers (`Utf8TcpPeer`, `Utf8TcpServer`) above **70â€¯%**. `Units/RemoteDebuggerTests` drive those hits by spinning up the real server and issuing `handshake`/`run`/`breakpoint`/`addwatch`/`error_rx` commands (see `src/tests/NovaSharp.Interpreter.Tests/Units/RemoteDebuggerTests.cs`). The remaining 0â€¯% classes (`DebugWebHost`, `RemoteDebuggerService`, `RemoteDebuggerOptions`) simply lack tests, not instrumentation, so no tooling change is required.
    - ğŸ”„ (2025-11-15 16:38 UTC) Added `Units/RemoteDebuggerServiceTests` to exercise the web host + CLI bridge: new cases (`SingleScriptModeServesIframeWithConfiguredRpcPort`, `JumpPageListsAttachedScripts`, `CliBridgeForwardsAttachAndHttpUrl`) spin up the real HTTP host on ephemeral ports, fetch the rendered HTML over raw TCP, and assert that the CLI bridge enables `Script.DebuggerEnabled`. The refreshed `./scripts/coverage/coverage.ps1 -SkipBuild` run (1â€¯730 tests) now reports `NovaSharp.RemoteDebugger.RemoteDebuggerService` at **96.6â€¯%** line coverage, `DebugWebHost` at **100â€¯%**, and overall `NovaSharp.RemoteDebugger` at **68.1â€¯% line / 48.3â€¯% branch / 84.4â€¯% method**; the CLI `RemoteDebuggerServiceBridge` climbed to **85.7â€¯%** line coverage.
    - ğŸ”„ (2025-11-15 16:50 UTC) Extended coverage with `Units/RemoteDebuggerServiceTests.DebuggerPageServesEmbeddedUi`, `Units/HttpServerTests`, and the new `Units/HttpResourceTests`. These cases hit the `Debugger?port=â€¦` embedded UI, exercise Basic-auth accept/deny + callback argument plumbing, and assert every `HttpResourceType` content-type mapping (callback throws). The latest `./scripts/coverage/coverage.ps1 -SkipBuild` pass (1â€¯745 tests) now reports `NovaSharp.RemoteDebugger` at **75.7â€¯% line / 59.3â€¯% branch / 87.1â€¯% method**, with `DebugWebHost` **100â€¯%**, `RemoteDebuggerService` **96.6â€¯%**, `HttpServer` **91.1â€¯%**, and `HttpResource` **94.7â€¯%**.
    - ğŸ”œ Finish the remote-debugger sweep by targeting the remaining low spots (`DebugServer` at **60.5â€¯%** line coverage and the network XML helpers): add HTTP-driven tests that request `Debugger?port=<id>` with missing/invalid ports (exercise the error-template padding), simulate multiple attached scripts to cover additional rows, and drive `XmlWriterExtensions`/`Utf8TcpServer` edge cases so the entire remote debugger assembly clears 80â€¯% line/branch coverage.
    - ğŸ”œ Audit the rest of the runtime + debuggers for hard dependencies (time, filesystem, process launchers, etc.) and capture a backlog of candidates to abstract behind interfaces/providers (similar to the planned `ITimeProvider`). Focus on areas that currently bind directly to `DateTime`, `File.*`, `Process.Start`, or platform-specific services so future tests can inject mocks without touching `netstandard2.1` compatibility.
    - ğŸ”„ (2025-11-15 17:05 UTC) Introduced a cross-platform `ITimeProvider` (with `SystemTimeProvider` default) and rewired the diagnostics pipeline: `PerformanceStatistics` now captures the provider via `DefaultTimeProvider`, while `PerformanceStopwatch` and `GlobalPerformanceStopwatch` accumulate elapsed milliseconds through the provider instead of `System.Diagnostics.Stopwatch`. Tests gained a `FakeTimeProvider`, and `PerformanceStatisticsTests` were rewritten to use deterministic time advancement (no more `Thread.Sleep`). This sets the stage for swapping in Unity-friendly providers and unblocks future abstractions for other time-dependent services.
    - ğŸ”„ (2025-11-15 17:16 UTC) Remote debugger HTTP/queue coverage pushed further: `RemoteDebuggerTests.AddWatchQueuesRefreshAndTransitionsHostState` now drives the host-busy/ready messages and `GetAction` hard-refresh path, while new `HttpServerTests` and `XmlWriterExtensionsTests` validate the callback argument plumbing plus the XML helper overloads (null handling + format strings). Coverage run `./scripts/coverage/coverage.ps1 -SkipBuild` shows `NovaSharp.RemoteDebugger` at **78.4â€¯% line / 62.7â€¯% branch / 91.7â€¯% method** (DebugServer lines now exercised via the new test) and the overall suite at **1â€¯748** tests.
    - ğŸ”„ (2025-11-15 17:30 UTC) Landed the high-resolution clock pass: introduced `IHighResolutionClock` + `SystemHighResolutionClock`, rewired `PerformanceStopwatch`, `GlobalPerformanceStopwatch`, and `PerformanceStatistics` to accumulate elapsed time via injected clocks (scripts can now swap in test clocks through the internal setter). Added thread-safe guards around the global stopwatch cache and supplied `FakeHighResolutionClock`-based NUnit coverage so diagnostics no longer depend on `Thread.Sleep`. Remote debugger tests were expanded (`XmlWriterExtensionsTests`, host busy/ready coverage), and the latest coverage run (`./scripts/coverage/coverage.ps1 -SkipBuild`) shows `NovaSharp.RemoteDebugger` at **78.4â€¯% line / 62.7â€¯% branch / 91.7â€¯% method** with the suite at **1â€¯748** tests.
    - ğŸ”„ (2025-11-15 17:39 UTC) Promoted the clock injection to first-class DI: `ScriptOptions` now exposes a public `HighResolutionClock` property, new `Script` constructors accept custom option snapshots, and the new `ScriptOptionsTests` prove that supplying a fake clock at construction time automatically flows into `PerformanceStatistics`. This unblocks embedders (and Unity) from swapping clocks per script without mutating global state.
    - ğŸ”„ (2025-11-15 18:19 UTC) Completed the debugger time-provider sweep by making `DebuggerAction(ITimeProvider)` public and refactoring `DebugServer` action creation helpers to stamp every queued action with the owning scriptâ€™s `TimeProvider`. Rebuilt the full solution (`dotnet build src/NovaSharp.sln -c Release`), reran the Release suite (`dotnet test ... --no-build`, **1â€¯749** tests), and refreshed coverage via `./scripts/coverage/coverage.ps1 -SkipBuild`, which now reports `NovaSharp.RemoteDebugger` at **79.1â€¯% line / 62.6â€¯% branch / 91.9â€¯% method** (overall interpreter totals **90.9â€¯% line / 87.4â€¯% branch / 93.4â€¯% method**).
    - ğŸ”„ (2025-11-15 18:27 UTC) Ported the remaining timestamp consumer on the Hardwire path to the shared `ITimeProvider`: `HardwireCodeGenerationContext`/`HardwireGenerator` now accept an injected provider (defaulting to `SystemTimeProvider`), the context header writes `Code generated on` using that provider, and a new `HardwireCodeGenerationContextTests.TimestampCommentComesFromProvidedTimeProvider` fixture locks the behaviour via `FakeTimeProvider`. `./scripts/coverage/coverage.ps1 -SkipBuild` stays green (interpreter **90.9â€¯% line / 87.3â€¯% branch / 93.4â€¯% method**, NovaSharp.Hardwire **54.8â€¯% line**).
    - ğŸ”œ Finish hardening the abstractions by (a) plumbing the high-resolution clock through `ScriptOptions` so production callers can replace it without touching internals, (b) auditing the remaining shared state (DebuggerAction timestamps, `_globalStopwatches`, remote-debugger queues) for thread-safety in async/Lua interop scenarios, and (c) extending the time-provider migration to other wall-clock consumers (`DebuggerAction`, `OsTimeModule`, CLI timestamping). Document the threading/DI guidelines in PLAN once the audit completes.
    - ğŸ”„ (2025-11-15 18:48 UTC) Verified IO pluggability by wrapping `Script.GlobalOptions.Platform` with a recording accessor in new `IoModuleTests`: the tests assert `io.open` routes through the accessorâ€™s `OpenFile` hook (capturing payloads while still writing to disk) and that `io.write` traffic can be mirrored via a custom `StdOut` stream without breaking default behaviour. This documents the existing extensibility story (PlatformAccessor + script streams) and provides regression coverage for future backend/provider refactors.
    - ğŸ”„ (2025-11-15 19:05 UTC) Hardened the shared stopwatch infrastructure: `PerformanceStatistics` now guards all `_globalStopwatches` mutations with `GlobalSyncRoot`, preventing races when one thread toggles `Enabled` while another calls `StartGlobalStopwatch`. Added `GlobalStopwatchRemainsStableWhenTogglingEnabledFromOtherThreads` to stress this path under parallel load so future changes canâ€™t regress the thread-safety guarantees.
    - ğŸ”„ (2025-11-15 19:20 UTC) Eliminated the remaining `DateTime.UtcNow` polling loops from the debugger HTTP/WS tests by introducing `TestWaitHelpers` (Stopwatch-based spin helpers). `HttpServerTests`, `RemoteDebuggerTests`, and `RemoteDebuggerServiceTests` now rely on deterministic wait utilities rather than ad-hoc deadlines, which keeps the test suite aligned with the no-direct-clock policy while simplifying future time-provider swaps.
    - ğŸ”œ Verify that the IO module (and other side-effectful modules) expose pluggable backends/hooks so embedders can tap script IO into brokers, event streams, or custom telemetry while still honoring Lua semantics. Inventory current extension points, design a provider model if gaps remain, and add regression tests proving that swapping the backend does not break vanilla IO behaviour.
    - ğŸ”œ Run a full production + test audit for concurrency safety: verify every mutable singleton/global cache, async interop path, and test fixture that flips shared state (platform accessors, debugger queues, global clocks) is raceless, properly synchronized, and uses `try/finally`/IDisposable scopes to restore prior state. Catalog any risky areas and capture remediation items in PLAN before moving forward.
    - ğŸ”œ Add a safety lint: whenever tests or production code temporarily mutates shared state (global clocks, static caches, platform hooks), enforce `try/finally`, disposable scopes, or explicit setup/teardown fixtures so the previous state is restored even on failure. Capture the rule in PLAN + contributing docs and audit existing tests (e.g., the new clock injections) to follow the pattern.
    - ğŸ”„ (2025-11-15 17:00 UTC) First dependency sweep results:
        - **Time**: `NovaSharp.Interpreter.Compatibility.Stopwatch`, `Debugging.DebuggerAction`, and `CoreLib.OsTimeModule` all call `DateTime.UtcNow/Now` directly; `HardwireCodeGenerationContext` timestamps code with `DateTime.Now`. Each should accept the planned `ITimeProvider` (or equivalent) so tests can inject deterministic clocks.
        - **Process launching**: `StandardPlatformAccessor.RunCommand`, `DebugCommand` (CLI), and tutorial samples invoke `Process.Start` directly; wrap behind an interface so tests can stub launches (vital for Unity/CI).
        - **Filesystem**: `StandardPlatformAccessor` performs `File.Exists/Delete/Move`, and `HardWireCommand`/`PerformanceReportWriter` manipulate files synchronously. Consider funneling these through a lightweight `IFileSystem` abstraction (or `IPlatformAccessor` extensions) for easier testing/mocking on Unity.
      These items feed the forthcoming abstraction backlog; next pass will prioritize the `ITimeProvider` refactor, then layer process/filesystem shims where tests currently depend on real IO.
    - ğŸ”œ Introduce a `TimeProvider` abstraction usable on `netstandard2.1`/Unity (e.g., an `ITimeProvider` interface with production + `FakeTimeProvider` implementations) so clock-dependent code (`PerformanceStopwatch`, scheduler throttles, idle detection) and tests stop calling `DateTime.UtcNow/Now` directly. Update diagnostics/runtime components to accept the provider via DI/factories, and refactor existing tests to inject the fake provider instead of sleeping; document the pattern in PLAN once the first subsystem adopts it.
    - ğŸ”„ (2025-11-15 14:26 UTC) Burned down the `LuaStateInterop.Tools` hotspot: added comprehensive NUnit coverage for unsigned/sign fallback paths (`IsPositive`, `ToUnsigned`, `ToInteger`, `UnboxToLong`), regex meta-char decoding (octal `\000`, control escapes, passthrough), and the previously untested `sprintf` combinations (space-plus/zero-plus flags, left alignment overriding zero padding, `%c` numeric/char inputs, `%s` right alignment, `%f/%e/%E/%g/%G`, `%i`, `%#o` with space padding, `%hd/%hu/%ld/%lu`). `dotnet test ... --filter "FullyQualifiedName~LuaStateInteropToolsTests"` and the refreshed `./scripts/coverage/coverage.ps1 -SkipBuild` run now show `NovaSharp.Interpreter.Interop.LuaStateInterop.Tools` at **98.2â€¯% line / 90.4â€¯% branch coverage**, pushing overall interpreter totals to **90.7â€¯% line / 87.4â€¯% branch / 93.1â€¯% method** with **1â€¯721** Release tests.
    - ğŸ”„ (2025-11-14) Introduced `Units/CoroutineTests` covering `Coroutine.Resume` failure on dead instances, `AsTypedEnumerable` iteration, CLR callback path, and state progression (NotStarted â†’ Suspended â†’ Dead); `dotnet test ... --filter "FullyQualifiedName~CoroutineTests"` plus the refreshed coverage pass keeps `NovaSharp.Interpreter.DataTypes.Coroutine` steady at **87.8â€¯%** line / **86.1â€¯%** branch while interpreter totals remain **88.6â€¯%** line / **84.6â€¯%** branch / **91.9â€¯%** method with **1â€¯571** Release tests.
    - âœ… (2025-11-14) Fixed `BinaryOperatorExpression.EvalArithmetic` to handle `Operator.Power`, aligning direct expression evaluation with Lua Â§3.4.1 and preventing `DynamicExpressionException` when tests/assertions use the AST evaluation path.
    - ğŸ”œ Extend the sweep to remote-debugger automation (attach/resume/watch evaluation) before re-enabling the remaining TAP IO/OS suites.
  - âœ… Restored CLI interpreter decorated-error coverage by swapping `ProgramTests.InterpreterLoopPrintsInterpreterExceptionDecoratedMessage` to throw `ScriptRuntimeException`, unblocking Release builds and keeping the `Program` decorated-message branch under test (coverage refresh pending next `./scripts/coverage/coverage.ps1` run).
  - âœ… Added `LoadModuleTests`, `ParameterDescriptorTests`, `AutoDescribingUserDataDescriptorTests`, `StandardEnumUserDataDescriptorTests`, `UnityAssetsScriptLoaderTests`, `WatchItemTests`, `ValueTypeDefaultCtorMemberDescriptorTests`, and parser exception coverage (`SyntaxErrorExceptionTests`, dynamic expression constructors), pushing interop descriptors above 70â€¯% coverage, closing debugger/watch gaps, and keeping interpreter totals on an upward trend.
- **Milestone 2 â€“ Integration & Debugger Coverage (Weeks 2-4)**  
  Build scripted VS Code + remote debugger sessions using `Microsoft.VisualStudio.Shared.VstestHost` (or equivalent) to validate attach/resume/breakpoint-insert/watch evaluation flows. Add Lua fixture-backed smoke tests for `NovaSharp.RemoteDebugger` and CLI shell transcripts; capture transcripts as golden files in `src/tests/TestRunners/TestData`. Ensure TAP IO/OS suites run in trusted CI lane or supply equivalent managed tests hitting filesystem/environment abstractions.
- **Milestone 3 â€“ Coverage Gates & Reporting (Week 4)**  
  Wire coverage upload to Codecov (or Azure DevOps equivalent), failing PRs under 85% line coverage and raising the gate to 90% once Milestones 1-2 land. Add a dashboard to `docs/Testing.md` summarizing module-by-module coverage and bake badge URLs into `README`. Ensure nightly CI refreshes artefacts and warns on â‰¥3% regressions via GitHub checks.
- **Milestone 4 â€“ Sustained Quality (Ongoing)**  
  Author contributor guidance (PR template checklist, test matrix updates) requiring new features to include both unit and integration coverage. Automate review lint that rejects files in `src/NovaSharp.Interpreter` without accompanying tests unless tagged `[NoCoverageJustification]` with an engineering sign-off. Track skip-list debt in an issue epic and burn it down as platform lanes stabilize.

## Project Structure & Code Style Alignment
- **Milestone A â€“ Solution & Directory Audit (High Priority)**  
  Inventory every `.sln`/`.csproj` in `src`, classify runtime vs tooling vs samples, and propose a consolidated folder hierarchy (runtime/interpreter, debuggers, tooling, samples, tests). Produce a migration blueprint documenting path moves, namespace impacts, and packaging implications. Acceptance: reviewed architecture doc + updated `docs/Modernization.md` appendix.
  - âœ… `docs/ProjectStructureBlueprint.md` captures the current vs. proposed layout, legacy inventory, and phased migration plan.
- **Milestone B â€“ Refactor Execution (High Priority)**  
  Reshuffle projects/solutions per blueprint (rename folders, update `.sln`, `.csproj`, `Directory.Build.props`), add `Directory.Packages.props` if needed, and ensure build/test scripts, CI workflows, and documentation follow new layout. Include regression checklist covering NuGet outputs, debugger packaging, and tooling discovery.
  - âœ… Rehomed runtime, debugger, tooling, samples, tests, docs, and legacy assets under the new directory taxonomy; updated `NovaSharp.sln`, helper scripts, and top-level docs to match.
  - âœ… Collapsed the interpreter `_Projects` mirror into a multi-targeted `NovaSharp.Interpreter.csproj` (netstandard2.1 + net8.0), updating dependent projects, the solution, and automation scripts.
  - âœ… Folded the VSÂ Code debugger `_Projects` mirror into the primary `NovaSharp.VsCodeDebugger.csproj` (netstandard2.1 + net8.0) and refreshed downstream project references.
  - âœ… Renamed the CLI shell to `tooling/NovaSharp.Cli/NovaSharp.Cli.csproj` and adjusted tests/solution/docs to point at the new path.
  - âœ… Audit packaging (NuGet metadata, release notes, scripts) for the CLI rename and update any hard-coded paths. `src/release_readme.txt` now documents the `cli/` drop (formerly `repl`) and `docs/ProjectStructureBlueprint.md` reflects the new naming.
  - âœ… Replaced CLI `packages/*` binaries with NuGet-managed references; ensure remaining legacy tooling cleans up any straggler DLL drops.
- **Milestone C â€“ Script & Documentation Hub (High Priority)**  
  Establish a coherent `scripts/` hierarchy and reinforce Markdown documentation so contributors have a single source of truth.
  - Audit every helper script (PowerShell, Bash, Python) and relocate them into `scripts/<area>` folders (`scripts/build`, `scripts/coverage`, `scripts/dev`), adopting descriptive names (`scripts/coverage/coverage.ps1` + `coverage.sh`, branding guards, etc.) and consistent shebang/parameter docs.
    - ğŸ”„ Seeded the hub by relocating the coverage helpers into `scripts/coverage/` (PowerShell + Bash) and adding folder-level READMEs; migrated the branding guard to `scripts/branding/ensure-novasharp-branding.sh` with its own READMEâ€”next up is the remaining legacy build helpers.
    - ğŸ”„ (2025-11-14) Staged `scripts/build/` with cross-platform wrappers (`build.ps1`/`build.sh` + README) that restore tools, run `dotnet build src/NovaSharp.sln -c <Configuration>`, and optionally execute the interpreter tests into `artifacts/test-results`; `docs/Testing.md` + `scripts/README.md` now reference the new helpers so contributors know the standard build pipeline location.
    - ğŸ”„ (2025-11-14) Updated `.github/workflows/tests.yml` to call `scripts/build/build.sh --skip-tool-restore` for the Release build + interpreter test lane, keeping CI aligned with the documented helper and ensuring TRX artifacts still land in `artifacts/test-results`.
    - âœ… (2025-11-14) Added `scripts/ci/ensure-readme-updates.sh` and wired it into the workflows so helper/script additions fail CI unless the docs index + subfolder READMEs are updated; both jobs now checkout with `fetch-depth: 0` for reliable diffs.
    - ğŸ”„ (2025-11-14) Introduced `scripts/dev/` (pre-commit installer + staged-file formatter) alongside `scripts/ci/check-markdown.sh`, `check-csharpier.sh`, and `apply-formatters.sh`; documented the workflow in `docs/Contributing.md` so contributors run `python -m pip install -r requirements.tooling.txt`, enable the shared hook, and rely on automated Markdown formatting/link checks.
    - ğŸ”„ (2025-11-14) Rebuilt the Markdown lint/link infrastructure on Python (`scripts/ci/format_markdown.py`, `scripts/ci/check_markdown_links.py`) and updated the `lint` GitHub Actions job to gate PRs on those checks + CSharpier. Failing in-repo PRs still get an auto-generated fix branch via the `lint-autofix` job (powered by `scripts/ci/apply-formatters.sh` and `peter-evans/create-pull-request`) without any Node dependencies.
  - Provide dual-platform shims where practical (PowerShell + Bash) and record fallback logic (e.g., macOS/Linux call `scripts/coverage/coverage.sh` when PowerShell is unavailable); update CI workflows and developer docs to reference the new paths.
    - âœ… Both coverage scripts now auto-set `DOTNET_ROLL_FORWARD=Major` when unset, so hosts with only .NET 9 can run coverage without extra env setup; docs updated to mention the behaviour.
    - âœ… (2025-11-14) Fixed `scripts/coverage/coverage.ps1` repo-root detection (it was stopping under `scripts/` and trying to build `scripts/src/NovaSharp.sln`), and double-checked the other helpers: `scripts/build/build.ps1` already walks two levels and the Bash coverage shim keeps `cd`-ing to `../..`.
  - Author `scripts/README.md` plus per-subfolder READMEs describing prerequisites, environment variables, and sample invocations; cross-link these from `README.md`, `docs/Testing.md`, and `docs/Modernization.md`.
    - ğŸ”„ Added a top-level `scripts/README.md` and `scripts/coverage/README.md` so contributors can discover tooling (build, coverage, branding) without spelunking.
    - ğŸ”„ Documented the modernization audit helper in `docs/Modernization.md` so contributors know how to regenerate the legacy rename report.
    - âœ… Added `docs/Contributing.md` and linked it from the README to centralize build/test/coverage/namespace guidance for new contributors.
  - Curate a documentation index (`docs/README.md`) that maps every Markdown guide (testing, modernization, Lua compatibility, benchmarks, Unity integration, coverage dashboards) and ensure each section has a clear owner/status checklist.
    - âœ… Created `docs/README.md` as a searchable index pointing to testing, coverage, modernization, Lua compatibility, performance, Unity, and scripts; linked it from the repo README.
  - Add a PR checklist/CI guard requiring new scripts to update the appropriate README entry and new docs to be linked from the index, keeping the ecosystem discoverable long-term.
    - ğŸ”„ Introduced `.github/pull_request_template.md` with checklist items for docs index + script READMEs; monitor usage before adding CI enforcement.
- **Milestone D â€“ Namespace & Using Enforcement**  
  Introduce Roslyn analyzers or custom scripts to ensure namespaces mirror the physical path + project root (`NovaSharp.Interpreter.Debugging` style), and require `using` directives to live inside namespaces. Provide migration scripts to batch-update existing files, codify exceptions for generated/bundled code, and document rules in `docs/Contributing.md`.
  - âœ… Added `tools/NamespaceAudit/namespace_audit.py` to surface directory/namespace mismatches (current hot spots: CLI/Hardwire/NovaSharp.Comparison).
  - ğŸ”„ Enhanced the audit script with category/allowlist support, aligned NovaSharp.Cli + benchmark namespaces, and wired `python3 tools/NamespaceAudit/namespace_audit.py` into CI (tests/coverage jobs) so deviations fail the build immediately.
- **Milestone E â€“ EditorConfig Adoption + Lua Exceptions**  
  Import `.editorconfig` from `D:/Code/DxMessaging-Unity/Packages/com.wallstop-studios.unity-helpers`, strip BOM (`charset = utf-8`), and align with repo conventions (CRLF is acceptable). Add sub-directory `.editorconfig` under Lua fixture folders to keep Lua-specific indentation/whitespace expectations. Document formatting commands and exception rationale in `docs/Testing.md` + PR template.
- **Milestone F â€“ Solution Organization & Naming (Current Sprint)**  
  Harden the Visual Studio solution layout and align naming with PascalCase conventions for first-party assets. Scope includes renaming the solution artifact, ensuring nested folders mirror `runtime/tooling/tests/debuggers`, and cleaning up lingering `.netcore` suffixes in project surfaces.
  - âœ… Renamed `src/NovaSharp.sln` to `src/NovaSharp.sln`, updated build/test docs, and nested Benchmarks under the Tooling solution folder to prevent empty roots.
  - âœ… Rebranded the VS Code debugger project (`NovaSharp.VsCodeDebugger.csproj`) and refreshed dependent project references to respect PascalCase naming.
  - âœ… Updated VSÂ Code debugger package metadata (dropped `.netcore` suffix) and documented the new single-source layout.

## Near-Term Priorities (ordered)
1. **Legacy âœ NovaSharp finalization**
   - âœ… Cleared the filesystem rename queue (`NovaSharp.Interpreter` attribute files, VS Code debugger scaffolding, `_Projects` mirror, JetBrains `.DotSettings`, legacy cache folders).
   - âœ… Rebranded the comparison benchmark harness (`tooling/NovaSharp.Comparison`) with default BenchmarkDotNet config and VS run target output.
   - âœ… Scrubbed `.csproj` entries referencing missing/irrelevant assets (icons, logs, keypairs) to keep IDE surfaces clean.
   - âœ… Refreshed generated artefacts (coverage, benchmarks) under the NovaSharp name and cleaned stale legacy-brand results.
  - âœ… Add guardrail automation (CI grep or analyzer) blocking regressions to the previous branding across code, docs, and assets. CI now runs `scripts/branding/ensure-novasharp-branding.sh`, which fails on new legacy-brand identifiers outside the curated allowlist (perf baseline + benchmark writer shim).
- âœ… Completed an initial vestigial inventory (`docs/modernization/vestigial-inventory.md`) highlighting keep/remove candidates (e.g., legacy REPL history) and modernization notes for performance counters.
- âœ… Audit outstanding legacy runtime issues that still apply to NovaSharp, classify real defects vs legacy gaps, and schedule fixes or deprecations accordingly. See `docs/modernization/moonsharp-issue-audit.md` for the owner/status matrix feeding the modernization tracker.
2. **Vestigial Runtime Review (Pre-Coverage)**
   - âœ… Inventory instrumentation and ancillary runtime helpers (e.g., `PerformanceStopwatch`, `GlobalPerformanceStopwatch`, `DummyPerformanceStopwatch`) â€” catalog captured in `docs/modernization/vestigial-inventory.md` (2025-11-10 snapshot).
   - âœ… Replaced remaining reflection-based access with friend-assembly visibility: `InfrastructureTests` now sets `PerformanceResult` properties directly and instantiates `ExecutionState` without reflection (Release suite 990 tests, 2025-11-12).
   - âœ… Produced keep/modernize/remove recommendations and blocked coverage expansion until the inventory landed; decisions tracked in `docs/modernization/vestigial-inventory.md`.
   - âœ… Logged the diagnostics instrumentation review in `docs/modernization/vestigial-inventory.md`; current guidance is to keep the stopwatch counters and cover them with tests (completed).
3. **Coverage Push (>90%)**
   - âœ… Completed Milestone 0 baseline capture by rerunning `./scripts/coverage/coverage.ps1` (2025-11-11), recording 67.8â€¯% line / 69.7â€¯% branch / 72.1â€¯% method coverage (NovaSharp.Interpreter 81.0â€¯% line), and updating `docs/Testing.md` + coverage exports to document the helper workflow.
  - âœ… Begin Milestone 1 by targeting parser + metatable hot spots and porting CLI shell tests.
  - âœ… Drafted GitHub workflow updates with conditional coverage gating: `code-coverage` job now runs an `Evaluate coverage threshold` step that parses `Summary.json`, warns when line coverage falls below 85â€¯% in monitor mode, and supports flipping to `COVERAGE_GATING_MODE=enforce` once â‰¥85â€¯% is sustained.
  - ğŸ”œ Establish an interpreter coverage lock at â‰¥95â€¯% line / branch / method: continue targeting the remaining low-cover hotspots, add guards in `scripts/coverage/coverage.ps1` to fail when the interpreter dips under 95â€¯% for any metric, and document the enforcement toggle (with latest percentages) in `docs/Testing.md` once the thresholds are consistently met.
    - ğŸ”„ Both coverage helpers (`scripts/coverage/coverage.ps1` + `.sh`) now parse line/branch/method coverage for the interpreter and honour `COVERAGE_GATING_MODE` (`monitor` logs warnings at â‰¥95â€¯% targets, `enforce` fails the run). Each script also exposes branch/method threshold overrides so local runs can experiment with stricter gates before CI flips to enforce mode.
    - ğŸ”„ (2025-11-16 19:17 UTC) Backfilled `JsonTableConverter` + `ObjectValueConverter` via new unit suites (edge-path JSON parsing, null/enum serialization, IEnumerable expansion, static-property reflection) and reran `./scripts/coverage/coverage.ps1 -SkipBuild`. Interpreter coverage now sits at **93.4â€¯% line / 89.9â€¯% branch / 95.9â€¯% method** across **1â€¯972** Release tests; `docs/coverage/latest` + `docs/coverage/coverage-hotspots.md` capture the snapshot and remaining delta to the 95â€¯% gate.
    - ğŸ”„ (2025-11-16 19:40 UTC) Extended coverage to the `Script` entry points via `ScriptLoadTests` (base64 dumps, `LoadStream` text vs dump paths, `Dump` argument guards, loader return-cases, metamethod + CLR/object `Call` overloads, coroutine recycling, `RunFile`/`RunString`). The latest `./scripts/coverage/coverage.ps1 -SkipBuild` run lifts `NovaSharp.Interpreter.Script` to **93.1â€¯% line / 82.7â€¯% branch / 95.9â€¯% method** and overall interpreter coverage to **93.5â€¯% line / 90.0â€¯% branch / 95.9â€¯% method** across **1â€¯989** Release tests, leaving ~1.5â€¯% of line coverage before we flip the CI gate to enforce mode.
    - ğŸ”„ (2025-11-16 19:54 UTC) Followed up with a DynValue sweep (`Units/DynValueTests`) covering clone/assign/read-only guards, coroutine wrapping, StringBuilder constructors, CLR-function `ToString`, `CheckType` auto conversions, and `CheckUserDataType` nil allowances. `NovaSharp.Interpreter.DataTypes.DynValue` now sits at **87.0â€¯% line / 76.7â€¯% branch / 97.1â€¯% method**, nudging interpreter totals to **93.6â€¯% line / 90.1â€¯% branch / 95.9â€¯% method** across **2â€¯000** Release tests and shrinking the remaining gap to the â‰¥95â€¯% enforcement threshold.
    - ğŸ”„ (2025-11-18 09:28 UTC) Added targeted regression coverage for ScriptOptions, the REPL, ScriptPrivateResourceExtension, and StandardPlatformAccessor, fixing the discovered runtime gaps along the way. `ScriptOptionsTests.CopyConstructorClonesConfiguredValues` now forces the copy constructor to propagate `ColonOperatorClrCallbackBehaviour` (patched), `ReplInterpreterTests.DynamicExpressionReturnsComputedValueWhenCodeIsPresent` + `DynamicExpressionHandlesEmptyCodeAsVoid` exercise both `?expr` and blank `?` paths (the latter now clears `_currentCommand`), `ScriptPrivateResourceExtensionTests` cover null/non-resource DynValues and the `CheckScriptOwnership(Script)` overload, and `StandardPlatformAccessorTests` hit the fallback `ParseFileAccess` branch plus the invalid standard-stream guard. `./scripts/coverage/coverage.ps1 -SkipBuild` (2â€¯212 tests) now reports NovaSharp.Interpreter at **95.3â€¯% line / 92.2â€¯% branch / 97.4â€¯% method**, trimming the branch delta to ~2.8â€¯pp and clearing the REPL + ScriptOptions items off the red list; remaining branch debt sits in `AssignmentStatement`, `TablePair`, the descriptor helpers, and VM bytecode before we can flip the â‰¥95â€¯% gate to enforce mode.
    - ğŸ”„ (2025-11-18 10:13 UTC) Followed up with `Units/AssignmentStatementTests`, building manual `ScriptLoadingContext` instances so we can assert `<const>`/`<close>` combinations plus the duplicate/unknown attribute diagnostics without spinning up the Lua parser. The suite also keeps the â€œnon-variable assignmentâ€ failure under test. `AssignmentStatement` now reports **92.7â€¯% line / 95.4â€¯% branch / 100â€¯% method**, interpreter coverage sits at **95.35â€¯% line / 92.24â€¯% branch / 97.53â€¯% method** across **2â€¯216** Release tests, and the remaining <90â€¯% debt is concentrated in `Errors.SyntaxErrorException`, `AutoDescribingUserDataDescriptor`, `DataTypes.TablePair`, and the VM bytecode helpers. Once those cross the 95â€¯% line/branch threshold we can flip `COVERAGE_GATING_MODE` to `enforce`.
  - ğŸ”„ (2025-11-16 14:20 UTC) Temporarily defaulted `.github/workflows/tests.yml` back to `COVERAGE_GATING_MODE=monitor` so CI emits warnings while the remaining <95â€¯% interpreter classes are covered; the workflow still honours `vars.COVERAGE_GATING_MODE` for branches that wish to opt into enforcement.
  - âœ… Expanded Hardwire coverage scaffolding: interpreter test suite now references `NovaSharp.Hardwire`, exposes internals via `InternalsVisibleTo`, and adds `HardwireGeneratorRegistryTests`/`HardwireCodeGenerationContextTests` to lock in registry fallbacks, assembly discovery, logging, and visibility gating behaviours ahead of deeper generator coverage pushes.
   - âœ… Added `HardwireParameterDescriptorTests` plus dispatch-focused `HardwireCodeGenerationContextTests` coverage, ensuring ref/out validation, default-parameter metadata, registry error paths, and initialization wiring are exercised so NovaSharp.Hardwire line coverage begins moving off the 22â€¯% floor.
   - âœ… Hardened `scripts/coverage/coverage.ps1` to surface failing builds: logs the full `dotnet build` output, explicitly builds the interpreter test project, and reports actionable messages (including log locations) when the runner DLL is missing or build steps fail.
   - âœ… Backfilled NovaSharp.Hardwire generator coverage by introducing `HardwireGeneratorTests` which verify BuildCodeModel registrations and `AllowInternals` propagation, while adding deterministic registry stubs; interpreter suite now drives Hardwire line coverage to ~29â€¯%.
   - âœ… Extended `HardwireGeneratorTests` to cover ref/out default dispatch, property setter special-names, and static indexer warningsâ€”verifying both generated source and emitted diagnostics so MethodMemberDescriptorGenerator edge paths stay under regression.
   - âœ… Hardened `HardwireParameterDescriptorTests` to assert default-value placeholders emit `DefaultValue` instances, keeping `HardwiredDescriptors.DefaultValue` under coverage.
   - âœ… Added `StandardUserDataDescriptorGeneratorTests` to verify member/meta-member wiring so `StandardUserDataDescriptorGenerator` emits `AddMember`/`AddMetaMember` calls with the expected descriptors.
   - âœ… Added Lua `io.read("*n")` edge-case coverage (exponent-only tokens, hex literals, exponent overflow) with NUnit scenarios now skipped pending parity; documented the gap in `docs/LuaCompatibility.md` to highlight the remaining divergence from Lua 5.4.8 parsing rules.
   - Resolve uncovered behaviours by shipping production fixes when necessary; correctness improvements take priority over keeping the existing implementation untouched.
   - âœ… Stand up a Red/Green tracking doc (`docs/coverage/coverage-hotspots.md`) that enumerates interpreter hotspots still below 90â€¯% with provisional owners.
   - ğŸ” Drive `NovaSharp.Interpreter` coverage to â‰¥95â€¯% line / â‰¥95â€¯% branch / â‰¥95â€¯% method by iterating on the red-list in `docs/coverage/coverage-hotspots.md`; treat any class below that threshold as a release blocker.
    - ğŸ”„ Added dedicated unit suites for `UnaryOperatorExpression` and `BinaryOperatorExpression`, pushing their coverage to **100â€¯%** and **87â€¯%** line respectively and clearing previously untested Eval branches.
    - ğŸ”„ (2025-11-14) Added `OverloadedMethodMemberDescriptorTests` to stress cache reuse (userdata + primitive signatures), extension method snapshots (enabled vs. ignored), varargs scoring, callback/value accessors, wiring serialization, optimizer delegation, and failure paths; `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter "FullyQualifiedName~OverloadedMethodMemberDescriptorTests"` keeps the new scenarios green, lifting the descriptor to **82.2â€¯%** line / **92.2â€¯%** branch / **78.2â€¯%** method coverage with follow-up work remaining for cache overflow and additional scoring branches.
    - ğŸ”„ (2025-11-14) Expanded those tests with reflection helpers so we now execute the cache-overflow guard, varargs exact-match scoring, empty-varargs weighting, enumerable constructor, extension-method refresh, non-wireable wiring output, and `IsStatic` property paths. Coverage still reports **82.2â€¯%** line because the remaining uncovered statements are either trivially inlined (IEnumerable ctor, `get_IsStatic`) or defensive code that never triggers (`_cache.Length == 0`, by-design `PrepareForWiring` fallbacks). Logged the outstanding lines (94-97, 141, 270-277, 415-436, 529-533, 552, 585-586, 613-618) so the modernization effort can either delete them or mark them `Debug.Assert` when we refactor the descriptor.
    - ğŸ”„ (2025-11-15) Reintroduced the richer `OverloadedMethodMemberDescriptorTests` with typed `GetInstanceMethod`/`GetStaticMethod` helpers and explicit callback delegates so IDE0008 analyzers stay quiet, refreshed expectations around `GetValue` (returns `DataType.ClrFunction`) and codified the current scoring behaviour in `ExecutePrefersExactMatchOverVarArgsWhenPenaltiesApply` (extra-arg malus still outweighs the varargs bonusâ€”follow-up noted to revisit the heuristic). `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter "FullyQualifiedName~OverloadedMethodMemberDescriptorTests"` is green again.
    - ğŸ”„ (2025-11-15) Extended `LuaStateInteropToolsTests` (Lua 5.4 Manual Â§6.4 String Manipulation) with coverage for explicit parameter indexes, `'` thousands-grouping, `%h`/`%l` length modifiers, string precision truncation, `%c` string inputs, and the fallback path for unsupported specifiers so `LuaStateInterop.Tools` finally exercises the padding/flag combinations that were still red. `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --no-build --filter "FullyQualifiedName~LuaStateInteropToolsTests"` now covers the remaining branches before we tackle the CLI-facing Lua formatting helpers.
    - ğŸ”„ (2025-11-15) Added regression tests for `%#08X`, `%#o` with zero, and `%+06d` to hit the right-align/alternate branches inside `FormatHex`, `FormatOct`, and `FormatNumber`. `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --no-build --filter "FullyQualifiedName~LuaStateInteropToolsTests"` stays green and `LuaStateInterop.Tools` line coverage now reports **77.6â€¯%**.
    - ğŸ”„ (2025-11-15 20:27 UTC) Added `Units/CustomConverterRegistryTests` to cover duplicate registration/replacement, removal, typed + obsolete CLR bridge overloads, and `Clear`, and tightened `CustomConverterRegistry` so DataTypes â‰¥ `MAX_CONVERTIBLE_TYPES` short-circuit instead of indexing past the backing arrays. `ScriptToClrConversionsTests` now drive optional parameter defaults, numeric/string coercions, callback delegates, table conversions, userdata string fallbacks, and weighting logic so `ScriptToClrConversions` rises to **82.0â€¯% line / 80.3â€¯% branch / 100â€¯% method** (was 72.8â€¯%). `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter "FullyQualifiedName~CustomConverterRegistryTests"` / `--filter "FullyQualifiedName~ScriptToClrConversionsTests"` plus `./scripts/coverage/coverage.ps1` now report `CustomConverterRegistry` at **100â€¯% line / 100â€¯% branch / 100â€¯% method**, interpreter totals at **91.3â€¯% line / 87.7â€¯% branch / 93.5â€¯% method**, and the Release suite at **1â€¯776** tests.
    - ğŸ”„ (2025-11-15 20:52 UTC) Added `Units/EnumerableWrapperTests` covering iterator tuples, `__call` progression, nil-skipping, enumerator reset guards, table-backed enumerables, and the exposed `Current`/`MoveNext`/`Reset` userdata members. `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter "FullyQualifiedName~EnumerableWrapperTests"` plus `./scripts/coverage/coverage.ps1` now report `EnumerableWrapper` at **95.2â€¯% line / 88.4â€¯% branch / 88.8â€¯% method**, pushing interpreter totals to **91.35â€¯% line / 87.84â€¯% branch / 93.61â€¯% method** across **1â€¯780** Release tests and removing the wrapper from the priority red list.
    - ğŸ”„ (2025-11-15 21:17 UTC) Added `Units/BreakStatementTests` exercising the parser/VM guard rails (`break` outside loops, `break` inside standalone functions, and `break` nested inside functions defined within loops) so the `LoopTracker` boundary logic now has direct regression coverage. `dotnet test ... --filter "FullyQualifiedName~BreakStatementTests"` plus `./scripts/coverage/coverage.ps1` report `BreakStatement` at **100â€¯% line / 100â€¯% branch / 100â€¯% method**, with interpreter totals holding at **91.39â€¯% line / 87.85â€¯% branch / 93.61â€¯% method** across **1â€¯783** Release tests.
    - ğŸ”„ (2025-11-15 21:26 UTC) Added `Units/ProxyUserDataDescriptorTests` to validate proxy creation for `Index`/`SetIndex`/`MetaIndex`/`AsString`, friendly-name plumbing, null-instance passthrough, and `IsTypeCompatible` behaviour. `dotnet test ... --filter "FullyQualifiedName~ProxyUserDataDescriptorTests"` plus the refreshed coverage run now report the descriptor at **100â€¯% line / 100â€¯% branch / 100â€¯% method** and interpreter totals at **91.42â€¯% line / 87.87â€¯% branch / 93.81â€¯% method** across **1â€¯791** Release tests.
    - ğŸ”„ (2025-11-16 07:40 UTC) Extended `ScriptToClrConversionsTests` with tableâ†’dictionary conversions (generic + object), tuple fall-through validation, empty-string char coercion failures, and table-to-dictionary weighting assertions. Coverage run `./scripts/coverage/coverage.ps1` now records `ScriptToClrConversions` at **82.0â€¯% line / 80.3â€¯% branch / 100â€¯% method** (still below the 90â€¯% gate but with the new edge cases locked in) and overall interpreter totals at **91.44â€¯% line / 87.95â€¯% branch / 93.81â€¯% method** across **1â€¯796** Release tests.
    - ğŸ”„ (2025-11-16 07:56 UTC) Backfilled the remaining `ScriptToClrConversions` gaps by exercising `DynValueToObject` (custom converter wins, void/nil fallbacks, closure/table/tuple returns, descriptor-only userdata, callback propagation, unsupported throws), adding explicit script/CLR-function conversions (closure + delegate bridges, callback-function round-trips, optional-nil defaults), and covering the matching weight helpers. `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter "FullyQualifiedName~ScriptToClrConversionsTests"` plus `./scripts/coverage/coverage.ps1` now report `ScriptToClrConversions` at **99.4â€¯% line / 98.8â€¯% branch / 100â€¯% method** and overall interpreter coverage at **91.67â€¯% line / 88.37â€¯% branch / 93.81â€¯% method** with **1â€¯821** Release tests (interpreter red list is currently empty).
    - ğŸ”„ (2025-11-16 17:25 UTC) Unblocked `LuaBaseTests` discovery by adding the missing `NovaSharp.Interpreter.Errors` import, replacing the implicit tuple array with an explicit `(DynValue Value, int Expected)[]`, and fixing the coroutine factory literal so `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter "FullyQualifiedName~LuaBaseTests"` now executes all six fixtures. Exercising the nil-padding scenario exposed a production bug (`LuaBase.LuaCall` never incremented `copied` while filling out the requested result slots), so the loop now advances after each `DynValue.Nil` push instead of allocating until OOM. `./scripts/coverage/coverage.ps1 -SkipBuild` reports NovaSharp.Interpreter at **93.15â€¯% line / 89.73â€¯% branch / 95.26â€¯% method** across **1â€¯958** Release tests, with `LuaStateInterop.LuaBase` up to **91.3â€¯% line / 88.3â€¯% branch / 81.1â€¯% method** and both the MULTRET and nil-padding behaviours locked down.
    - ğŸ”„ (2025-11-16 17:48 UTC) Expanded `LuaBaseTests` with paired suites so every synthetic scenario now has a native Lua twin. (a) loops in `LuaStringHelpersExposeRawStringValues`, `LuaIntegerChecksValidateNumbers`, `LuaArgCheckThrowsWhenConditionFails`, `LuaGetTableReturnsRawValuesAndThrowsOnNonTables`, and `LuaCallSupportsMultiReturnAndNilPadding` iterate across both handcrafted `DynValue` inputs and values returned from real Lua code (including coroutine threads); (b) `LuaTypeHandlesâ€¦` + `LuaTypeClassifiesValuesProducedByLuaScripts` prove Lua-produced values match the synthetic expectations; and (c) the stack/buffer helper suite replays the same assertions for Lua-returned strings. `LuaTypeRejectsSyntheticTailCallYieldAndTupleRequests` still relies on `DynValue.NewTailCallReq/NewYieldReq` (Lua collapses those request nodes inside the VM before managed code can observe them), but now includes a Lua multi-return tuple to keep the guard documented. Interpreter coverage holds at **93.15â€¯% line / 89.73â€¯% branch / 95.26â€¯% method**.
    - ğŸ”„ (2025-11-16 15:12 UTC) Added `Units/InstructionFieldUsageExtensionsTests` to enumerate every opcode bucket inside `InstructionFieldUsageExtensions.GetFieldUsage` (default no-op, tuple/symbol combos, jump offsets, closure metadata, meta/name branches). `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter "FullyQualifiedName~InstructionFieldUsageExtensionsTests"` hits all 17 paths, and the refreshed `./scripts/coverage/coverage.ps1 -SkipBuild` run pushes `NovaSharp.Interpreter.Execution.InstructionFieldUsageExtensions` to **100â€¯% line / 100â€¯% branch / 100â€¯% method**. Interpreter totals now sit at **92.93â€¯% line / 89.44â€¯% branch / 94.97â€¯% method** across **1â€¯940** Release tests, with artefacts updated under `docs/coverage/latest`.
    - ğŸ”„ (2025-11-16 15:28 UTC) Backfilled `FunctionCallExpression` by introducing `Units/FunctionCallExpressionTests` (paren vs. string vs. table arguments, colon/`this` calls, and premature-stream errors). `dotnet test ... --filter "FullyQualifiedName~FunctionCallExpressionTests"` plus the latest `./scripts/coverage/coverage.ps1 -SkipBuild` pass now report `NovaSharp.Interpreter.Tree.Expressions.FunctionCallExpression` at **98.2â€¯% line / 95.4â€¯% branch / 75â€¯% method** (call/constructor paths fully exercised), nudging interpreter totals to **93.0â€¯% line / 89.47â€¯% branch / 94.97â€¯% method** across **1â€¯945** Release tests and updating `docs/coverage/latest`.
    - ğŸ”„ (2025-11-16 15:38 UTC) Added `Units/PlatformAutoDetectorTests` covering Unity flag detection via a dynamically emitted `UnityEngine.*` type, explicit Unity overrides, and the cached `IsRunningOnAot` probe path (including the cached/catch branch trigger through a forced reflection override). Coverage run `./scripts/coverage/coverage.ps1 -SkipBuild` now reports `NovaSharp.Interpreter.Platforms.PlatformAutoDetector` at **91.1â€¯% line / 100â€¯% branch / 100â€¯% method** (catch path remains unreachable without an actual AOT runtime), with interpreter totals steady at **93.02â€¯% line / 89.51â€¯% branch / 95.02â€¯% method** across **1â€¯948** Release tests; hotspots doc updated accordingly.
    - ğŸ”„ (2025-11-16 16:07 UTC) Extended `PlatformAccessorBaseTests` with Unity DLL-mono/unknown suffix scenarios, a dotnet fallback guard, and a dedicated `BaseDefaultInputAccessor` to exercise the base `DefaultInput` implementation. `dotnet test ... --filter "FullyQualifiedName~PlatformAccessorBaseTests"` plus the refreshed `./scripts/coverage/coverage.ps1 -SkipBuild` run keeps `NovaSharp.Interpreter.Platforms.PlatformAccessorBase` at **84â€¯% line / 78.5â€¯% branch** (Release inlines the `return null` fast path, so those sequence points remain dark), but every suffix/input branch now has explicit regression coverage documented under `docs/coverage/latest`.
    - ğŸ”„ (2025-11-15) Hardened `UnityAssetsScriptLoaderTests` (no Unity stubs required) to validate path normalization (forward + backslashes), dictionary snapshotting, and the helpful missing-resource exception guidance so Unity consumers have regression coverage without tripping the default platform detector. Still need to follow up with true reflection tests in a Unity host once we stand up platform-specific harnesses. `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --no-build --filter "FullyQualifiedName~UnityAssetsScriptLoaderTests"` stays green.
    - ğŸ”„ (2025-11-15) Added `UserDataTests` to exercise the custom descriptor registration paths, registered-type history, proxy registration, extension-method registry change version, base-type/interface fallback logic in `TypeDescriptorRegistry`, equality semantics (matching descriptors, static userdata, null/instance mixes), and `Create(Type)` static handling, so `NovaSharp.Interpreter.DataTypes.UserData` now covers the descriptor cache/hardwire toggles called out in `docs/coverage/coverage-hotspots.md`. Verified with `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --no-build --filter "FullyQualifiedName~UserDataTests"`.
    - ğŸ”„ (2025-11-15) `UserDataTests` now also registers an `IUserDataType` implementation to verify the auto-describing descriptor path (generation via `IGeneratorUserDataDescriptor`), covering the polymorphic branch in `TypeDescriptorRegistry`. `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --no-build --filter "FullyQualifiedName~UserDataTests"` + `--filter "FullyQualifiedName~AutoDescribingUserDataDescriptorTests"` remain green.
    - ğŸ”„ (2025-11-14) Extended `BinaryOperatorExpressionTests` with string comparison/equality edge cases, a `CreatePowerExpression` regression, and compile-time opcode mapping (arithmetic, concatenation, comparison, `~=`, inversion guards). `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release --filter "FullyQualifiedName~BinaryOperatorExpressionTests"` passes, exercising `OperatorToOpCode`, `ShouldInvertBoolean`, and the remaining Eval branches so the class can climb past the 90â€¯% line gate next coverage sweep.
   - Expand NUnit suites (parser, metatables, IO/OS TAP replacements) until nightly coverage reports consistently exceed 90â€¯% line/branch for `NovaSharp.Interpreter`, `NovaSharp.Cli`, and `NovaSharp.Hardwire`.
   - âœ… Added `ParserTests` coverage for hex float literals, Unicode escape decoding, and decimal-escape guardrails so `LexerUtils` error surfaces stay exercised and decorated messages reference the offending token.
   - âœ… Expanded `MetatableTests` to cover callable tables, custom `__pairs` iterators, and protected metatable failures under `CoreModules.PresetComplete`, ensuring metamethod regressions are caught without relying on TAP fixtures.
   - âœ… Raised the coverage gate to 90â€¯% and flipped `.github/workflows/tests.yml` to enforce failures when Summary.json reports line coverage below the threshold (still overridable via `COVERAGE_GATING_MODE` repo vars).
   - âœ… Ported CLI shell REPL loop tests (command dispatch, evaluation output, interpreter/general exception handling) so interactive pathways run under NUnit with redirected console input.
  - âœ… Hardened CLI coverage across `Program`, `CommandManager`, `Run`, `Register`, `Compile`, `Debug`, `Help`, and `HardWire` commands; Release suite at 687 tests after deterministic hardwire + help harnesses.
  - âœ… Added Lua-level regression tests for `os.time`, `os.difftime`, and `os.date` (string + table forms), covering missing-field errors and placeholder week specifiers; Release suite climbs to 701 tests.
  - âœ… Added math module regression tests hitting logarithms (default/custom base), power, modf, min/max aggregators, ldexp, deterministic random sequences, and NaN/overflow behaviors.
  - âœ… Replaced `LinqHelpers` LINQ usage with allocation-free iterators and backed the helpers with unit tests to unblock future analyzer enforcement around `System.Linq` usage in hot paths.
  - âœ… Added `UnityAssetsScriptLoader` unit tests using an in-memory resource map, covering path trimming, not-found errors, existence checks, and loaded-script enumeration without relying on Unity runtime types.
  - âœ… Implemented root-scope `<close>` handling by seeding to-be-closed tracking in `Processor.ExecBeginFn` and rerunning the Release interpreter suite (1336 pass / 2 skip) to validate the change.
  - âœ… Mirrored Lua TAP `io.read` number cases by extending `FileUserDataBase.ReadNumber` (hex floats, huge exponents) and activating NUnit coverage in `IoModuleTests`.
  - âœ… Introduced `LuaCompatibilityVersion` plumbing (global + per-script options) so callers can pin interpreter behaviour to Lua 5.5/5.4/5.3/5.2 or stay on the rolling `Latest` target.
  - âœ… Captured a naming audit (`docs/style/naming-audit.md`) covering `Emit_*` helpers and `i_` prefixed members to guide the upcoming renaming pass.
  - âœ… Normalized enum declarations: every enum now starts with an obsolete `None`/`Unknown` at value 0, all subsequent values are explicit (flags use `1 << n`), and call sites favor defaults over obsolete sentinels to avoid new warnings.
  - âœ… **Harvest real-world Lua suites.**
    - Added `json.lua` (rxi, v0.1.2) and `inspect.lua` (kikito, v3.1.0) under `src/tests/NovaSharp.Interpreter.Tests/Fixtures/RealWorld`, preserving upstream MIT licenses.
    - Introduced `RealWorldScriptTests` to load the fixtures via `Script.DoString`, exercising JSON encode/decode and table inspection scenarios to guard against regressions.
    - Refreshed `docs/testing/real-world-scripts.md` and `docs/ThirdPartyLicenses.md` with provenance metadata, paths, and maintenance guidance for future corpus growth.
  - âœ… **Feature coverage checklist.**
    - Added a sectioned Lua 5.4 parity matrix to `docs/LuaCompatibility.md`, covering syntax, standard libraries, metatables/GC, and coroutine semantics with status, coverage links, and owners.
    - Highlighted gaps for `<close>` variables, weak/ephemeron tables, string pack/unpack, IO hex parsing, and GC modes so they flow into runtime modernization follow-ups.
    - Documented observability actions (enabling disabled TAP suites, filing issues for âŒ entries) to keep parity efforts actionable.
    - **Golden rule:** when a regression test fails, assume the production implementation is wrong until proven otherwise. Review the official Lua 5.4 reference manual (`https://www.lua.org/manual/5.4/`) to confirm expected behavior, and prioritize fixes that bring NovaSharp back to Lua 5.4 compliance rather than weakening or deleting tests.
  - âœ… Verified `NovaSharpHideMemberAttribute` hides methods/properties (including inherited members) by registering sample userdata and asserting scripts only see the intended surface.
  - âœ… Added coverage for `FastStackDynamic<T>` operations, REPL module path resolution (environment + `LUA_PATH` overrides), `CoreLib.IO.BinaryEncoding` round-trips, and hardwired descriptor metadata checks to prep Roslyn parity.
  - âœ… Added guardrail tests around `InvalidScriptLoader` failure paths to keep runtime diagnostics stable when custom loaders plug in.
   - âœ… Exercised hardwired member/method descriptors via targeted hardwired userdata tests (read/write gating, optional-argument marshalling, static access guards), removing the zero-coverage gap from the excluded auto-generated harness.
   - âœ… Expanded `ReflectionSpecialName` unit coverage to map every operator/event/indexer branch (true/false, unary/binary symbols, namespaced members), ensuring the helper enum conversion stays under regression.
   - ğŸ”„ New: bake "extreme path" coverage into every milestoneâ€”add tests for undersized buffers, null inputs, unexpected/malformed data, multiple/simultaneous control-flow exits (`break`, `goto`, nested functions), and other non-happy paths (e.g., BinaryEncoding invalid arrays). Track gaps per hotspot and refuse closure until happy + edge paths are both covered. BreakStatement now has dedicated coverage for loop boundaries, nested functions, and multiple `break` points to model the expected depth for other interpreter operations.
     - âœ… Extended `BinaryEncodingTests` with offset/zero-count/destination-null cases so every guard path in `ValidateDestination`/`ValidateBufferRange` now executes under NUnit.
   - âœ… Expanded `DebugModule` coverage to include CLR function upvalue handling, invalid `upvaluejoin` indices, non-string traceback messages, and coroutine/thread traces; edge-path assertions now guard previously untested branches.
   - âœ… Covered `pcall`/`xpcall` CLR edge paths (tail-call continuations, yield requests, handler-before-unwind decoration) so `ErrorHandlingModule` red-list gaps now assert both happy and unhappy flows.
   - âœ… Exercised `pcall`/`xpcall` tail-call forwarding, argument propagation, and CLR handler success paths; rerun `scripts/coverage/coverage.ps1` to capture the >90â€¯% lift for `ErrorHandlingModule`.
   - âœ… Exercised `HardwiredMemberDescriptor` default getter/setter implementations so the base-path exceptions are now under coverage; only the by-ref conversion scenarios remain red-listed.
   - âœ… Added parameterised coverage for `ReflectionSpecialName` arithmetic/relational operator mappings; refreshed coverage now reports 95.8â€¯% line / 100â€¯% branch so the class exits the red list.
   - âœ… Covered `DynValueMemberDescriptor` getters, CLR function execution flags, setter guard, and wiring fallbacks (primitive/table/userdata/unsupported) to lift the descriptor from 17â€¯% to double-digit green coverage.
   - âœ… Stream file coverage now includes signed exponent parsing, standalone-sign rewinds, numeric byte-count EOF, and invalid option guards; `StreamFileUserDataBase` sits at 83â€¯% line / 82â€¯% branch after the latest `StreamFileUserDataBaseTests`.
   - âœ… `Slice<T>` gained focused coverage (enumeration, reversed views, copy semantics, read-only guards) pulling it out of the low-coverage bucket while validating exception surfaces.
    - âœ… Exercised `debug.debug` interactive edge paths (return values, CLR exception surfaces, whitespace/no-op input, null provider) to chip away at the remaining `DebugModule` debt; rerun `scripts/coverage/coverage.ps1` to capture the new lines and confirm the 91â€¯% / 78â€¯% snapshot.
    - âœ… Hardened `OsTimeModule` against edge inputs (missing month/year fields, pre-epoch timestamps, invalid specifiers, escape sequences) and verified `os.clock` monotonic behaviour; Release suite holds at 990 tests (2025-11-12).
    - âœ… Covered `DebuggerAction` constructor/timestamp, aging behaviour, defensive line storage, and breakpoint formatting so debugger actions exit the red list; interpreter Release suite at 1001 tests (2025-11-12).
    - âœ… Composite user-data aggregation now covered end-to-end (index, set, meta, metadata) via `CompositeUserDataDescriptorTests`, lifting coverage above 92â€¯% and pushing the Release suite to 1008 tests (2025-11-12).
    - âœ… Added `UndisposableStreamTests` to assert dispose/close suppression, synchronous/asynchronous forwarding, timeout propagation, and metadata passthrough; interpreter suite now totals 1019 tests with `UndisposableStream` at 94â€¯% line coverage (2025-11-12).
    - âœ… `LuaStateInteropToolsTests` cover numeric detection, rounding, meta-character decoding, and representative `sprintf` flag combinations, pushing `LuaStateInterop.Tools` beyond 90â€¯% line coverage (2025-11-12).
    - âœ… `PlatformAccessorBaseTests` toggle detector flags to verify mono/unity suffixes, portable/AOT annotations, and default input bridging; Release suite now reports 1023 tests (2025-11-12).
    - âœ… Unary operator suite now exercises runtime error paths (unexpected operator evaluation) in addition to happy-path negation/length/logical cases; bytecode guardrails remain green with compile-time invalid operator assertions.
    - âœ… Event facade + descriptor coverage now exercises static events, duplicate-removal guardrails, and unknown-handler removals; `TestHelpers.CreateExecutionContext` now calls `Script.CreateDynamicExecutionContext()` so the unit suite avoids reflection. Interpreter suite climbs to 1â€¯038 tests after the new cases (2025-11-13).
    - âœ… Scheduled the repo-wide reflection/`nameof` audit: captured current usages in `docs/modernization/reflection-audit.md` and linked the policy in `AGENTS.md` so future changes document additions before implementation.
   - âœ… Plan the test-suite reorg: drafted `docs/testing/test-suite-reorg-proposal.md` outlining the target folder hierarchy, namespace conventions, migration steps, and open questions for maintainer review.
   - âœ… Added `HardwiredDescriptorTests` covering member read/write conversions and method argument marshalling/defaults, pairing with existing `PermanentRegistrationPolicy` tests to clear the interop red-list backlog; rerun `scripts/coverage/coverage.ps1` to confirm instrumentation reflects the new lines.
   - âœ… Extended `OsSystemModule` edge-path coverage (non-zero exits, missing files, move/delete failures, locale placeholder) capturing 98â€¯% line coverage; runtime red list now narrowed to `DebugModule` interactive paths.
   - âœ… Added injectable console hooks + regression tests for `debug.debug`, enabling automated coverage of command execution, error reporting, and queued returns.
 - âœ… Drove `FileUserDataBase`/`StreamFileUserDataBase` coverage by stubbing stream failures (seek/flush/setvbuf) and verifying IO module fallbacks.
  - ğŸ” **Raise NovaSharp.Interpreter coverage to â‰¥95â€¯% line / branch / method.**  
    - Identify remaining gap areas (e.g., coroutine corner cases, Lua 5.4 features, IO/OS modules) via the latest `scripts/coverage/coverage.ps1` HTML dashboards.
    - Prioritize unit/integration tests that close the gaps without brittle assertions; update TAP fixtures where feasible.
    - Treat this as blocking before moving on to broader allocation/interop work; track progress weekly in `docs/coverage/coverage-hotspots.md`.
    - ğŸ”„ (2025-11-16 20:14 UTC) Landed `Units/PropertyMemberDescriptorTests` (attribute-driven visibility overrides, lazy/static optimization, metadata wiring) and new `ReflectionSpecialNamesTests` equality/hash coverage, then patched `PropertyTableAssigner.SetSubassignerForType` so removing a subassigner falls back to CLR conversions instead of dereferencing `null`. The latest `./scripts/coverage/coverage.ps1 -SkipBuild` run executes **2â€¯019** Release tests, reports `ReflectionSpecialName` at **100â€¯% line / 99.2â€¯% branch / 100â€¯% method**, `PropertyMemberDescriptor` up to **87.1â€¯% line / 91.1â€¯% branch / 94.1â€¯% method** (still on the red list but no longer untested), `PropertyTableAssigner` at **96.9â€¯% line / 98.0â€¯% branch**, and overall interpreter coverage at **93.7â€¯% line / 90.3â€¯% branch / 96.2â€¯% method**.
    - ğŸ”„ (2025-11-16 21:20 UTC) Broadened `Units/StandardEnumUserDataDescriptorTests` with signed/unsigned XOR + NOT permutations, `hasAll`/`hasAny` boolean assertions, argument-count failures, and cross-descriptor mismatch guards, then rebuilt in Release so coverlet sees the new fixtures. `StandardEnumUserDataDescriptor` now reports **95.0â€¯% line / 96.6â€¯% branch / 100â€¯% method**, retiring it from the red list and nudging interpreter totals to **93.8â€¯% line / 90.4â€¯% branch / 96.2â€¯% method** across **2â€¯029** Release tests.
    - ğŸ”„ (2025-11-16 21:41 UTC) Added `Units/DebugServiceTests` to capture `SourceCode` notifications and call `DebugService.ResetBreakPoints` directly, proving it delegates to the `Processor` and surfaces `OwnerScript`. `DebugService` now reports **100â€¯% line / 100â€¯% method** (up from **83â€¯% / 66â€¯%**), leaving the red list and nudging interpreter totals to **93.9â€¯% line / 90.4â€¯% branch / 96.3â€¯% method** across **2â€¯030** Release tests.
   - ğŸ”„ (2025-11-17 10:01 UTC) Expanded `Units/TableTests` to cover constructor array initialization, `Table.Clear`, the object/object[] setters, nested removal, raw-get overloads, additional `Remove` paths, and the `Keys` iterator. Behaviour is now exercised end-to-end even though instrumentation still reports **85.8â€¯% line / 81.9â€¯% branch** for `Table`, so the class remains on the red list while we target `PerformTableSet` and length-cache invalidation. Interpreter totals now sit at **94.1â€¯% line / 90.6â€¯% branch / 96.6â€¯% method** across **2â€¯039** Release tests.
   - ğŸ”„ (2025-11-17 10:40 UTC) Landed a second tranche of coverage for `Table` (boxed string/int/`DynValue` removals, fractional-number keys, `Set(object[])` null/empty guards, and raw-get fallbacks) plus `ReplInterpreterScriptLoader` (`NovaSharp_PATH` whitespace ignore + explicit `LUA_PATH` miss). The latest `./scripts/coverage/coverage.ps1 -SkipBuild` run (still warning about `NovaSharp.Cli.dll` being â€œin useâ€ before retrying) records overall **84.9â€¯% line / 84.7â€¯% branch / 87.5â€¯% method** coverage with `NovaSharp.Interpreter` holding at **94.0â€¯% line / 90.6â€¯% branch / 96.6â€¯% method** across **2â€¯039** Release tests. `Table` line coverage is now >=95â€¯%, but branch coverage remains **86.8â€¯%** because `ResolveMultipleKeys` and iterator continuations still have untouched combinations. `ReplInterpreterScriptLoader` tests now assert the whitespace/env precedence and null-return semantics, yet OpenCover continues to flag lines 39/48/77 as unvisited, so we may need to refactor the constructor into helper methods to expose those branches explicitly.
   - ğŸ”„ (2025-11-17 11:05 UTC) Locked down the flakey REPL loader fixture by marking it `[NonParallelizable]`, added `RuntimeScopeFrameTests` to cover the debug-symbol bookkeeping, and reran `./scripts/coverage/coverage.ps1 -SkipBuild`. The latest run (2â€¯058 tests) lands at **85.0â€¯% line / 84.9â€¯% branch / 87.5â€¯% method** overall with `NovaSharp.Interpreter` at **94.1â€¯% line / 90.8â€¯% branch / 96.7â€¯% method**. `RuntimeScopeFrame` now reports **100â€¯% line/method** and `Table` is fully green (**98.5â€¯% line / 95.8â€¯% branch**), shifting the red list to the remaining reflection/member descriptors plus the parser/lexer helpers (`ObjectCallbackMemberDescriptor`, `PropertyMemberDescriptor`, `DynamicExprExpression`, `LexerUtils`, etc.).
   - ğŸ”„ (2025-11-17 11:30 UTC) Added constructor/AOT/optimization regressions to `PropertyMemberDescriptorTests` (dual-null accessor guard, AOT forcing `InteropAccessMode.Reflection`, explicit `IOptimizableDescriptor.Optimize` path) and reran `./scripts/coverage/coverage.ps1 -SkipBuild` (2â€¯061 tests). Overall coverage ticks up to **85.1â€¯% line / 84.9â€¯% branch / 87.6â€¯% method**, with `NovaSharp.Interpreter` steady at **94.1â€¯% line / 90.9â€¯% branch / 96.8â€¯% method**. `PropertyMemberDescriptor` now reports **89.6â€¯% line / 94.1â€¯% branch**; the remaining uncovered statements are the redundant `_getter/_setter` guards and the argument-mismatch catch blocks that `MemberDescriptor.CheckAccess`/`ScriptToClrConversions` already short-circuit.
  - ğŸ”„ (2025-11-17 12:16 UTC) Introduced `Units/ObjectCallbackMemberDescriptorTests` to prove delegate execution (host/context/args propagation) and the null-callback fallback, then reran `./scripts/coverage/coverage.ps1 -SkipBuild` (2â€¯063 tests). Interpreter coverage holds at **94.2â€¯% line / 90.8â€¯% branch / 96.7â€¯% method**, while `ObjectCallbackMemberDescriptor` climbs to **92.8â€¯% line / 100â€¯% branch**, narrowing the red list to `PropertyMemberDescriptor`, the parser helpers (`DynamicExprExpression`, `AdjustmentExpression`), and the lexer/numeric conversion utilities.
  - ğŸ”„ (2025-11-17 22:25 UTC) Repaired the reflective shim inside `Units/DynamicAndAdjustmentExpressionTests` so Eval/Compile overrides can be exercised under C#â€¯9, fixed the `TableTests` fractional-key/object-array removal cases to avoid cross-script ownership violations and null dereferences, tightened the whitespace `NovaSharp_PATH` scenario in `ReplInterpreterScriptLoaderTests`, and reran `./scripts/coverage/coverage.ps1 -SkipBuild` (2â€¯067 tests). `NovaSharp.Interpreter` coverage stays at **94.2â€¯% line / 90.9â€¯% branch / 96.8â€¯% method**, but both `DynamicExprExpression` and `AdjustmentExpression` are now >95â€¯% line coverage and the red list has shrunk to the platform/lexer/runtime helpers called out in `docs/coverage/coverage-hotspots.md` (`PropertyMemberDescriptor`, `ReplHistoryInterpreter`, `LimitedPlatformAccessor`, `LexerUtils`, `NumericConversions`, `MultiDictionary<T>`, `DynValue`, etc.).
  - ğŸ”„ (2025-11-17 15:06 UTC) Hardened the Limited Platform accessor suite by calling every unsupported override (`FileExists`, `DefaultPrint`) directly, rebuilding in Release, and rerunning `./scripts/coverage/coverage.ps1 -SkipBuild` (2â€¯072 tests). `NovaSharp.Interpreter` now reports **94.3â€¯% line / 90.9â€¯% branch / 96.9â€¯% method**, `LimitedPlatformAccessor` is fully covered (**100â€¯% line/method**), and the red list is down to the parser/lexer helpers plus the numeric conversion utilities noted in `docs/coverage/coverage-hotspots.md`.
  - ğŸ”„ (2025-11-17 15:33 UTC) Landed `Units/LexerUtilsTests` to exercise the parser helpers (decimal/hex parsing, Unicode/z-mode escapes, unfinished strings). `./scripts/coverage/coverage.ps1 -SkipBuild` (2â€¯091 tests) lifts `LexerUtils` to **96.2â€¯% line / 98.1â€¯% branch / 100â€¯% method** and keeps interpreter totals at **94.4â€¯% line / 91.1â€¯% branch / 96.9â€¯% method**.
  - ğŸ”„ (2025-11-17 15:47 UTC) Added `Units/NumericConversionsTests` covering the double-to-type success/overflow paths plus numeric/non-numeric `TypeToDouble`. The latest `./scripts/coverage/coverage.ps1 -SkipBuild` run (2â€¯095 tests) raises `NumericConversions` to **91.3â€¯% line / 89.1â€¯% branch / 100â€¯% method** and nudges interpreter coverage to **94.4â€¯% line / 91.2â€¯% branch / 96.9â€¯% method**, leaving `MultiDictionary<T>`, `DynValue`, and the diagnostics helpers as the remaining <90â€¯% debt.
  - ğŸ”„ (2025-11-17 16:03 UTC) Introduced `Units/MultiDictionaryTests` (equality comparer constructor, `ContainsKey`, `Keys`, `Clear`, remove-value success/failure). `./scripts/coverage/coverage.ps1 -SkipBuild` (2â€¯101 tests) now reports `MultiDictionary<T>` at **100â€¯% line / branch / method** while NovaSharp.Interpreter holds at **94.4â€¯% line / 91.2â€¯% branch / 97.1â€¯% method**, focusing the remaining debt on `DynValue` and diagnostics helpers.
  - ğŸ”„ (2025-11-17 16:34 UTC) Bulked up `Units/DynValueTests` (array-based table construction, single-value tuple folding, `ToPrintString` / `ToDebugPrintString` fallbacks, equality/read-only assignment guards, and `CheckUserDataType` nil handling) and reran `./scripts/coverage/coverage.ps1 -SkipBuild`. The run (2â€¯123 tests) puts `NovaSharp.Interpreter.DataTypes.DynValue` at **95.2â€¯% line / 92.2â€¯% branch / 100â€¯% method** and lifts interpreter totals to **94.7â€¯% line / 91.6â€¯% branch / 97.2â€¯% method**, narrowing the <90â€¯% backlog to the diagnostics helpers plus the platform/accessor items listed above.
  - ğŸ”„ (2025-11-17 17:21 UTC) Extended `Units/PropertyMemberDescriptorTests` with `SetValueConvertsDoubleToPropertyType`, `SetValueWrapsArgumentExceptionFromOptimizedSetter`, and `SetValueWrapsInvalidCastExceptionFromOptimizedSetter`. The new cases force the numeric downcast path and inject custom `_optimizedSetter` delegates (via reflection) that throw `ArgumentException`/`InvalidCastException`, exercising both catch blocks in the descriptor. After `./scripts/coverage/coverage.ps1 -SkipBuild` (2â€¯126 tests) `PropertyMemberDescriptor` now reports **94.5â€¯% line / 94.1â€¯% branch / 100â€¯% method**, keeping interpreter coverage at **94.7â€¯% line / 91.6â€¯% branch / 97.2â€¯% method**.
  - ğŸ”„ (2025-11-18 05:25 UTC) Expanded `Units/TokenTests` to cover the padded `ToString` output, every reserved keyword, numeric/hex/hex-float parsing, unary/binary/operator helpers, end-of-block classification, and the `GetSourceRef*` overloads. `Tree.Lexer.Token` now reports **100â€¯% line / 100â€¯% branch / 100â€¯% method**, and the latest `./scripts/coverage/coverage.ps1 -SkipBuild` run lands at **95.2â€¯% line / 92.1â€¯% branch / 97.4â€¯% method** across **2â€¯196** Release tests (overall repo **85.9â€¯% line**).
  - ğŸ”„ (2025-11-18 05:25 UTC) Added deterministic stopwatch coverage: `PerformanceStatisticsTests` now verifies redundant enable/disable calls, proves `StartGlobalStopwatch` accumulates over multiple scopes, and asserts `GetPerformanceLog` output, while `GlobalPerformanceStopwatch.GetResult()` marks results as global. `PerformanceStatistics` jumps to **98.2â€¯% line / 96.1â€¯% branch / 90â€¯% method**, removing it from the red list and keeping the shared diagnostics infrastructure spec-compliant.
  - ğŸ”„ (2025-11-18 05:25 UTC) Introduced new debugger/binary-dump coverage: `Units/DebuggerBreakpointTests` exercises breakpoint toggle/set/clear/reset flows through a stub debugger, `Units/ProcessorBinaryDumpTests` covers invalid header/version/base-address guards, `ScriptLoadTests.LoadStreamHandlesShortTextStreams` forces the short-stream path in `Processor.IsDumpStream`, and `ScriptOptionsTests.CallRecordsExecutionCounterWhenEnabled` proves the per-call stopwatch disposal path. `Execution.VM.Processor` now reports **90.7â€¯% line / 88.0â€¯% branch / 94.0â€¯% method**, keeping interpreter totals at **95.2â€¯% line / 92.1â€¯% branch / 97.4â€¯% method** across **2â€¯196** Release tests.
  - ğŸ”„ (2025-11-17 19:24 UTC) Introduced `Units/SystemHighResolutionClockTests` to verify stopwatch frequency wiring, monotonic timestamps, explicit elapsed calculations, and the null-`endTimestamp` path. `SystemHighResolutionClock` now sits at **100â€¯% line / 100â€¯% branch / 100â€¯% method**, and the latest `./scripts/coverage/coverage.ps1 -SkipBuild` run (2â€¯142 tests) bumps interpreter aggregates to **94.8â€¯% line / 91.6â€¯% branch / 97.3â€¯% method**.
  - ğŸ”„ (2025-11-17 22:41 UTC) Added new `ReplHistoryInterpreterTests` covering empty-history access, the `HistoryNext` early-return branch, and navigation reset/overwrite behaviour once the circular buffer wraps. The latest `./scripts/coverage/coverage.ps1 -SkipBuild` run (2â€¯070 tests) keeps interpreter totals at **94.2â€¯% line / 90.9â€¯% branch / 96.8â€¯% method**, and `ReplHistoryInterpreter` now reports **95.2â€¯% line / 87.5â€¯% branch / 100â€¯% method**, removing it from the <90â€¯% list so focus can shift to the platform accessors, lexer helpers, and numeric conversions.
  - ğŸ”„ (2025-11-17 15:33 UTC) Added `Units/LexerUtilsTests` to hammer the prefix/escape guardrails (missing `0x`, malformed exponents, Unicode `\u{}` shape, `\z` trimming, unfinished escapes) and reran `./scripts/coverage/coverage.ps1 -SkipBuild` (2â€¯091 tests). `NovaSharp.Interpreter` now reports **94.4â€¯% line / 91.1â€¯% branch / 96.9â€¯% method**, `LexerUtils` sits at **96.2â€¯% line / 98.1â€¯% branch / 100â€¯% method**, and the remaining <90â€¯% debt is concentrated in `NumericConversions`, `MultiDictionary<T>`, `DynValue`, and the diagnostics helpers tracked in `docs/coverage/coverage-hotspots.md`.
  - âš–ï¸ Guardrail: treat any failing test as a spec investigation. Cross-check behaviour against the official Lua manuals for every supported version (baseline: 5.4.8), capture the cited section/link in the diff, and only adjust production/tests once the canonical interpreter behaviour is understood.
    - âœ… Policy update (2025-11-14): when a test surfaces a regression, fix the production implementation (or legacy-era behaviour) instead of weakening the test; NovaSharp must converge on Lua 5.4 semantics, so â€œmaking tests passâ€ is never an acceptable substitute for addressing the runtime gap.
  - â³ Establish a multi-version Lua spec harness: enumerate the manuals/sections for each supported version, expand spec suites (string/math/table/core/error paths) with exhaustive edge/error cases that cite the manual, and sync findings into `docs/LuaCompatibility.md`.
  - ğŸ”œ Audit existing regression tests for spec fidelity: review each red/green test against the Lua 5.4 manual (and any documented deviations), catalog cases where weâ€™re locking in behaviour that disagrees with stock Lua, and file follow-up bugs to bring NovaSharp back to spec instead of preserving incorrect legacy-era expectations.
    - ğŸ”„ Bootstrapped the audit log at `docs/testing/spec-audit.md`, citing Lua Â§3.4.1 for the fixed power-operator gap, documenting `math.modf` (Â§6.7) now truncates toward zero, and confirming the `nil == void` guard remains an internal sentinel. Next pass: expand the table across other interpreter hotspots and file issues for every â€œNeeds investigationâ€ entry.
  - âœ… Expanded EventMemberDescriptor, CharPtr, StringConversions, DescriptorHelpers, RefIdObject, ExprListExpression, FieldMemberDescriptor, StandardEnumUserDataDescriptor, ScriptExecutionContext, and `FastStack<T>` unit suites (null-pointer guards, tuple compilation, SafeGetTypes failure path, string conversion errors, ref-id formatting, field read/write guardrails, enum conversion/validation, call/AdditionalData edge paths, explicit-interface stack members) and reran `./scripts/coverage/coverage.ps1` (2025-11-12 18:55 UTC); NovaSharp.Interpreter now reports **86.1â€¯% line / 82.3â€¯% branch** coverage with the former red-listed classes clearing 95â€¯%+ (`FastStack<T>` now 100â€¯%).
4. **Project Structure Refactor (High Priority)**
   - âœ… Solution + debugger project rename landed (PascalCase `NovaSharp.sln`, `NovaSharp.VsCodeDebugger.csproj`).
   - âœ… VSÂ Code debugger `_Projects` mirror removed; project now multi-targets `netstandard2.1;net8.0`.
   - âœ… CLI rename complete (`tooling/NovaSharp.Cli`).
   - âœ… Audit packaging/scripts for the new CLI name (NuGet spec, release docs, tooling installers). Packaging notes now consistently reference `cli`/`NovaSharp.Cli` for the REPL bundle and no longer mention the removed `repl` layout.
   - âœ… CLI now restores solely via NuGet (no checked-in packages).
   - âœ… Audited legacy assets: `src/legacy/Tools/lua52.dll` quarantined with README; exclude from modern builds unless a native packaging strategy is required.
   - âœ… Update automation/scripts (branding + build workflows) to reflect the new directory paths; legacy `rsync_projects.sh` has been removed and the shared guard/coverage workflows already reference the current tooling layout.
  - âœ… Retired the entire `src/legacy` tree (Flash client, NovaSharpPreGen console, Lua52 binaries, empty `novasharp_netcore`) after confirming no build/test dependencies; modernization docs now capture the removal for historical context.
  - ğŸ”œ Plan the namespace/package rebrand: migrate code to `WallstopStudios.*` namespaces and align package IDs to `com.wallstop-studios.*` while keeping the NovaSharp product name. Produce a staged rollout plan (analyzers, namespace audit, package metadata) before executing.
5. **Namespace & Formatting Enforcement**
   - âœ… Drafted analyzer configuration: root `Directory.Build.props` enables analyzers during build; `.editorconfig` keeps IDE0130 at warning until the ~700 existing namespace mismatches are triaged under the follow-on suppression/cleanup tasks.
   - âœ… Normalized `Execution/Scopes` namespaces and updated consumers so `ClosureContext`, `RuntimeScope*`, and loop helpers live under `NovaSharp.Interpreter.Execution.Scopes` without breaking the build.
   - âœ… Migrated `DataTypes/*` to `NovaSharp.Interpreter.DataTypes` and added a scoped global using so dependent code compiles while we continue tightening folder-aligned namespaces.
   - âœ… Shifted `DataStructs/*` to `NovaSharp.Interpreter.DataStructs` and introduced shared global using coverage for their extensions.
   - âœ… Moved core execution helpers (`ScriptExecutionContext`, `DynamicExpression`) under `NovaSharp.Interpreter.Execution` and rehomed interop attributes + runtime errors beneath folder-aligned namespaces.
   - ğŸ”„ Work-in-progress: reapply namespace/import fixes with Unity-compatible constructs (no global usings), updating runtime/interop consumers one file at a time to keep source drops usable inside Unity.
     - âœ… Closed the remaining `DataStructs` loopholes by moving `Extension_Methods` under `NovaSharp.Interpreter.DataStructs` and swapping every consumer over to explicit `NovaSharp.Interpreter.DataStructs` imports; `NovaSharp.Interpreter` builds clean aside from pre-existing IDE0130 warnings.
     - âœ… Completed the `DataTypes/*` namespace migration with explicit `NovaSharp.Interpreter.DataTypes` imports woven through runtime/interop call sites; build now succeeds (warnings only) without relying on global-usings.
     - âœ… Realigned `Errors/*` to `NovaSharp.Interpreter.Errors` and propagated the new namespace through compiler/runtime call sites, eliminating the remaining IDE0130 warnings for that folder without introducing globals.
     - âœ… Rehomed `Execution/*.cs` (`DynamicExpression`, `ScriptExecutionContext`, `InstructionFieldUsage`) under `NovaSharp.Interpreter.Execution` and updated all consumers plus performance wrappers, keeping the build warning-free outside of the remaining legacy namespace backlog.
     - âœ… Lifted all interop attribute types into `NovaSharp.Interpreter.Interop.Attributes` and retargeted every consumer (`CoreLib`, `Interop`, `DataTypes/UserData`) to the new namespace, clearing the attribute naming inconsistencies without relying on global usings.
     - âœ… Converted the remaining runtime underscore artifacts to PascalCase (`Tree/FastInterface`, `ExtensionMethods`, `KopiLuaStringLib`, processor partials, `LuaBaseCLib`, `NamespaceDoc` split) and adjusted imports; the Options and Lexer namespaces now match their folders while consumers import `NovaSharp.Interpreter.Options` / `NovaSharp.Interpreter.Tree.Lexer`.
     - âœ… Swapped the CoreLib module surfaces back to instantiable classes (with targeted CA1052 suppressions) so generic registration accepts them, and renamed the platform accessor API (`OpenFile`, `GetStandardStream`, `GetTempFileName`, `ExitFast`, etc.) to PascalCase; updated runtime/tests to honor the new signatures while preserving Lua behaviour.
     - âœ… Rewired hardwire generators, benchmarks, and debugger shims to the new descriptor namespaces and `DynamicExpression.ExpressionCode` member, and updated CLI/test infrastructure to the PascalCase API surface so `dotnet build -c Release` returns cleanly (tests now consume shared NovaSharp usings via the project-level settings).
     - âœ… Confirmed `dotnet build src/NovaSharp.sln -c Release` and `dotnet test src/tests/NovaSharp.Interpreter.Tests/NovaSharp.Interpreter.Tests.csproj -c Release` succeed; remaining analyzer warnings are pre-existing CA/IDE suggestions and tracked separately.
     - âœ… Brought `Execution/Scopes` files in line with their folder namespace and threaded `Execution.Scopes` imports through the compiler/bytecode pipeline (chunk/loop statements, loader, debug module, VM call stack) so IDE0130 no longer fires for that area; scoped `ClosureContext` consumers now reference the new namespace without relying on globals.
     - âœ… Propagated the PascalCase namespace updates into debugger, CLI, tests, and hardwire tooling; replaced legacy `Interpreter` imports with explicit `NovaSharp.Interpreter.*`/`NovaSharp.Interpreter.DataTypes` references and retargeted hardwire descriptors to `StandardDescriptors.*`, restoring a clean Release build across the solution.
     - âœ… Reworked VSâ€¯Code protocol DTOs to expose read-only lists and init-only capability flags, eliminating the CA1819/CA1051 warnings triggered by public arrays and fields in `DebugSession`.
     - âœ… Renamed interop constants and Unity loader defaults to PascalCase and updated loader/member surfaces to return `IReadOnlyList<T>`/`Array.Empty<T>()`, clearing the residual CA1707/CA1805/CA1819 diagnostics in those areas.
     - âœ… Staged the `.editorconfig` import with Lua fixture overrides by adding `src/tests/NovaSharp.Interpreter.Tests/TestMore/.editorconfig` so TAP suites retain two-space indentation.
     - Catalogue remaining underscore-based files, folders, and identifiers and convert them to PascalCase wherever Lua compatibility does not mandate the legacy casing; document any unavoidable Lua-bound exceptions and the alternative mechanisms evaluated.
       - âœ… Renamed `XmlWriter_Extensions.cs` â†’ `XmlWriterExtensions.cs` and `release_readme.txt` â†’ `ReleaseReadme.txt`, leaving `_Hardwired.cs` and Lua assets as intentional holdouts.
     - Identify legacy/generated files needing suppression tags or sub-config.
6. **Unity/Packaging Alignment**
   - âœ… Updated `docs/UnityIntegration.md` with a netstandard2.1-focused quick-start walkthrough (publish â†’ copy â†’ wire in Unity) plus sample bootstrap code.
   - âœ… Audited tooling TFMs: runtime/debugger libraries stay on `netstandard2.1` while the CLI now targets `net8.0` so it can run as a dotnet tool/hosted executable.
   - âœ… Completed doc audit; active guides now reference `netstandard2.1`/`net8.0` (see `docs/Modernization.md`), with the archived Sandcastle project noted as historical .NET Framework content.
   - ğŸ”œ Automate Unity packaging via CI/CD: build `.unitypackage`/UPM tarballs containing all NovaSharp binaries (and dependencies) and publish artifacts on every tagged release.
   - ğŸ”œ Ship full Unity integration scripts: provide tooling that copies DLLs into `Plugins` (hash-aware), configures import settings, and enables analyzersâ€”use Wallstop Studiosâ€™ DxMessaging pipeline as inspiration.
   - ğŸ”œ Produce comprehensive Unity samples under `Samples~` demonstrating interpreter bootstrapping, modding hooks, CLI usage, and recommended project structure.
7. **Debugger Smoke Tests**
   - Author lightweight harnesses to drive VSÂ Code and remote debuggers (attach, breakpoint, variable inspection).
   - Gate behind opt-in flag while stabilising.
8. **Cross-Platform CI**
   - âœ… Added `dotnet-tests-windows` lane in `tests.yml` to mirror the Linux run and upload TRX artifacts; macOS lane still pending once Unity docs ship.
   - Consider nightly runs enabling IO/OS TAP suites on trusted hardware.
9. **Benchmark Governance**
   - âœ… Documented the local execution workflow, thresholds, and reporting cadence in `docs/Performance.md#Benchmark Governance`, and seeded the archival process with `docs/performance-history/README.md`.
   - âœ… Captured the November 10 benchmark sweep (runtime, script loading, NLua comparison), archived it at `docs/performance-history/2025-11-10.md`, and refreshed `docs/Performance.md` with the latest deltas and environment metadata.
10. **Roslyn Hardwire Replacement**
   - Design and implement a Roslyn source generator/analyzer that emits the hardwired userdata descriptors at compile time (NetStandard-compatible).
   - Integrate generator into the interpreter build and Unity pipeline; ensure output matches or exceeds existing hardwire coverage via new unit tests.
   - After generator parity is verified, delete the legacy `NovaSharp.Hardwire` tooling project and remove `_Hardwired.cs` artefacts.
   - ğŸ”„ Drafted `docs/proposals/roslyn-hardwire-generator.md` outlining generator goals, architecture, diagnostics, integration phases, and risks to guide implementation.
   - âœ… Augmented the proposal with a reflection-free interop scaffolding study: `docs/proposals/roslyn-hardwire-generator.md` now outlines hotspots and a phased plan for generator-emitted delegates that replace the existing reflection helpers.
11. **Performance Optimization Campaign**
   - Instrument allocation and timing baselines for runtime, CLI, and debugger pipelines using BenchmarkDotNet + EventCounters; publish the before/after data alongside coverage dashboards.
   - Replace high-traffic LINQ/query expressions in production code with allocation-free loops once equivalent tests guard behaviour (focus areas: `Execution`, `DataTypes`, `Interop`).
     - âœ… Replaced `Table.Pairs/Keys/Values` LINQ projections with custom iterators to eliminate per-enumeration allocations in hot table traversal paths; `TableTests` remain green.
     - âœ… Dropped LINQ usage from `StandardUserDataDescriptor` member discovery by replacing `OfType/Select/Any` with manual loops to reduce reflection-time allocations for userdata registration.
   - Profile per-request allocations in critical interpreters (metatables, dynamic expressions, coroutine resumption) and eliminate hot allocations via pooling or struct spans while keeping APIs intact.
   - âœ… Add allocation guardrails: schedule an investigation into object pooling / buffering strategies inspired by UnityHelpersâ€™ `Buffers` (and similar libraries) to ensure new allocations only occur when absolutely necessary. Scope includes:
     - Evaluate struct-based API variants (e.g., `TryGetX(out ValueListBuilder<T> builder)` or list-populating overloads) alongside existing `IEnumerable` returns so callers can reuse buffers.
     - Prototype value-based `IDisposable` helpers that avoid boxing while remaining assignment-compatible (`IDisposable result = ...`).
     - Catalogue candidate hotspots (table enumeration, descriptor generation, coroutine stacks) and capture findings/tests before rollout.
     - âœ… Captured the initial study in `docs/performance/object-pooling-study.md`, listing hotspots, proposed buffer-based APIs, and next steps for instrumentation.
   - Investigate introducing generic variants for heavily-used helpers to eliminate boxing of interfaces/value types (e.g., `IEnumerator`, `IUserDataType` call-sites); capture candidates, prototype generic alternatives, and benchmark/alloc-diff results before rollout.
   - Add regression tests/benchmarks that fail when allocations or median timings exceed established thresholds so the gains remain enforced in CI.
   - Evaluate value-type substitutions: audit frequently allocated helper classes/struct-like containers and prototype replacing them with `struct` equivalents (when safe) to reduce GC pressure; include benchmarks + safety tests (copy semantics, mutation) before adoption.
12. **Debugger Orchestration Library (Low Priority)**
   - Evaluate extracting common remote-debugger session management into a shared `NovaSharp.Debugger.Core` library consumed by CLI, VSÂ Code, Cursor, Visual Studio (2022/2026), and Rider front ends.
   - Inventory protocol overlaps (transport, attach semantics, UI-hooks) across existing adapters and spike shared abstractions for launch, attach, and breakpoint workflows.
   - Track incremental adoption roadmap in docs, ensuring each host keeps the current UX while reusing the shared core.
13. **Shared Core Modules Feasibility (Low Priority)**
    - Explore factoring shared runtime tooling (benchmark writers, CLI helpers, debugger utilities) into reusable libraries instead of relying on `InternalsVisibleTo`.
    - Audit existing cross-project dependencies to identify candidates for a `NovaSharp.Core.Tooling` / `NovaSharp.Core.Debug` module boundary.
    - Prototype a small migration (e.g., benchmark utilities) to validate packaging, versioning, and breaking-change surface.

14. **Lua 5.4 Compatibility Expansion**
15. **Lua Spec Conformance Harness**
    - âœ… Inventory the upstream Lua 5.4 features we still miss (e.g., `goto` semantics, new library APIs, weak tables, to-be-closed variables) and track them in a parity matrix (`docs/LuaCompatibility.md`).
    - Investigate implementing weak tables/ephemeron behaviour in `Table` + GC to match Lua 5.4; validate via new regression suites and memory stress tests.
    - Evaluate the impact of Lua 5.4 VM/runtime changes (metamethod tweaks, math library updates, `debug` additions) and scope incremental delivery plans with benchmarks to ensure no regressions.
    - Catalog the Lua versions we plan to support (5.2â€“5.5 plus â€œLatestâ€) and map every manual section (core language, standard libraries, appendix) to spec test coverage targets tracked alongside the parity matrix.
    - âœ… Captured an initial coverage ledger in `docs/testing/spec-coverage.md`, outlining version targets, manual sections, and current status indicators.
    - ğŸ”„ Added the first Lua 5.4 spec harness suite (`Lua54StringSpecTests`) covering canonical string library examples (byte/char ranges, pattern-free helpers); expand to additional libraries next.
    - Stand up a conformance harness that executes official manual examples, edge cases, and error scenarios, storing fixtures beside the NUnit TAP corpus for reuse across interpreter builds.
    - For each module (`StringModule`, `MathModule`, coroutine APIs, etc.), enumerate edge/error behaviours from the spec and add exhaustive NUnit coverage so we rely on canonical Lua semantics rather than legacy-era behaviour.
    - Integrate the harness into CI, fail builds on spec regressions, and capture progress/remaining work in `docs/testing/spec-coverage.md` with links back to manual sections.

## Long-Horizon Ideas
- Property/fuzz testing for lexer/parser and VM instruction boundaries.
- Golden-file assertions for debugger protocol payloads and CLI output.
- Native AOT / trimming validation once runtime stack is fully nullable-clean.
- Automated regression harness for memory allocations using BenchmarkDotNet diagnosers.

Keep this plan in sync with `docs/Testing.md` and `docs/Modernization.md`. Update after each milestone so contributors know what's complete, in-flight, and still open.


